import{_ as e}from"./index-b0450432.js";import{u as a}from"./vendor-vue-router-5605f985.js";import{u as t}from"./vendor-vuex-61b6ee10.js";import{a6 as r,a7 as s,_ as i}from"./index-886f43d3.js";import{m as o,r as l,M as n}from"./vendor-ant-design-vue-7dd2b151.js";import{d,w as c,v as p,r as y,k as u,e as g,a6 as m,ba as v,bb as h,bc as f,u as I,bh as b,bf as P,a4 as k,bj as _,a5 as w,h as x,bd as C,be as T,Z as E,o as j,l as S,aP as K}from"./vendor-others-96825896.js";const R={key:1,class:"pay-content"},L={class:"pay-code-box"},N={class:"code-box"},U={class:"paydesc"},A=(e=>(C("data-v-8c0f4a01"),e=e(),T(),e))((()=>P("div",{class:"paydesc-title"},"此订单在30分钟内支付有效",-1))),B={style:{"font-size":"14px","text-align":"center","line-height":"50px"}},G={style:{color:"#fc987e","font-size":"24px"}},H={key:0},Y={key:1},$=i(d({__name:"paying",emits:["update:visible"],setup(e,{emit:a}){const i=x(),{$http:d}=i.appContext.config.globalProperties,C=t();c((()=>C.getters.isPayIng),(e=>{(()=>{let e=document.getElementById("payTags");null===e&&(e=document.createElement("script"),e.src="/staticjs/qrious.js",e.id="payTags",document.getElementsByTagName("head")[0].appendChild(e))})(),e?(K(e),M=C.getters.paywayType,D.value=!0):(clearInterval($.timer),D.value=!1)}));const T=p(null),j=p(null),S=p(0),K=async e=>{d.get("/openapi/pck/all",{params:{type:"gold"==$.type?2:1}}).then((a=>{$.visible=e;let{data:t}=a,r=t?t.sort(((e,a)=>e.sort-a.sort)):[];$.pckList=r,$.activeKey=C.getters.rechargePrice?0:C.state.payIndex||r[0].id,$.rechargePrice=C.getters.rechargePrice,$.isCurrPay=$.pckList.filter((e=>e.id==$.activeKey))[0]||{price:100*$.rechargePrice},(()=>{var e;$.typeIndex=S.value,$.loading=!0,$.myIsPay=!0,$.isCurrPay=$.pckList.filter((e=>e.id==$.activeKey))[0]||{price:100*$.rechargePrice};let a={rechargeType:"gold"==C.getters.payType?2:1,rechargeKind:0==$.activeKey?2:1};a.packageId=(null==(e=$.isCurrPay)?void 0:e.id)||0,a.returnUrl=location.origin+"/memberUser/payStatus",0==$.activeKey&&(a.rechargePrice=100*$.rechargePrice),d.post(null==M?void 0:M.addr,a).then((e=>{let{data:a}=e;"wechat"==M.payType?E((()=>{new QRious({element:T.value,value:a.url}),$.loading=!1})):"alipay"==M.payType?s()?window.location.href=a.url:window.open(a.url,"_blank"):E((()=>{new QRious({element:T.value,value:a.url}),$.loading=!1})),$.orderId=a.orderId,$.loading=!1,sessionStorage.setItem("payId",a.orderId)})).catch((e=>{o.error(e.response.data.message||"发起支付失败！"),$.loading=!0,$.myIsPay=!1}))})()})),"gold"==$.type&&d.get("/openapi/siteConfig/goldRate").then((e=>{let{data:a}=e;$.rechargeGold=a.gold,$.rechargePrice=a.price}))},$=y({activeKey:0,pckList:[],visible:!1,type:u((()=>C.getters.payType))||"gold",isCurrPay:{},orderId:"",timer:null,typeIndex:0,iframeUrl:"",myIsPay:!1,rechargePrice:0,rechargeGold:0,loading:!1,isPayObj:{},thirdPay:""});c((()=>$.orderId),(e=>{e&&($.timer=setInterval((()=>{if($.loading)return!1;d.post("/openapi/pay/order/status",{orderId:$.orderId}).then((e=>{let{data:a}=e;a&&(o.success("支付成功！"),r.go(-1),C.dispatch("refreshInfo"),q())}))}),1500))})),g((()=>{clearInterval($.timer)}));const{thirdPay:z,visible:D,isCurrPay:O,typeIndex:Q,myIsPay:X}=m($),q=()=>{a("update:visible",!1),C.commit("SETISPAYING",!1),C.commit("SETRECHAR",0),S.value=0,C.commit("SETPAYINDEX",0),$.isCurrPay={},$.activeKey=0,$.myIsPay=!1,C.commit("SETPAYINDEX",0),clearInterval($.timer)};let M=y({});return(e,a)=>{const t=l,r=n;return v(),h(r,{visible:I(D),"onUpdate:visible":a[0]||(a[0]=e=>w(D)?D.value=e:null),destroyOnClose:!0,width:"100%",centered:"",maskClosable:!1,footer:null,"show-close":"",onCancel:q},{default:f((()=>{var e,a,r;return[(null==(e=I(O))?void 0:e.price)?(v(),b("div",R,[P("div",L,[P("div",N,[P("div",{class:"code",ref_key:"topRef",ref:j},[P("img",{ref_key:"codeRef",ref:T,id:"codeRef"},null,512)],512),P("div",U,[A,P("div",B,[k(" 支付金额："),P("label",G,_(I(O).price/100),1),k("元 ")]),"custom"==(null==(a=I(M))?void 0:a.payType)?(v(),b("div",H," 请扫描二维码完成支付 ")):(v(),b("div",Y,"请使用"+_(null==(r=I(M))?void 0:r.name)+"扫一扫，轻松支付",1))])])])])):(v(),h(t,{key:0,paragraph:{rows:4}}))]})),_:1},8,["visible"])}}}),[["__scopeId","data-v-8c0f4a01"]]),z={class:"cu_h5_header"},D={class:"goBack"},O={class:"title"},Q={class:"slot-right"},X=i(d({__name:"HeaderH5",props:{title:{type:String,default:"标题"}},setup(r){const s=t(),i=x(),{$http:o}=i.appContext.config.globalProperties,l=a();return j((()=>{o.get("/openapi/links/page",{limit:30}).then((e=>{s.commit("SETLINKS",e.data.list)}))})),(a,t)=>{const s=e;return v(),b("div",z,[P("span",D,[S(s,{name:"fanhui1",onClick:t[0]||(t[0]=e=>{"/memberUser"==l.currentRoute.value.path?window.open(location.origin,"_self"):window.history.length>1?l.go(-1):l.push("/")})})]),P("span",O,_(r.title),1),P("div",Q,[K(a.$slots,"right",{},void 0,!0)]),S($)])}}}),[["__scopeId","data-v-ebf0701e"]]);export{X as _};
