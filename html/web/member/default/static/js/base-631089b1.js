import{_ as e}from"./index-b0450432.js";import{_ as a}from"./invite.vue_vue_type_style_index_0_lang-7e36a586.js";import{u as t}from"./vendor-vue-router-5605f985.js";import{a1 as s,T as o,V as i,Y as r,a5 as n,_ as l}from"./index-886f43d3.js";import{u as c}from"./vendor-vuex-61b6ee10.js";import{d,w as u,o as m,k as v,r as p,v as f,a6 as g,ba as b,bh as h,bf as y,l as w,bc as _,u as k,bb as S,bk as I,a5 as R,F as x,a4 as K,bj as C,bn as z,h as D,bl as j}from"./vendor-others-96825896.js";import{m as O,k as U,l as $,I as P,i as F,f as L,B as T,_ as N,R as A,F as E}from"./vendor-ant-design-vue-7dd2b151.js";const M={class:"tabs-box"},q={key:0,style:{"margin-bottom":"1rem","text-align":"center",color:"red","z-index":"1",position:"relative"}},Z={class:"input-box bitian"},X={class:"input-box bitian"},B={class:"input-box bitian"},V={class:"validate"},G={class:"input-box bitian",style:{width:"240px"}},Y={class:"input-box"},H={class:"content-box"},J={class:"desc"},Q=l(d({__name:"base",setup(l){const d=c(),Q=D(),{$http:W}=Q.appContext.config.globalProperties;t(),u((()=>d.getters.isLogin),(e=>{se.visible=e}));const ee=e=>{let a=e,t=["账号","短信","邮箱"].indexOf(e);return se.isRegister?o()?["设置密码","短信验证","邮箱验证"][t]:e+"注册":a+"登录"},ae=s();m((()=>{(o()||"2"==ae.type)&&(se.isRegister=!0),se.isRegister=!!se.shareIs||se.isRegister}));const te=v((()=>d.getters.allInfo)),se=p({activeKey:1,accountKey:1,checked:!1,activeMap:["账号","手机号","邮箱"],count:0,countDown:null,isRegister:!1,visible:!1,formState:{},shareIs:i.getSession("shareId")||ae.r||null,isXy:!1,valiLoad:!1,rules:{password:[{required:!0,message:"密码不能为空！",trigger:"blur"},{min:6,max:20,message:"密码长度为6～20个字符",trigger:"blur"}],confirm:[{required:!0,trigger:"blur",validator:(e,a)=>(null==a?void 0:a.trim())?a!=se.formState.password&&se.formState.confirm?Promise.reject("两次密码不一致！"):Promise.resolve():Promise.reject("密码不能为空！")}],account:[{required:!0,trigger:"blur",validator:(e,a)=>{if(1==se.activeKey){return/^[a-zA-Z0-9]{3,24}$/.test(a)?Promise.resolve():Promise.reject("账号必须由3~24位数字,字符组成")}return(null==a?void 0:a.trim())?Promise.resolve():Promise.reject(`请输入${se.activeMap[se.activeKey-1]}!`)}}]}});let oe=null;const ie=e=>{!oe&&(e=>{if(!se.checked)return se.isXy=!0,!1;se.isRegister&&se.formState.inviteCode?(i.setSession("inviteCode",se.formState.inviteCode),d.commit("SETCONFIRMMODEL",!0)):le.submit()})(),oe&&clearTimeout(oe),oe=setTimeout((()=>{oe=null}),300)},re=e=>{},ne=f(null),le={async submit(){var e;const a=e=>{if(e.token&&n(e.token),d.commit("SETUSERINFO",e.userInfo),"true"==ae.back){let e=window.atob(window.decodeURIComponent(ae.callbackUrl));window.open(e)}else window.open(location.origin+"/memberUser","_self");d.commit("SETISLOGIN",!1)};try{if(1==se.activeKey){let e={userName:se.formState.account,password:j.exports(se.formState.password),confirmPassword:j.exports(se.formState.password),resolving:`${window.screen.width}*${window.screen.height}`,from:se.isRegister?o()?2:1:3};if(se.isRegister){e.inviteCode=se.shareIs?se.shareIs:se.formState.inviteCode;let{data:a}=await W.post("/openapi/member/register",e);se.isRegister=!1,O.success("注册成功！"),le.submit()}else{e.id="9",e.captcha="test";let{data:t}=await W.post("/openapi/member/login",e);a(t)}}else{let e={code:se.formState.code,userName:se.formState.account,verifyType:2==se.activeKey?1:2,resolving:`${window.screen.width}*${window.screen.height}`,from:se.isRegister?o()?2:1:3};se.isRegister&&(e.inviteCode=se.shareIs?se.shareIs:se.formState.inviteCode);var t=await W.post(se.isRegister?"/openapi/member/verify/register":"/openapi/member/verify/login",e);let{data:s}=t;a(s)}}catch(s){O.error((null==(e=s.response)?void 0:e.data.message)||"操作失败！")}},changeKey(){se.countDown&&(clearInterval(se.countDown),se.count=0,se.formState={}),ne.value.clearValidate()},rulesRegular:()=>(2==se.activeKey?/^(?:(?:\+|00)86)?1[3-9]\d{9}$/:/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/).test(se.formState.account)},ce=r((function(){se.valiLoad=!0;let e={};2==se.activeKey?e.phone=se.formState.account:e.email=se.formState.account,W.post(2==se.activeKey?"openapi/sms/send_sms":"openapi/sms/send_email",e).then((e=>{O.success(2==se.activeKey?"短信发送成功":"邮箱发送成功"),se.countDown&&clearInterval(se.countDown),se.count=60,se.countDown=setInterval((()=>{se.count<1?(se.count=0,clearInterval(se.countDown)):se.count--}),1e3)})).catch((e=>{e.response?O.error(e.response.data.message||"发送失败，请重试！"):O.error(e.message||"发送失败，请重试！"),se.countDown&&clearInterval(se.countDown),se.count=0})).finally((()=>{se.valiLoad=!1}))}),1e3,!0),{activeKey:de,accountKey:ue,checked:me,isRegister:ve,activeMap:pe,isXy:fe,rules:ge,count:be,formState:he,shareIs:ye,valiLoad:we}=g(se);return m((()=>{d.state.bindKey&&(se.isRegister=!1),te.value.smsOpen?se.activeKey=2:te.value.emailOpen&&(se.activeKey=3),se.isRegister=!!se.shareIs||se.isRegister})),(t,s)=>{const i=U,r=$,n=e,l=P,c=F,u=L,m=T,v=N,p=A,f=E;return b(),h("div",null,[y("div",M,[w(r,{activeKey:k(de),"onUpdate:activeKey":s[0]||(s[0]=e=>R(de)?de.value=e:null),onChange:s[1]||(s[1]=e=>le.changeKey()),class:"login"},{default:_((()=>[k(te).smsOpen?(b(),S(i,{key:2,tab:ee("短信")},null,8,["tab"])):I("",!0),k(te).emailOpen?(b(),S(i,{key:3,tab:ee("邮箱")},null,8,["tab"])):I("",!0),k(te).useNameRegisterOpen?(b(),S(i,{key:1,tab:ee("账号")},null,8,["tab"])):I("",!0)])),_:1},8,["activeKey"])]),k(fe)?(b(),h("div",q," 同意《个人信息保护政策》《服务协议》 ")):I("",!0),w(f,{model:k(he),name:"basic",ref_key:"formRef",ref:ne,rules:k(ge),class:"defaultForm","wrapper-col":{span:22},autocomplete:"off",onFinish:ie,onFinishFailed:re},{default:_((()=>[w(c,{name:"account"},{default:_((()=>[y("div",Z,[w(n,{name:"morentouxiang",color:"#999",size:"1.5rem"}),w(l,{value:k(he).account,"onUpdate:value":s[2]||(s[2]=e=>k(he).account=e),placeholder:`请输入${k(pe)[k(de)-1]}`,bordered:!1},null,8,["value","placeholder"])])])),_:1}),1==k(de)?(b(),h(x,{key:0},[w(c,{name:"password"},{default:_((()=>[y("div",X,[w(n,{name:"mima",size:"1.5rem"}),w(u,{autocomplete:"off",value:k(he).password,"onUpdate:value":s[3]||(s[3]=e=>k(he).password=e),placeholder:"请输入密码",bordered:!1},null,8,["value"])])])),_:1}),k(ve)?(b(),S(c,{key:0,name:"confirm"},{default:_((()=>[y("div",B,[w(n,{name:"mima",size:"1.5rem"}),w(u,{autocomplete:"off",value:k(he).confirm,"onUpdate:value":s[4]||(s[4]=e=>k(he).confirm=e),placeholder:"请二次确认密码",bordered:!1},null,8,["value"])])])),_:1})):I("",!0)],64)):(b(),S(c,{key:1,name:"code",rules:[{required:!0,message:"请输入验证码!"}]},{default:_((()=>[y("div",V,[y("div",G,[w(n,{name:"yanzhengma",size:"1.5rem"}),w(l,{onkeyup:"this.value= this.value.match(/\\d+(\\.\\d{0,2})?/) ? this.value.match(/\\d+(\\.\\d{0,2})?/)[0] : ''",value:k(he).code,"onUpdate:value":s[5]||(s[5]=e=>k(he).code=e),maxlength:6,placeholder:"请输入验证码",bordered:!1},null,8,["value"])]),w(m,{type:"primary",class:"validatebtn",disabled:k(be)>0||!le.rulesRegular(),shape:"round",loading:k(we),onClick:k(ce)},{default:_((()=>[K(C(k(we)?"发送中":k(be)>0?`${k(be)}s后失效`:"发送验证码"),1)])),_:1},8,["disabled","loading","onClick"])])])),_:1})),k(d).state.isAgentOpen&&k(ve)&&!k(ye)?(b(),S(c,{key:2,name:"inviteCode"},{default:_((()=>[y("div",Y,[w(n,{name:"yanzhengma",size:"1.5rem"}),w(l,{value:k(he).inviteCode,"onUpdate:value":s[6]||(s[6]=e=>k(he).inviteCode=e),bordered:!1,placeholder:"邀请码"},null,8,["value"])])])),_:1})):I("",!0),y("div",H,[w(v,{autoInsertSpaceInButton:!1},{default:_((()=>[w(m,{type:"primary",class:"loginbtn","html-type":"submit",shape:"round"},{default:_((()=>[K(C(k(ve)?k(o)()?"绑定":"注册":"登录"),1)])),_:1})])),_:1}),w(p,{onChange:s[7]||(s[7]=e=>fe.value=!1),checked:k(me),"onUpdate:checked":s[8]||(s[8]=e=>R(me)?me.value=e:null)},{default:_((()=>[y("span",{style:z([{fontSize:"12px"},{color:k(me)?"#666666":"#D0D0D0"}])},"同意《个人信息保护政策》《服务协议》",4)])),_:1},8,["checked"]),y("div",J,[K(C(k(ve)?"已":"还没")+"有账号？去 ",1),y("span",{style:{color:"#ff8e61",cursor:"pointer"},onClick:s[9]||(s[9]=e=>ve.value=!k(ve))},C(k(ve)?"登录":k(o)()?"绑定":"注册"),1)])])])),_:1},8,["model","rules"]),w(a,{onOk:s[10]||(s[10]=e=>le.submit())})])}}}),[["__scopeId","data-v-de49e233"]]);export{Q as l};
