import{x as e,h as a,R as l,D as t,ap as i,a9 as n,ac as s,aO as r,o,b as d,a as u,w as c,u as v,a3 as m,d as p,p as g,t as y,S as b,ag as f,ah as h,ai as x,O as _,P as w,A as I,aj as C,ak as z,a7 as k,al as D,am as K,an as V,ad as M,ao as N,T as F,c as S,Q as A,e as L,L as R,af as $,B as j,H as P,f as B,I as U}from"./.pnpm-9c274078.js";import{_ as T,p as Y,a as O}from"./index-e716b57f.js";import{_ as E}from"./empty-6f66e897.js";import{c as W}from"./cprogress-89103bb1.js";/* empty css                                                             */import{U as H}from"./userinfo-2d757c21.js";import{M as q}from"./mesList-6e63e858.js";/* empty css                                                 */const Q=e=>(_("data-v-92684eff"),e=e(),w(),e),G={class:"line-box"},J={class:"top-right"},X={class:"legend"},Z={class:"currDate"},ee=Q((()=>p("span",{class:"tag",style:{background:"#899bff"}},null,-1))),ae={key:0},le={key:1},te={key:2},ie={class:"lastDate"},ne=Q((()=>p("span",{class:"tag",style:{background:"#f0866a"}},null,-1))),se={key:0},re={key:1},oe={key:2},de=T({__name:"chartBar3",props:{load:{},list:{type:Object,default:()=>{}},survey:{type:Boolean,default:!1}},emits:["update:active"],setup(_,{emit:w}){const I=_,C=e();function z(e){var a,l;let t=1==k.activeName?"activeDay":"newDay";if(I.list[t])return new Date((null==(a=I.list[t].at(-1))?void 0:a.day)+" 00:00:00").getTime()>e.getTime()||e.getTime()>new Date((null==(l=I.list[t][0])?void 0:l.day)+" 00:00:00").getTime()}const k=a({activeKey:7,activeName:1,currMap:[],lastMap:[]}),D=e=>{if(e==k.activeKey&&!C.value)return!1;I.load().then((()=>{k.activeKey=e,C.value=void 0,A()}))},{activeKey:K,activeName:V,currMap:M,lastMap:N}=l(k),F=e(null),S={chart:null};t((()=>{S.chart=i(F.value),A(),n((()=>I.list),(()=>{A()}))}));const A=()=>{let e=s(I.list);if(C.value&&(K.value=Math.ceil((new Date(C.value[1]+" 23:59:59")-new Date(C.value[0]+" 00:00:00"))/864e5)),1==k.activeName)if(1!=k.activeKey||C.value)if(C.value){let t=(null==e?void 0:e.newDay)||[];a=t.slice(t.findIndex((e=>e.day===C.value[1])),t.findIndex((e=>e.day===C.value[0]))+1).reverse(),l=t.slice(t.findIndex((e=>e.day===C.value[0]))+1,t.findIndex((e=>e.day===C.value[0]))+K.value+1).reverse()}else{let t=(null==e?void 0:e.newDay)||[];a=t.slice(0,k.activeKey).reverse(),l=t.slice(k.activeKey,Number(k.activeKey+k.activeKey)).reverse()}else{let t=(null==e?void 0:e.newHour)||[];var a=t.slice(0,24).reverse(),l=t.slice(24).reverse()}else if(1!=k.activeKey||C.value)if(C.value){let t=(null==e?void 0:e.activeDay)||[];K.value=Math.ceil((new Date(C.value[1]+" 23:59:59")-new Date(C.value[0]+" 00:00:00"))/864e5);a=t.slice(t.findIndex((e=>e.day===C.value[1])),t.findIndex((e=>e.day===C.value[0]))+1).reverse(),l=t.slice(t.findIndex((e=>e.day===C.value[0]))+1,t.findIndex((e=>e.day===C.value[0]))+K.value+1).reverse()}else{let t=(null==e?void 0:e.activeDay)||[];a=t.slice(0,k.activeKey).reverse(),l=t.slice(k.activeKey,Number(k.activeKey+k.activeKey)).reverse()}else{let t=(null==e?void 0:e.activeHour)||[];var a=t.slice(0,24).reverse(),l=t.slice(24).reverse()}let t=a.map((e=>1!=k.activeKey||C.value?e.day:e.datetime)),i=a.map((e=>e.total)),n=l.map((e=>e.total));k.currMap=a,k.lastMap=l,L(t,i,n)},L=(e,a,l)=>{1==k.activeKey||k.activeKey,1==k.activeKey||k.activeKey,S.chart.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){return(e=>{let a=`<div style='display:flex;align-items:center;'><span style="\n      background: #899BFF;width: 14px;\n        height: 10px; border-radius: 2px; margin: 0 4px 2px 0;"></span>\n      <span style='font-size:12px;color:#C2C3C8;'>${e[0].name}</span></div>`,l=1!=k.activeKey||C.value?R(-k.activeKey,e[0].name):R(-1,e[0].name)+e[0].name.substring(10),t=`<div style='display:flex;align-items:center;'><span style="\n      background: #F0866A;width: 14px;\n        height: 10px; border-radius: 2px; margin: 0 4px 2px 0;"></span>\n        <span style='font-size:12px;color:#C2C3C8;'>${l}</span></div>`;var i=k.currMap.filter((a=>1!=k.activeKey||C.value?a.day==e[0].name:a.datetime==e[0].name))[0],n=k.lastMap.filter((e=>1!=k.activeKey||C.value?e.day==l:e.datetime==l))[0];return"<div style='padding:0 6px;'>"+a+`<div style='font-size:12px;color:#666;'>${1==k.activeName?"新增用户":"活跃用户"}: ${(null==i?void 0:i.total)||0}人</div><div style='font-size:12px;color:#666;'>${1==k.activeName?"新增游客":"活跃游客"}: ${(null==i?void 0:i.tourists)||0}人</div>`+t+`<div style='font-size:12px;color:#666;'>${1==k.activeName?"新增用户":"活跃用户"}: ${(null==n?void 0:n.total)||0}人</div><div style='font-size:12px;color:#666;'>${1==k.activeName?"新增游客":"活跃游客"}: ${(null==n?void 0:n.tourists)||0}人</div></div>`})(e)}},grid:{top:"20%",left:"0%",right:"1%",bottom:"2%",containLabel:!0},xAxis:{type:"category",data:(null==e?void 0:e.length)?e:["1","2","3","4","5","6","7"],axisLabel:{color:"#999999",formatter:function(e,a){let l=1!=k.activeKey||C.value?e.indexOf("-"):e.indexOf(" ");return 1!=k.activeKey||C.value?e.substring(l+1):e.substring(l+1,l+6)}}},yAxis:{type:"value"},series:[{data:(null==a?void 0:a.length)?a:[12,45,56,45,12,23,12],barWidth:20,itemStyle:{borderRadius:[10,10,0,0],color:new r(0,1,0,0,[{offset:0,color:"#C1CAFF"},{offset:1,color:"#8D9FFF"}])},type:"bar"},{data:(null==l?void 0:l.length)?l:[15,35,46,65,32,33,45],barWidth:20,itemStyle:{borderRadius:[10,10,0,0],color:new r(0,1,0,0,[{offset:0,color:"#FFB192"},{offset:1,color:"#FA5B50"}])},type:"bar"}]},!0),window.onresize=function(){S.chart.resize()}};function R(e,a){const l=e=>{var a=e;return 1==e.toString().length&&(a="0"+e),a};var t=a?new Date(a):new Date,i=t.getTime()+864e5*e;t.setTime(i);var n=t.getFullYear(),s=t.getMonth(),r=t.getDate();return n+"-"+(s=l(s+1))+"-"+(r=l(r))}return(e,a)=>{var l,t,i,n,s,r,_,w,k,S;const L=f,R=h,$=x;return o(),d(b,null,[u(R,{modelValue:v(V),"onUpdate:modelValue":a[0]||(a[0]=e=>m(V)?V.value=e:null),style:{"--el-font-size-base":"14px"},onTabChange:a[1]||(a[1]=e=>A())},{default:c((()=>[u(L,{label:"新增用户",name:1}),u(L,{label:"活跃用户",name:2})])),_:1},8,["modelValue"]),p("div",G,[p("div",{ref_key:"classChart",ref:F,style:{width:"100%",height:"230px"}},null,512),p("div",J,[p("span",{onClick:a[2]||(a[2]=e=>D(1)),class:g({active:1==v(K)&&!C.value})},"今天",2),p("span",{onClick:a[3]||(a[3]=e=>D(7)),class:g({active:7==v(K)&&!C.value})},"7天",2),p("span",{onClick:a[4]||(a[4]=e=>D(15)),class:g({active:15==v(K)&&!C.value})},"15天",2),p("span",{onClick:a[5]||(a[5]=e=>D(30)),class:g({active:30==v(K)&&!C.value})},"1月",2),u($,{modelValue:C.value,"onUpdate:modelValue":a[6]||(a[6]=e=>C.value=e),style:{width:"260px"},type:"daterange","range-separator":"～",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD","start-placeholder":"开始时间","end-placeholder":"结束时间",size:"small","disabled-date":z,onChange:a[7]||(a[7]=e=>e?I.load().then((()=>{A()})):D(7))},null,8,["modelValue"])]),p("div",X,[p("div",Z,[ee,1!=v(K)||C.value?(null==(l=v(M)[0])?void 0:l.day)===(null==(t=v(M)[v(M).length-1||0])?void 0:t.day)?(o(),d("span",le,y(null==(i=v(M)[v(M).length-1||0])?void 0:i.day),1)):(o(),d("span",te,y(null==(n=v(M)[0])?void 0:n.day)+" 至 "+y(null==(s=v(M)[v(M).length-1||0])?void 0:s.day),1)):(o(),d("span",ae,"今天"))]),p("div",ie,[ne,1!=v(K)||C.value?(null==(r=v(N)[0])?void 0:r.day)===(null==(_=v(N)[v(N).length-1||0])?void 0:_.day)?(o(),d("span",re,y(null==(w=v(N)[0])?void 0:w.day),1)):(o(),d("span",oe,y(null==(k=v(N)[0])?void 0:k.day)+" 至 "+y(null==(S=v(N)[v(N).length-1||0])?void 0:S.day),1)):(o(),d("span",se,"昨天"))])])])],64)}}},[["__scopeId","data-v-92684eff"]]),ue={class:"exam-box"},ce={class:"exam-header",style:{position:"relative"}},ve={class:"exam-title",style:{position:"absolute",right:"0px","z-index":"99"}},me={class:"exam-searh-box"},pe={class:"search-item"},ge=p("span",null,"用户身份",-1),ye={class:"search-item"},be=p("span",null,"推广渠道",-1),fe={style:{display:"flex",gap:"16px"},class:"panel"},he={class:"exam-content",style:{width:"350px"}},xe=p("div",{class:"exam-title"},"用户概况",-1),_e={class:"content-table"},we={class:"container",style:{padding:"0"}},Ie={class:"chart-box"},Ce={class:"pieBox",style:{"justify-content":"flex-start",gap:"24px 0"}},ze=p("p",null,"用户总数（人）",-1),ke={class:"number",style:{"font-size":"36px"}},De={class:"pagination",style:{"font-size":"12px",padding:"0 16px","line-height":"5vh"}},Ke={class:"filter",style:{margin:"0"}},Ve={class:"right"},Me={class:"search-item"},Ne=p("span",null,"时间范围",-1),Fe={class:"exam-content"},Se=p("div",{class:"exam-title"},"用户详情",-1),Ae={class:"content-table"},Le={class:"container",style:{padding:"0"}},Re={class:"filter"},$e=p("div",{class:"right"},[p("div",{class:"search-item"})],-1),je={class:"right"},Pe={class:"custom-input"},Be={class:"chart-box"},Ue=p("div",{class:"table-empty"},[p("img",{src:E,alt:"空状态"}),p("p",null,"暂无数据")],-1),Te={class:"pagination"},Ye={__name:"index",setup(i){const n=j(),{$http:s}=n.appContext.config.globalProperties,r=I(),g=a({yh:{},search:"",value_time:[],channelId:"",refresh:!0,memberRole:""}),f=e(),h=a({visible:!1,data:[],loading:!1,client:{},chatList:[],get:async e=>{var a;e.consultId=e.memberId,(null==(a=f.value)?void 0:a.page)&&(f.value.page=1),e.mesList=[],e.queryRole=1,h.client=e,h.visible=!0}}),_=()=>{var e;g.refresh=!1;let a={};(null==(e=g.value_time)?void 0:e.length)>0&&(a={timeStart:g.value_time[0]/1e3,timeEnd:Number(g.value_time[1]/1e3+86399)}),a.channelId="number"==typeof g.channelId?g.channelId:void 0,a.memberRole="number"==typeof g.memberRole?g.memberRole:void 0,s.get("/api/v1/customer/censor/agent_member/member/statistics",{params:a}).then((({data:e})=>{g.yh=e})).finally((()=>{g.refresh=!0}))},w=a({data:[]});t((()=>{T(),_(),s.get("/api/v1/customer/filter/member_channel").then((e=>{w.data=e.data})).finally((()=>{}))}));const T=async()=>{var e,a;E.loading=!0;let l={limit:E.pageSize,page:E.currentPage};if(""!=g.search&&(l.keyword=g.search),g.agentLevelId&&(l.agentLevelId=g.agentLevelId),g.memberRole&&(l.memberRole=g.memberRole),E.order){let e=E.order.split(",");l.orderName=e[0],l.orderSerial=e[1]}(null==(e=g.value_time)?void 0:e.length)>0&&(l.timeStart=g.value_time[0]/1e3,l.timeEnd=Number(g.value_time[1]/1e3+86399)),""!==g.channelId&&(l.channelId=g.channelId);var{data:t}=await s.get("/api/v1/customer/censor/agent_member/member/list",{params:l});E.tableData=null!=(a=t.list)?a:[],E.total=(null==t?void 0:t.total)||0,E.loading=!1},E=a({tableData:[],currentPage:1,pageSize:20,total:0,order:"",loading:!1,current(e){E.currentPage=e,T()},size(e){E.pageSize=e,E.currentPage=1,T()},sort(e){const{prop:a,order:l}=e;E.order=a&&l?`${a},${"descending"==l?"desc":"asc"}`:"",T()}}),Q=a({loading:!1,data:{},load:()=>(Q.loading=!0,s.get("/api/v1/customer/censor/agent_member/member/statistics",{params:{channelId:"number"==typeof g.channelId?g.channelId:void 0,memberRole:"number"==typeof g.memberRole?g.memberRole:void 0,xx:"xx"}}).then((({data:e})=>{Q.data=e})).finally((()=>{Q.loading=!1})))});Q.load();const{yh:G,search:J,value_time:X,channelId:Z,refresh:ee,memberRole:ae}=l(g),{total:le,currentPage:te,pageSize:ie,tableData:ne,loading:se}=l(E);return(e,a)=>{var l,t,i,n,s,g,I,j,ee,re,oe,Ye,Oe,Ee,We,He,qe,Qe,Ge,Je,Xe,Ze,ea,aa,la,ta,ia,na,sa,ra,oa,da,ua;const ca=C,va=z,ma=P,pa=B,ga=x,ya=k,ba=O,fa=U,ha=D,xa=K,_a=V,wa=M,Ia=N;return o(),d("div",ue,[p("div",ce,[p("div",ve,[p("div",me,[p("div",pe,[ge,u(va,{modelValue:v(ae),"onUpdate:modelValue":a[0]||(a[0]=e=>m(ae)?ae.value=e:null),onChange:a[1]||(a[1]=e=>{T(),Q.load(),_()}),clearable:"",placeholder:"所有用户身份"},{default:c((()=>[u(ca,{label:"会员",value:1}),u(ca,{label:"代理商",value:2})])),_:1},8,["modelValue"])]),p("div",ye,[be,u(va,{modelValue:v(Z),"onUpdate:modelValue":a[2]||(a[2]=e=>m(Z)?Z.value=e:null),onChange:a[3]||(a[3]=e=>{T(),Q.load(),_()}),clearable:"",filterable:"",placeholder:"所有渠道"},{default:c((()=>[u(ca,{label:"默认渠道",value:0}),(o(!0),d(b,null,F(w.data,(e=>(o(),S(ca,{label:e.name,value:e.id},null,8,["label","value"])))),256))])),_:1},8,["modelValue"])])])]),Q.data.totalMemberContinued?(o(),S(de,{key:0,list:Q.data.totalMemberContinued,load:Q.load},null,8,["list","load"])):A("",!0)]),p("div",fe,[p("div",he,[xe,p("div",_e,[p("div",we,[p("div",Ie,[p("div",Ce,[ze,p("p",null,[p("span",ke,y((null==(t=null==(l=v(G))?void 0:l.member)?void 0:t.total)||0),1)]),u(W,{type:0,color:"#86B0FB",title:"注册用户",text:null==(n=null==(i=v(G))?void 0:i.member)?void 0:n.registerUser,percentage:100*Number((null==(g=null==(s=v(G))?void 0:s.member)?void 0:g.registerUser)/(null==(j=null==(I=v(G))?void 0:I.member)?void 0:j.total))},null,8,["text","percentage"]),u(W,{type:1,style:{"margin-bottom":"4px"},text:null==(re=null==(ee=v(G))?void 0:ee.member)?void 0:re.tourists,color:"#A3EFD7",title:"游客",percentage:100*Number((null==(Ye=null==(oe=v(G))?void 0:oe.member)?void 0:Ye.tourists)/(null==(Ee=null==(Oe=v(G))?void 0:Oe.member)?void 0:Ee.total))},null,8,["text","percentage"]),u(W,{type:2,color:"#8694FB",title:"Web注册",text:null==(He=null==(We=v(G))?void 0:We.member)?void 0:He.registerWeb,percentage:100*Number((null==(Qe=null==(qe=v(G))?void 0:qe.member)?void 0:Qe.registerWeb)/(null==(Je=null==(Ge=v(G))?void 0:Ge.member)?void 0:Je.total))},null,8,["text","percentage"]),u(W,{type:3,color:"#FF9C39",title:"H5注册",text:null==(Ze=null==(Xe=v(G))?void 0:Xe.member)?void 0:Ze.registerMobile,percentage:100*Number((null==(aa=null==(ea=v(G))?void 0:ea.member)?void 0:aa.registerMobile)/(null==(ta=null==(la=v(G))?void 0:la.member)?void 0:ta.total))},null,8,["text","percentage"]),u(W,{type:4,color:"#A3E1EF",title:"APP注册",text:null==(na=null==(ia=v(G))?void 0:ia.member)?void 0:na.registerApp,percentage:100*Number((null==(ra=null==(sa=v(G))?void 0:sa.member)?void 0:ra.registerApp)/(null==(da=null==(oa=v(G))?void 0:oa.member)?void 0:da.total))},null,8,["text","percentage"])])]),p("div",De,[L(y(v(X)&&v(X)[0]?v(Y)(v(X)[0],"{y}-{m}-{d}")+"~":"")+" "+y(v(X)&&v(X)[1]?v(Y)(v(X)[1],"{y}-{m}-{d}")+"":"")+" ",1),u(ya,{placement:"bottom",width:350,trigger:"click",teleported:!1},{reference:c((()=>[u(pa,{class:"m-2",type:"primary",style:{"margin-left":"auto"},link:""},{default:c((()=>[u(ma,null,{default:c((()=>[L("筛选")])),_:1})])),_:1})])),default:c((()=>[p("div",Ke,[p("div",Ve,[p("div",Me,[Ne,u(ga,{class:"item",modelValue:v(X),"onUpdate:modelValue":a[4]||(a[4]=e=>m(X)?X.value=e:null),placement:"top","value-format":"x",onChange:a[5]||(a[5]=e=>{_(),T()}),teleported:!1,style:{width:"240px","--el-font-size-base":"12px"},type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"default"},null,8,["modelValue"])])])])])),_:1})])])])]),p("div",Fe,[Se,p("div",Ae,[p("div",Le,[p("div",Re,[$e,p("div",je,[p("div",Pe,[u(ba,{color:"#999",size:"14px",onClick:a[6]||(a[6]=e=>T()),name:"search"}),u(fa,{class:"seachInput",onKeyup:a[7]||(a[7]=R((e=>T()),["enter","native"])),placeholder:"搜索关键字",modelValue:v(J),"onUpdate:modelValue":a[8]||(a[8]=e=>m(J)?J.value=e:null)},null,8,["modelValue"])])])]),p("div",Be,[$((o(),S(xa,{onSortChange:E.sort,"tooltip-effect":"light",height:"38vh",data:v(ne)},{empty:c((()=>[Ue])),default:c((()=>[u(ha,{label:"用户名",prop:"username","min-width":"100",align:"left"},{default:c((({row:e})=>[u(H,{name:e.username,id:e.memberId},null,8,["name","id"])])),_:1}),u(ha,{label:"昵称",prop:"nickname",formatter:e.$formatter},null,8,["formatter"]),u(ha,{prop:"agentId",align:"left",label:"用户身份"},{default:c((({row:e})=>[L(y(null===e.agentId?"会员":"代理商"),1)])),_:1}),u(ha,{label:"推广渠道"},{default:c((({row:e})=>[p("span",null,y(e.channel?e.channel:e.channelId?e.channelId:"默认渠道"),1)])),_:1}),u(ha,{label:"会员分组",prop:""},{default:c((({row:e})=>[p("span",null,y(["-","普通","VIP","游客"][e.groupName]||"-"),1)])),_:1}),u(ha,{label:"注册类型",prop:"registerType",formatter:e.$formatter},null,8,["formatter"]),u(ha,{label:"活跃时间 ",width:"150",prop:"lastLoginAt",sortable:""},{default:c((({row:e})=>[p("span",null,y(v(Y)(e.lastLoginAt)||"-"),1)])),_:1}),u(ha,{label:"创建时间 ",width:"150",prop:"createAt",sortable:""},{default:c((({row:e})=>[p("span",null,y(v(Y)(e.createAt)||"-"),1)])),_:1}),u(ha,{label:"操作"},{default:c((({row:e})=>[u(pa,{type:"primary",onClick:a=>h.get(e),link:""},{default:c((()=>[L(" 聊天记录")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["onSortChange","data"])),[[Ia,v(se)]])]),p("div",Te,[u(_a,{onSizeChange:E.size,small:"",onCurrentChange:E.current,"current-page":v(te),"page-sizes":v(r).state.pageSizes,"page-size":v(ie),layout:"total, prev, pager, next, sizes, jumper",total:v(le)},null,8,["onSizeChange","onCurrentChange","current-page","page-sizes","page-size","total"])])])])]),u(wa,{modelValue:h.visible,"onUpdate:modelValue":a[9]||(a[9]=e=>h.visible=e),title:(null==(ua=h.client)?void 0:ua.username)+"的聊天记录","destroy-on-close":"","close-on-click-modal":!1,width:"880px"},{default:c((()=>[$(u(q,{ref_key:"messageList",ref:f,style:{height:"45vh"},class:"dis-list",client:h.client,chatList:h.chatList,slaveId:!1},null,8,["client","chatList"]),[[Ia,h.loading]])])),_:1},8,["modelValue","title"])])])}}};export{Ye as default};
