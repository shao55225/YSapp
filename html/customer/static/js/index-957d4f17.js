import{h as e,R as a,x as t,aM as l,aN as s,aH as o,o as i,c as r,w as n,a as u,e as d,d as c,u as p,B as m,g,I as f,J as v,aj as h,ak as b,aL as y,K as _,f as k,ad as V,A as w,D as C,al as x,am as z,ao as S,b as L,L as E,a3 as O,af as U,t as j,W as D,i as P,O as J,P as N}from"./.pnpm-9c274078.js";import{_ as R,a as $}from"./index-e716b57f.js";import{_ as q}from"./empty-6f66e897.js";const A={class:"content"},I={__name:"update",props:{visible:{type:Boolean,default:()=>!1}},emits:["update:visible","refreshDataList"],setup(w,{expose:C,emit:x}){const z=m(),{$http:S}=z.appContext.config.globalProperties,L=e({form:{},currObj:"add"}),{form:E,currObj:O}=a(L),U=t(null),j=async e=>{e?await U.value.validate((async(e,a)=>{var t,l;if(e){let e=JSON.parse(JSON.stringify(L.form));(null==(t=e.checkList)?void 0:t.indexOf(1))>=0&&(e.serviceEnable=1),(null==(l=e.checkList)?void 0:l.indexOf(2))>=0&&(e.clientEnable=1),"add"!=L.currObj&&(e.id=L.currObj),delete e.checkList,await S.post("/api/v1/customer/auto-service",e),g({position:"bottom-right",title:"提示",type:"success",message:"操作成功"}),x("update:visible",!1),x("refreshDataList")}})):(U.value&&U.value.resetFields(),x("update:visible",!1))};return C({init:(e,a)=>{L.form={status:1,sort:a+1},L.currObj=e,"add"!=e&&S.get(`/api/v1/customer/auto-service/${e}`).then((({data:e})=>{L.form={content:e.content,sort:e.sort,status:e.status,triggerEvent:e.triggerEvent,checkList:[]},1==e.serviceEnable&&L.form.checkList.push(1),1==e.clientEnable&&L.form.checkList.push(2)}))}}),(e,a)=>{const t=f,m=v,g=h,C=b,x=l,z=s,S=o,L=y,D=_,P=k,J=V;return i(),r(J,{"model-value":w.visible,"z-index":30,title:"add"==p(O)?"添加事件":"编辑事件","close-on-click-modal":!1,onClose:a[7]||(a[7]=e=>j(!1)),top:"20vh",width:"450px"},{footer:n((()=>[u(P,{size:"small",type:"default",onClick:a[5]||(a[5]=e=>j(!1))},{default:n((()=>[d("取消")])),_:1}),u(P,{type:"primary",size:"small",onClick:a[6]||(a[6]=e=>j(!0))},{default:n((()=>[d("保存")])),_:1})])),default:n((()=>[c("div",A,[u(D,{model:p(E),ref_key:"ruleFormRef",ref:U,"label-width":"60px"},{default:n((()=>[u(m,{label:"内容",prop:"content",rules:[{required:!0,whitespace:!0,message:"请输入内容",trigger:"blur"}]},{default:n((()=>[u(t,{modelValue:p(E).content,"onUpdate:modelValue":a[0]||(a[0]=e=>p(E).content=e),type:"textarea",rows:6,placeholder:"请输入内容"},null,8,["modelValue"])])),_:1}),u(m,{label:"事件",prop:"triggerEvent",rules:[{required:!0,message:"请选择事件",trigger:"change"}]},{default:n((()=>[u(C,{modelValue:p(E).triggerEvent,"onUpdate:modelValue":a[1]||(a[1]=e=>p(E).triggerEvent=e),placeholder:"请选择事件"},{default:n((()=>[u(g,{label:"客服接入",value:1}),u(g,{label:"转接",value:2}),u(g,{label:"服务结束",value:3})])),_:1},8,["modelValue"])])),_:1}),u(m,{label:"对象"},{default:n((()=>[u(z,{modelValue:p(E).checkList,"onUpdate:modelValue":a[2]||(a[2]=e=>p(E).checkList=e)},{default:n((()=>[u(x,{size:"small",label:1},{default:n((()=>[d("客服")])),_:1}),u(x,{size:"small",label:2},{default:n((()=>[d("用户")])),_:1})])),_:1},8,["modelValue"])])),_:1}),u(m,{label:"序号",prop:"sort",rules:[{required:!0,message:"请输入序号",trigger:"change"}]},{default:n((()=>[u(S,{modelValue:p(E).sort,"onUpdate:modelValue":a[3]||(a[3]=e=>p(E).sort=e),min:1,step:1,"step-strictly":"","controls-position":"right"},null,8,["modelValue"])])),_:1}),u(m,{label:"状态",prop:"status"},{default:n((()=>[u(L,{modelValue:p(E).status,"onUpdate:modelValue":a[4]||(a[4]=e=>p(E).status=e),"active-value":1,"inactive-value":2,size:"small"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["model-value","title"])}}},K={class:"container"},B={class:"filter"},F={class:"right"},H={class:"custom-input"},M=(e=>(J("data-v-aacb7ad1"),e=e(),N(),e))((()=>c("div",{class:"table-empty"},[c("img",{src:q,alt:"空状态"}),c("p",null,"暂无数据")],-1))),W={key:1},G={key:1},Q=R({__name:"index",setup(l){const s=w(),o=m(),{$http:v}=o.appContext.config.globalProperties,h=e({loading:!1,status:"",search:"",isUpdate:!1}),{loading:b,status:_,search:V,isUpdate:J}=a(h),N=t(null),R={changeStatus(e,a){v.post("/api/v1/customer/auto-service/status",{ids:[e],status:a}).then((e=>{let{data:a}=e;g({position:"bottom-right",title:"提示",type:"success",message:a||"操作成功"})}))},update(e){h.isUpdate=!0;let a=JSON.parse(JSON.stringify(e));D((()=>{N.value.init(a,A.total)}))},clickDel(e){P.confirm("确定删除此条数据吗？","确认").then((async()=>{var{data:a}=await v.delete("/api/v1/customer/auto-service",{data:{ids:[e]}});g({position:"bottom-right",title:"提示",type:"success",message:a||"操作成功"}),q()})).catch((()=>{}))}};C((()=>{q()}));const q=()=>{h.loading=!0;let e={limit:A.pageSize,page:A.currentPage};""!=h.search&&(e.keywords=h.search),v.get("/api/v1/customer/auto-service",{params:e}).then((e=>{let{data:a}=e;A.tableData=a.list,A.total=a.total,h.loading=!1}))},A=e({tableData:[],currentPage:1,pageSize:s.state.pageSize,total:0,multipleSelection:[],order:"",size(e){A.pageSize=e,A.currentPage=1,q()},current(e){A.currentPage=e,q()}}),{total:Q,currentPage:T,pageSize:X,tableData:Y}=a(A);return(e,a)=>{const t=k,l=$,s=f,o=x,m=y,g=z,v=S;return i(),L("div",K,[c("div",B,[u(t,{type:"primary",onClick:a[0]||(a[0]=e=>R.update("add"))},{default:n((()=>[d("新增事件")])),_:1}),c("div",F,[c("div",H,[u(l,{onClick:q,color:"#999",size:"14 px",name:"search"}),u(s,{class:"seachInput",placeholder:"搜索关键字",onKeyup:E(q,["enter","native"]),modelValue:p(V),"onUpdate:modelValue":a[1]||(a[1]=e=>O(V)?V.value=e:null)},null,8,["onKeyup","modelValue"])])])]),U((i(),r(g,{onSortChange:A.sort,"tooltip-effect":"light",height:"78vh",data:p(Y),style:{width:"100%"}},{empty:n((()=>[M])),default:n((()=>[u(o,{prop:"sort","min-width":"100",align:"left",label:"顺序"}),u(o,{label:"事件"},{default:n((({row:e})=>[c("span",null,j(["","客服接入","转接","服务结束"][e.triggerEvent]),1)])),_:1}),u(o,{label:"客服有效"},{default:n((({row:e})=>[1==e.serviceEnable?(i(),r(l,{key:0,name:"xuanzhong",color:"#52C41A"})):(i(),L("span",W,"-"))])),_:1}),u(o,{label:"用户有效"},{default:n((({row:e})=>[1==e.clientEnable?(i(),r(l,{key:0,name:"xuanzhong",color:"#52C41A"})):(i(),L("span",G,"-"))])),_:1}),u(o,{label:"状态"},{default:n((({row:e})=>[u(m,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,onChange:a=>R.changeStatus(e.id,e.status),"active-value":1,"inactive-value":2,size:"small"},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),u(o,{label:"内容","min-width":"250","show-overflow-tooltip":!0,prop:"content",formatter:e.$formatter},null,8,["formatter"]),u(o,{label:"操作",align:"right"},{default:n((({row:e})=>[u(t,{type:"primary",onClick:a=>R.update(e.id),link:""},{default:n((()=>[d("编辑")])),_:2},1032,["onClick"]),u(t,{type:"danger",onClick:a=>R.clickDel(e.id),link:""},{default:n((()=>[d("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["onSortChange","data"])),[[v,p(b)]]),u(I,{visible:p(J),"onUpdate:visible":a[2]||(a[2]=e=>O(J)?J.value=e:null),ref_key:"updateRef",ref:N,onRefreshDataList:a[3]||(a[3]=e=>q())},null,8,["visible"])])}}},[["__scopeId","data-v-aacb7ad1"]]);export{Q as default};
