import{h as e,a9 as t,D as o,at as a,au as n,av as i,o as s,b as r,d,t as l,Q as u,S as c}from"./.pnpm-9c274078.js";const p=e=>e+"_"+(Date.now()+Math.floor(1e6*Math.random())),m=()=>{const e="undefined"!=typeof window?window:global;return e&&"tinymce"in e?e.tinymce:null};function f(e){return e?e.getContent():""}function g(e,t){t&&t.setContent(e)}function b(e,t=!0){e&&e.mode.set(t?"readonly":"design")}function y(e,t,o,a,n){let i,s,{images_upload_url:r,images_upload_credentials:d,custom_images_upload_param:l,custom_images_upload_callback:u}=e||{};i=new XMLHttpRequest,i.withCredentials=!!d,i.open("POST",r||""),i.upload.onprogress=function(e){n(e.loaded/e.total*100)},i.onload=function(){if(403===i.status)return void a("HTTP Error (custom): status "+i.status,{remove:!0});if(i.status<200||i.status>=300)return void a("HTTP Error (custom): status "+i.status);let e=JSON.parse(i.responseText);if(!e)return void a("Invalid JSON (custom): "+i.responseText);let t="function"==typeof u?u(e):e.location;t?o(t):a("Failed Path (custom): location image path is error/empty")},i.onerror=function(){a("Image upload failed due to a XHR Transport error. Code: "+i.status)},s=new FormData,s.append("file",t.blob(),t.filename()),l&&Object.keys(l).forEach((e=>{s.append(e,l[e])})),i.send(s)}const h=(()=>{let e={status:{},loadedCallbacks:{}};const t=t=>{e.loadedCallbacks[t]&&(e.loadedCallbacks[t].forEach((e=>{"function"==typeof e.handler&&e.handler.call(e.scope)})),e.loadedCallbacks[t]=void 0)};return{load:(o,a,n)=>{a&&(e.loadedCallbacks[o]||(e.loadedCallbacks[o]=[]),e.loadedCallbacks[o].push({handler:a,scope:n||globalThis})),"LOADED"!==e.status[o]?"LOADING"!==e.status[o]&&(e.status[o]="LOADING",((e,t)=>{const o=document.createElement("script");o.id=p("tiny-script"),o.type="application/javascript",o.src=e,o.referrerPolicy="origin";const a=()=>{o.removeEventListener("load",a),t()};o.addEventListener("load",a),(document.head||document.body).appendChild(o)})(o,(()=>{e.status[o]="LOADED",t(o)}))):t(o)}}})(),v=["id"],_={key:0},C={name:"Vue3Tinymce"},k=Object.assign(C,{props:{modelValue:String,setting:{type:Object,default:()=>({})},setup:Function,disabled:Boolean,scriptSrc:String,debug:Boolean},emits:["update:modelValue","init","change"],setup(C,{expose:k,emit:D}){const O=C;let T=!0;const E=e({editor:null,id:p("tinymce"),err:""}),w=()=>{var e;return String(null!=(e=O.modelValue)?e:"")},S=(e,t,o)=>{O.debug},L=(e,t)=>{t||(t=E.editor);const o=f(t);S(),D("update:modelValue",o),D("change",o)},j=()=>{if(null===m())return void(E.err="tinymce is null");O.debug;let e={...O.setting,selector:"#"+E.id,setup:e=>{O.setup&&O.setup(e),e.on("init",(()=>(e=>{E.editor=e,g(w(),e),O.disabled&&"readonly"!==e.mode.get()&&b(e),e.on("change input undo redo",(t=>{L(0,e)})),D("init",e)})(e)))}};O.setting.custom_images_upload&&(e.images_upload_handler=(...e)=>{y.apply(null,[O.setting||{},...e])}),m().init(e),T=!1};return t((()=>O.modelValue),((e,t)=>{if(E.editor&&E.editor.initialized&&t!==e&&e!==f(E.editor)){if(S(),null===e)return function(e,t){if(t){if(t.resetContent)return t.resetContent(e);t.setContent(e),t.setDirty(!1),t.undoManager.clear()}}("",E.editor);g(w(),E.editor)}})),t((()=>O.disabled),(e=>{E.editor&&E.editor.initialized&&b(E.editor,e)})),k({id:E.id,editor:E.editor}),o((()=>{if(null!==m())return void j();h.load("./tinymce/tinymce.min.js",j)})),a((()=>{T||j()})),n((()=>{E.editor&&E.editor.remove()})),i((()=>{E.editor&&E.editor.remove()})),(e,t)=>(s(),r(c,null,[d("div",{id:E.id,class:"tiny-textarea"},null,8,v),E.err?(s(),r("p",_,l(E.err),1)):u("",!0)],64))}});export{k as _};
