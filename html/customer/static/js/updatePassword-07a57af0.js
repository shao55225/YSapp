import{A as e,a9 as a,x as l,h as o,R as s,aa as r,ab as t,o as d,c as u,w as p,d as m,t as i,a as n,e as f,u as c,Q as w,a5 as b,B as g,g as h,G as y,ac as v,I as _,J as V,K as k,$ as x,f as P,ad as I}from"./.pnpm-9c274078.js";import{_ as U}from"./index-e716b57f.js";const N=""+new URL("../png/empty-368eb144.png",import.meta.url).href,C={class:"content"},E=U({__name:"updatePassword",props:{visible:{type:Boolean,default:()=>!1},type:{type:Number,default:0}},emits:["update:visible"],setup(U,{emit:N}){const E=U,F=e(),R=g(),{$http:j}=R.appContext.config.globalProperties;a((()=>E.visible),(e=>{if(e){let e=F.getters.userInfo;B.form1={userName:e.userName,headImg:e.headImg,sex:e.sex,nickname:e.nickName}}}));const q=l(null),z={open(){q.value.click()},click(e){const a=e.target.files[0];if(!a)return;let l=new FormData;l.append("file",a),q.value=null,j.post("/api/v1/customer/upload/img",l).then((({data:e})=>{B.form1.headImg=e})).catch((e=>{h({position:"bottom-right",title:"提示",type:"error",message:"上传失败"})}))}},B=o({form:{confirmPassword:"",oldPassword:"",password:""},form1:{account:"test",headImg:"",sex:1,nickname:""},rules:{oldPassword:[{required:!0,trigger:"blur",validator:(e,a,l)=>(null==a?void 0:a.trim())?l():l(new Error("请输入旧密码"))}],password:[{required:!0,trigger:"blur",validator:(e,a,l)=>(null==a?void 0:a.trim())?l():l(new Error("请输入新密码"))},{min:6,max:20,message:"长度为6～20个字符",trigger:"blur"}],confirmPassword:[{required:!0,trigger:"blur",validator:(e,a,l)=>a!=B.form.password?l(new Error("两次密码不一致")):l()}]}}),{form:S,rules:$,form1:A}=s(B),D=l(null),G=e=>{e?D.value.validate(((e,a)=>{if(e){var l={oldPassword:y.exports(B.form.oldPassword),password:y.exports(B.form.password),confirmPassword:y.exports(B.form.confirmPassword)};j.put(1==E.type?"/api/v1/customer/user/info":"/api/v1/customer/user/password",1==E.type?v(B.form1):l).then((e=>{let{data:a}=e;1==E.type&&F.commit("SETUSERINFO",a),h({position:"bottom-right",title:"提示",type:"success",message:"修改成功"}),N("update:visible",!1)}))}})):(D.value&&D.value.resetFields(),N("update:visible",!1))};return(e,a)=>{const l=_,o=V,s=k,g=x,h=r,y=t,v=P,N=I;return d(),u(N,{"model-value":U.visible,"close-on-click-modal":!1,onClose:a[11]||(a[11]=e=>G(!1)),top:"30vh",width:"450px"},{header:p((()=>[m("span",null,i(0==U.type?"修改密码":"编辑资料"),1)])),footer:p((()=>[n(v,{size:"small",type:"default",onClick:a[9]||(a[9]=e=>G(!1))},{default:p((()=>[f("取消")])),_:1}),n(v,{type:"primary",size:"small",onClick:a[10]||(a[10]=e=>G(!0))},{default:p((()=>[f("保存")])),_:1})])),default:p((()=>[m("div",C,[0==U.type?(d(),u(s,{key:0,model:c(S),ref_key:"ruleFormRef",ref:D,rules:c($),"label-width":"85px"},{default:p((()=>[n(o,{prop:"oldPassword",label:"旧密码"},{default:p((()=>[n(l,{modelValue:c(S).oldPassword,"onUpdate:modelValue":a[0]||(a[0]=e=>c(S).oldPassword=e),type:"password","show-password":"",autocomplete:"off",placeholder:"请输入旧密码"},null,8,["modelValue"])])),_:1}),n(o,{label:"新密码",prop:"password"},{default:p((()=>[n(l,{modelValue:c(S).password,"onUpdate:modelValue":a[1]||(a[1]=e=>c(S).password=e),autocomplete:"off",type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])])),_:1}),n(o,{label:"确认新密码",prop:"confirmPassword"},{default:p((()=>[n(l,{modelValue:c(S).confirmPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>c(S).confirmPassword=e),autocomplete:"off",type:"password",placeholder:"确认新密码","show-password":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])):w("",!0),1==U.type?(d(),u(s,{key:1,model:c(A),ref_key:"ruleFormRef",ref:D,"label-width":"60px"},{default:p((()=>[n(o,{label:"头像"},{default:p((()=>[n(g,{icon:c(b),style:{cursor:"pointer"},size:45,onClick:a[3]||(a[3]=e=>z.open()),src:c(A).headImg},null,8,["icon","src"]),m("input",{ref_key:"uploadInput",ref:q,style:{display:"none"},type:"file",accept:".jpg, .jpeg, .png",onChange:a[4]||(a[4]=(...e)=>z.click&&z.click(...e))},null,544)])),_:1}),n(o,{label:"头像地址"},{default:p((()=>[n(l,{modelValue:c(A).headImg,"onUpdate:modelValue":a[5]||(a[5]=e=>c(A).headImg=e),placeholder:"请输入头像地址"},null,8,["modelValue"])])),_:1}),n(o,{label:"账号"},{default:p((()=>[n(l,{modelValue:c(A).userName,"onUpdate:modelValue":a[6]||(a[6]=e=>c(A).userName=e),disabled:""},null,8,["modelValue"])])),_:1}),n(o,{label:"昵称"},{default:p((()=>[n(l,{modelValue:c(A).nickname,"onUpdate:modelValue":a[7]||(a[7]=e=>c(A).nickname=e),placeholder:"确认昵称"},null,8,["modelValue"])])),_:1}),n(o,{label:"性别"},{default:p((()=>[n(y,{modelValue:c(A).sex,"onUpdate:modelValue":a[8]||(a[8]=e=>c(A).sex=e)},{default:p((()=>[n(h,{label:1},{default:p((()=>[f("男")])),_:1}),n(h,{label:2},{default:p((()=>[f("女")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])):w("",!0)])])),_:1},8,["model-value"])}}},[["__scopeId","data-v-04bbedf4"]]);export{N as _,E as u};
