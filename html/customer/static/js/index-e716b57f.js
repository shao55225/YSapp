var e,t,s,n,o=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},i=(e,t,s)=>(o(e,t,"read from private field"),s?s.call(e):t.get(e)),a=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},r=(e,t,s,n)=>(o(e,t,"write to private field"),n?n.call(e,s):t.set(e,s),s),c=(e,t,s)=>(o(e,t,"access private method"),s);import{r as l,E as d,o as u,c as m,w as p,a as g,u as f,z as h,b as _,d as v,t as y,e as I,f as w,g as S,h as x,i as b,j as E,k as L,l as k,m as C,n as O,p as N,q as R,s as T,v as A}from"./.pnpm-9c274078.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const j={__name:"App",setup(e){const t=h;return(e,s)=>{const n=l("router-view"),o=d;return u(),m(o,{locale:f(t)},{default:p((()=>[g(n)])),_:1},8,["locale"])}}},D={},P=function(e,t,s){if(!t||0===t.length)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map((e=>{if(e=function(e,t){return new URL(e,t).href}(e,s),e in D)return;D[e]=!0;const t=e.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(!!s)for(let s=n.length-1;s>=0;s--){const o=n[s];if(o.href===e&&(!t||"stylesheet"===o.rel))return}else if(document.querySelector(`link[href="${e}"]${o}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":"modulepreload",t||(i.as="script",i.crossOrigin=""),i.href=e,document.head.appendChild(i),t?new Promise(((t,s)=>{i.addEventListener("load",t),i.addEventListener("error",(()=>s(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e()))};function M(e,t="{y}-{m}-{d} {h}:{i}"){if(0===arguments.length||!e)return null;const s=t||"{y}-{m}-{d} {h}:{i}:{s}";let n;"object"==typeof e?n=e:("string"==typeof e&&(e=/^[0-9]+$/.test(e)?parseInt(e):e.replace(new RegExp(/-/gm),"/")),"number"==typeof e&&e.toString().length<=10&&(e*=1e3),n=new Date(e));const o={y:n.getFullYear(),m:n.getMonth()+1,d:n.getDate(),h:n.getHours(),i:n.getMinutes(),s:n.getSeconds(),a:n.getDay()};return s.replace(/{([ymdhisa])+}/g,((e,t)=>{const s=o[t];return"a"===t?["日","一","二","三","四","五","六"][s]:s.toString().padStart(2,"0")}))}const q=e=>"Boolean"===Object.prototype.toString.call(e).slice(8,-1),J=e=>"Object"===Object.prototype.toString.call(e).slice(8,-1),$=e=>"Array"===Object.prototype.toString.call(e).slice(8,-1),B={setLocal:(e,t)=>{$(t)||J(t)||q(t)?window.localStorage.setItem(e,JSON.stringify(t)):window.localStorage.setItem(e,t)},getLocal:e=>{let t=window.localStorage.getItem(e);return t?JSON.parse(t):t},clearOneLocal:e=>{window.localStorage.removeItem(e)},clearAllLocal:()=>{const e=B.getLocal("indexDBStore");window.localStorage.clear(),B.setLocal("indexDBStore",JSON.stringify(e))},setSession:(e,t)=>{$(t)||J(t)||q(t)?window.sessionStorage.setItem(e,window.btoa(window.encodeURIComponent(JSON.stringify(t)))):window.sessionStorage.setItem(e,window.btoa(window.encodeURIComponent(t)))},appendSession:(e,t)=>{let s=window.sessionStorage.getItem(e);if(s){let n=JSON.parse(s),o=Object.assign(n,t);window.sessionStorage.setItem(e,JSON.stringify(o))}else window.sessionStorage.setItem(e,JSON.stringify(t))},getSession:e=>{let t=window.sessionStorage.getItem(e);if(!t)return t;try{return $(JSON.parse(window.decodeURIComponent(window.atob(t))))||J(JSON.parse(window.decodeURIComponent(window.atob(t))))?JSON.parse(window.decodeURIComponent(window.atob(t))):"true"==window.decodeURIComponent(window.atob(t))||"false"!=window.decodeURIComponent(window.atob(t))&&window.decodeURIComponent(window.atob(t))}catch(s){return window.decodeURIComponent(window.atob(t))}},clearOneSession:e=>{window.sessionStorage.removeItem(e)},clearAllSession:()=>{window.sessionStorage.clear()}};function U(e,t,s="list"){if(!t)return e;for(var n=[],o=[],i=0;i<e.length;i++){var a=e[i];if(-1===n.indexOf(a[t])){var r={};r[s]=[a],r[t]=a[t],o.push(r),n.push(a[t])}else{o[n.indexOf(a[t])][s].push(a)}}return o}function V(e){const t=e=>{var t=e;return 1==e.toString().length&&(t="0"+e),t};var s=new Date,n=s.getTime()+864e5*e;s.setTime(n);var o=s.getFullYear(),i=s.getMonth(),a=s.getDate();return o+"-"+(i=t(i+1))+"-"+(a=t(a))}const z="csToken";function H(){return window.sessionStorage.getItem(z)}function G(e){return window.sessionStorage.setItem(z,e)}function Q(){return window.sessionStorage.removeItem(z)}const W=(e,t)=>{const s=e.__vccOpts||e;for(const[n,o]of t)s[n]=o;return s},F={class:"message"},Y={class:"footer"},K=W({__name:"transferNotice",props:{message:{type:String,default:""},close:{type:Function}},setup:e=>(t,s)=>{const n=w;return u(),_("div",null,[v("p",F,y(e.message),1),v("div",Y,[g(n,{size:"small",type:"default",onClick:s[0]||(s[0]=t=>e.close(!1))},{default:p((()=>[I("拒绝接入")])),_:1}),g(n,{type:"primary",size:"small",onClick:s[1]||(s[1]=t=>e.close(!0))},{default:p((()=>[I("立即接入")])),_:1})])])}},[["__scopeId","data-v-d4e911c8"]]),X={class:"message"},Z=W({__name:"transferMes",props:{message:{type:String,default:""},close:{type:Function}},setup:e=>(t,s)=>{const n=w;return u(),_("div",null,[v("p",X,[I(y(e.message)+" ",1),g(n,{type:"primary",link:"",onClick:s[0]||(s[0]=t=>e.close(!0))},{default:p((()=>[I("立即接入")])),_:1}),g(n,{type:"danger",link:"",onClick:s[1]||(s[1]=t=>e.close(!1))},{default:p((()=>[I("拒绝接入")])),_:1})])])}},[["__scopeId","data-v-fb2c5716"]]),ee=""+new URL("../mp3/newmsg-4d750cc5.mp3",import.meta.url).href;e=new WeakMap,t=new WeakMap,s=new WeakSet,n=function(s){var n;return null==(n=i(this,e))?void 0:n.transaction(i(this,t),s).objectStore(i(this,t))};let te,se=document.createElement("audio");se.src=ee,se.style.display="none",document.body.appendChild(se);const ne=new class{constructor(n){if(a(this,s),a(this,e,void 0),a(this,t,"messageList"),!window.indexedDB)throw new Error("当前浏览器不支持indexedDB");{let s=window.indexedDB.open(n,1);s.onerror=e=>{},s.onsuccess=t=>{r(this,e,s.result)},s.onupgradeneeded=n=>{var o;if(r(this,e,s.result),!(null==(o=i(this,e))?void 0:o.objectStoreNames.hasOwnProperty(i(this,t)))){let s=i(this,e).createObjectStore(i(this,t),{keyPath:"mid"});s.createIndex("mid","mid",{unique:!0}),s.createIndex("type","type",{unique:!1}),s.createIndex("content","content",{unique:!1}),s.createIndex("category","category",{unique:!1}),s.createIndex("time","time",{unique:!1}),s.createIndex("prevMid","prevMid",{unique:!1})}}}}get(){return new Promise(((e,t)=>{var o;let i=null==(o=c(this,s,n).call(this,"readonly"))?void 0:o.getAll();i?i.onsuccess=()=>{e((null==i?void 0:i.result)||[])}:e([])}))}set(e,t){var o;null==(o=c(this,s,n).call(this,"readwrite"))||o.add({mid:e.mid,type:e.type,content:e.content,category:e.category,time:e.attach.time,prevMid:t})}}("sss");function oe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function ie(e,t=[]){let s="";return e?t.includes("close")||!0!==e.close||(s="当前聊天已关闭"):s="当前未接入聊天，请点击左侧选择客户",s&&S({position:"bottom-right",title:"提示",type:"error",message:s}),!!s}const ae=[{path:"/home",name:"HomePage",meta:{title:"首页概况",icon:"shouye"},component:()=>P((()=>import("./index-12b26551.js")),["./index-12b26551.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","./userinfo-2d757c21.js","../css/userinfo-2959ce32.css","./mesList-6e63e858.js","../css/mesList-baf4b6f1.css","./tiny-d6f4af2f.js","../css/index-cf9840e2.css"],import.meta.url)},{path:"/service",name:"Service",meta:{title:"我的工作台",icon:"kefugongzuotai"},component:()=>P((()=>import("./index-6027da85.js")),["./index-6027da85.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","./updatePassword-07a57af0.js","../css/updatePassword-ec48af6a.css","./tiny-d6f4af2f.js","./update-8ac83b51.js","../css/index-dabf3072.css"],import.meta.url)},{path:"/clientList",name:"ClientList",meta:{title:"客服列表",icon:"kefuliebiao"},component:()=>P((()=>import("./index-f0f6e129.js")),["./index-f0f6e129.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","./mesList-6e63e858.js","../css/mesList-baf4b6f1.css","../css/index-7967c571.css"],import.meta.url)},{path:"/client",name:"Client",meta:{title:"客户列表",icon:"kehuliebiao"},component:()=>P((()=>import("./index-286f6f5f.js")),["./index-286f6f5f.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","./mesList-6e63e858.js","../css/mesList-baf4b6f1.css","../css/index-b868a3aa.css","../css/userinfo-2959ce32.css"],import.meta.url)},{path:"/welcome",name:"Welcome",meta:{title:"自动回复",icon:"huanyingyushezhi"},component:()=>P((()=>import("./index-80820b9b.js")),["./index-80820b9b.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","../css/index-7273791d.css"],import.meta.url)},{path:"/common",name:"Common",meta:{title:"常见用语",icon:"changyongyushezhi"},component:()=>P((()=>import("./index-3d701a98.js")),["./index-3d701a98.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","../css/index-3ff4a77e.css"],import.meta.url)},{path:"/question",name:"Question",meta:{title:"常见问题",icon:"changjianwentishezhi"},component:()=>P((()=>import("./index-fdd1fb6f.js")),["./index-fdd1fb6f.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","./update-8ac83b51.js","./tiny-d6f4af2f.js","../css/index-96470aef.css"],import.meta.url)},{path:"/auto",name:"Auto",meta:{title:"智能服务",icon:"zidongfuwushezhi"},component:()=>P((()=>import("./index-957d4f17.js")),["./index-957d4f17.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","../css/index-0f91dfc2.css"],import.meta.url)},{path:"/note",name:"Note",meta:{title:"如何接入",icon:"ruhejieru"},component:()=>P((()=>import("./index-ca2467f4.js")),["./index-ca2467f4.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","../css/index-40cf22b7.css"],import.meta.url)}],re=[{path:"/survey",name:"Survey",meta:{title:"数据概况",icon:"shujugaikuang"},component:()=>P((()=>import("./index-d252e6a3.js")),["./index-d252e6a3.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./line3-2ad34cba.js","../css/line3-f726775b.css","./bar-9b969fb5.js","../css/bar-87d20f42.css","../css/index-d581f6f4.css","../css/line-f684ef35.css"],import.meta.url)},{path:"/recharge",name:"Recharge",meta:{title:"充值数据",icon:"chongzhishuju"},component:()=>P((()=>import("./index-d1be8821.js")),["./index-d1be8821.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","./pie-ea325c1c.js","./line2-83ec5b8b.js","../css/line2-b2e735f6.css","./userinfo-2d757c21.js","../css/userinfo-2959ce32.css","../css/index-cc423abd.css"],import.meta.url)},{path:"/withdraw",name:"Withdraw",meta:{title:"提现数据",icon:"tixianshuju"},component:()=>P((()=>import("./index-2c6d4fa8.js")),["./index-2c6d4fa8.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","./pie-ea325c1c.js","./line2-83ec5b8b.js","../css/line2-b2e735f6.css","./mesList-6e63e858.js","../css/mesList-baf4b6f1.css","./userinfo-2d757c21.js","../css/userinfo-2959ce32.css","../css/index-08f7158d.css"],import.meta.url)},{path:"/brokerage",name:"Brokerage",meta:{title:"分佣数据",icon:"fenyongshuju"},component:()=>P((()=>import("./index-10cc0a9c.js")),["./index-10cc0a9c.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","./cprogress-89103bb1.js","../css/cprogress-52ca73aa.css","./line2-83ec5b8b.js","../css/line2-b2e735f6.css","./userinfo-2d757c21.js","../css/userinfo-2959ce32.css","../css/index-5a36fbd8.css"],import.meta.url)},{path:"/examClientList",name:"ExamClientList",meta:{title:"客服数据",icon:"kefuliebiao",exam:!0},component:()=>P((()=>import("./index-ee023c0e.js")),["./index-ee023c0e.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","./cprogress-89103bb1.js","../css/cprogress-52ca73aa.css","./bar-9b969fb5.js","../css/bar-87d20f42.css","./index-f0f6e129.js","./mesList-6e63e858.js","../css/mesList-baf4b6f1.css","../css/index-7967c571.css","../css/index-31a35d4f.css","../css/userinfo-2959ce32.css"],import.meta.url)},{path:"/member",name:"Member",meta:{title:"会员数据",icon:"yonghushuju"},component:()=>P((()=>import("./index-f9d04236.js")),["./index-f9d04236.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","./cprogress-89103bb1.js","../css/cprogress-52ca73aa.css","./userinfo-2d757c21.js","../css/userinfo-2959ce32.css","./mesList-6e63e858.js","../css/mesList-baf4b6f1.css","../css/index-fa3168ef.css","../css/line-f684ef35.css"],import.meta.url)},{path:"/agent",name:"Agent",meta:{title:"代理数据",icon:"dailishuju"},component:()=>P((()=>import("./index-fd27a78b.js")),["./index-fd27a78b.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","./userinfo-2d757c21.js","../css/userinfo-2959ce32.css","../css/index-30c4d795.css"],import.meta.url)},{path:"/gold",name:"Gold",meta:{title:"金币数据",icon:"jinbishuju"},component:()=>P((()=>import("./index-58e8471d.js")),["./index-58e8471d.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","./empty-6f66e897.js","./pie-ea325c1c.js","./line3-2ad34cba.js","../css/line3-f726775b.css","./mesList-6e63e858.js","../css/mesList-baf4b6f1.css","./userinfo-2d757c21.js","../css/userinfo-2959ce32.css","../css/index-2b1ddf43.css"],import.meta.url)}],ce=E({modules:{socket:{state:()=>({audio:"0"!==localStorage.getItem("serAudio"),currentClient:void 0,id:"",soc:void 0,queue:new Map,list:new Map,untreated:new Map,intersectionObserver:void 0,host:location.host,status:"ready",messageEvents:new Map,autoReply:[],onMessageEvent:new Set,autoReplyQueue:new Map,transferNotification:[]}),getters:{currentClient:e=>e.currentClient},actions:{switchClient({dispatch:e,commit:t,getters:s,rootGetters:n,state:o},i){var a;o.currentClient!==i&&(o.currentClient&&(null==(a=o.intersectionObserver)||a.disconnect()),i.mesList=[],o.currentClient=i,sessionStorage.setItem("consultId",i.consultId),sessionStorage.setItem("consultSiteId",i.siteId),t("sortList"))},initQueueSoc({dispatch:e,commit:t,getters:s,rootGetters:n,state:o},i,a=2){const r=new WebSocket(`${"https:"===location.protocol?"wss":"ws"}://${o.host}/api/v1/customer/ws`);o.soc=r,o.id=i,r.addEventListener("message",(s=>{var i,a,r,c,l,d,u,m,p,f,h,_,v,y;const I=JSON.parse(s.data),w=(null==I?void 0:I.consult_id)&&o.list.get(I.consult_id)||o.currentClient;switch(o.onMessageEvent.forEach((e=>{try{e(I)}catch{}})),I.type){case 1:o.status="binding",0===I.code?null==(i=o.messageEvents.get(I.mid))||i.res(I):(I.message&&S({position:"bottom-right",type:"error",message:I.message}),null==(a=o.messageEvents.get(I.mid))||a.rej(I));break;case 2:if(o.messageEvents.get(I.mid))0===I.code?null==(r=o.messageEvents.get(I.mid))||r.res(I):null==(c=o.messageEvents.get(I.mid))||c.rej(I);else if(7!==I.category){const s={attach:{time:(null==(l=I.attach)?void 0:l.time)||(new Date).getTime()},masterHeadImg:(null==w?void 0:w.headImg)||"",category:I.category,mid:I.mid,content:I.content,msgId:I.msg_id,receiverId:I.receiver_id,senderId:I.sender_id,receiverRole:2,senderRole:I.receiver_id!==o.id?2:1,type:2,sendAt:(null==(d=I.attach)?void 0:d.time)||I.sendAt||0,read:0,consultId:I.consult_id,sendStatus:"success"};w.content=s.content,w.category=s.category,w.read=s.read,w.senderId=s.sender_id,w.sendAt=(null==(u=I.attach)?void 0:u.time)?null==(m=I.attach)?void 0:m.time:w.sendAt,I.receiver_id===o.id&&(w.unReadCount+=1),w.mesList.push(s),t("sortList"),e("setAutoReply",w),te&&clearTimeout(te),t("playAudio")}break;case 700:let s=o.list.get(I.consult_id)||o.queue.get(I.consult_id)||o.untreated.get(I.consult_id);s&&(s.online=I.online,!1===I.online&&o.queue.get(I.consult_id)?(o.untreated.set(I.consult_id,o.queue.get(I.consult_id)),o.queue.delete(I.consult_id)):!0===I.online&&o.untreated.get(I.consult_id)&&(o.queue.set(I.consult_id,o.untreated.get(I.consult_id)),o.untreated.delete(I.consult_id)));break;case 701:o.queue.set(I.data.consultId,{...I.data,mesList:[]});break;case 703:w.mesList.forEach((e=>{e.mid===I.mid&&(e.read=1)}));break;case 704:let x={consultId:I.consult_id,masterAvatar:I.master_avatar,masterId:I.master_id,masterNickname:I.master_nickname,masterUsername:I.master_username,mid:I.mid,slaveAvatar:I.slave_avatar,slaveId:I.slave_id,slaveNickname:I.slave_nickname,slaveNsername:I.slave_username},E=`客服${x.slaveNickname||x.slaveNsername}将客户\n            ${x.masterNickname||x.masterUsername} 的对话转接给了您`,L=o.transferNotification.length,k=S({title:"转接通知",duration:0,onClose(){if("svg"!==window.event.target.tagName)return;let e=o.transferNotification.splice(L,1)[0];e&&n.notice.unshift(e)},message:g(K,{message:E,close:t=>{if(b.close(),t){let t=oe();o.soc.send(JSON.stringify({attach:{},consult_id:x.consultId,feedback:1,mid:t,reason:"",type:6})),k.close(),o.messageEvents.set(t,{res(t){t.data.mesList=[],o.list.set(t.data.consultId,t.data),e("switchClient",t.data),de.push("/service")},rej(e){}})}else C.messageBoxClass="conI"+x.consultId,b.alert('<textarea rows="6" id="rejTransfer" style="width:332px;outline: none;border-color: #D8D8D8;color: #333333;font-size: 12px;border-radius: 4px;padding: 4px 12px;">我现在比较繁忙，请转接给其他客服</textarea>',"Tip",{confirmButtonText:"确认",cancelButtonText:"取消",title:"拒绝接入原因",customClass:C.messageBoxClass,dangerouslyUseHTMLString:!0}).then((()=>{let e=document.querySelector("#rejTransfer").value;k.close(),o.soc.send(JSON.stringify({attach:{},consult_id:x.consultId,feedback:2,mid:oe(),reason:e,type:6}))})).catch((()=>{}))}})}),C={title:"转接通知",message:g(Z,{message:E,close:t=>{if(b.close(),t){let t=oe();o.soc.send(JSON.stringify({attach:{},consult_id:x.consultId,feedback:1,mid:t,reason:"",type:6})),k.close(),o.messageEvents.set(t,{res(t){t.data.mesList=[],o.list.set(t.data.consultId,t.data);let s=n.notice.findIndex((e=>e.consultId===t.data.consultId));s>-1&&n.notice.splice(s,1),e("switchClient",t.data),de.push("/service")},rej(e){}})}else C.messageBoxClass="conI"+x.consultId,b.alert('<textarea rows="6" id="rejTransfer" style="width:332px;outline: none;border-color: #D8D8D8;color: #333333;font-size: 12px;border-radius: 4px;padding: 4px 12px;">我现在比较繁忙，请转接给其他客服</textarea>',"Tip",{confirmButtonText:"确认",cancelButtonText:"取消",title:"拒绝接入原因",customClass:C.messageBoxClass,dangerouslyUseHTMLString:!0}).then((()=>{let e=document.querySelector("#rejTransfer").value,t=n.notice.findIndex((e=>e.consultId===x.consultId));t>-1&&n.notice.splice(t,1),o.soc.send(JSON.stringify({attach:{},consult_id:x.consultId,feedback:2,mid:oe(),reason:e,type:6}))})).catch((()=>{}))}}),consultId:x.consultId,notice:k};if(o.transferNotification.push(C),o.transferNotification.length>=3){let e=o.transferNotification.splice(0,1);null==(p=e[0].notice)||p.close(),n.notice.unshift(e[0]),window.aaaaaa=n.notice}t("playAudio");break;case 707:if(o.transferNotification=o.transferNotification.filter(((e,t)=>{var s;if(e.consultId===I.consult_id){if(null==(s=e.notice)||s.close(),null==e?void 0:e.messageBoxClass){let t=document.querySelector("."+e.messageBoxClass);document.body.removeChild(null==t?void 0:t.parentNode.parentNode)}return!1}return!0})),t("setNotice",n.notice.filter(((e,t)=>{if(e.consultId===I.consult_id){if(null==e?void 0:e.messageBoxClass){let t=document.querySelector("."+e.messageBoxClass);document.body.removeChild(null==t?void 0:t.parentNode.parentNode)}return!1}return!0}))),o.transferNotification.push({title:"取消转接",message:`${I.slave_nickname||I.slave_username}取消了对话转接`,consultId:I.consult_id,notice:S({title:"取消转接",onClose(){o.transferNotification.splice(o.transferNotification.length,1)},message:`${I.slave_nickname||I.slave_username}取消了对话转接`})}),o.transferNotification.length>=3){let e=o.transferNotification.splice(0,1);null==(f=e[0].notice)||f.close(),n.notice.unshift(e[0])}break;case 705:if(1===I.feedback)o.list.delete(I.consult_id),o.currentClient.consultId===I.consult_id&&(o.currentClient=void 0),S({title:"转接通知",type:"success",message:"对话转接成功"});else{let e=`对话转接已被${I.confirm_transfer_slave_nickname||I.confirm_transfer_slave_username}拒绝${I.reason?":"+I.reason:""}`;o.currentClient.status=1;let s=o.transferNotification.length;if(o.transferNotification.push({message:e,title:"转接通知",consultId:I.consult_id,notice:S({title:"转接通知",type:"error",duration:0,message:e,onClose(){o.transferNotification.splice(s,1)}})}),o.transferNotification.length>=3){let e=o.transferNotification.splice(0,1);null==(h=e[0].notice)||h.close(),n.notice.unshift(e[0])}(null==(_=o.list.get(I.consult_id))?void 0:_.transferSlaveId)&&(o.list.get(I.consult_id).transferSlaveId=""),t("playAudio")}break;case 709:o.queue.delete(I.consult_id),o.untreated.delete(I.consult_id);break;case 711:o.queue.delete(I.consult_id),o.untreated.delete(I.consult_id);default:0===I.code?null==(v=o.messageEvents.get(I.mid))||v.res(I):null==(y=o.messageEvents.get(I.mid))||y.rej(I)}o.messageEvents.delete(I.mid)})),r.addEventListener("open",(()=>{clearInterval(window.opepSoc);let t=oe();o.messageEvents.set(t,{res:e=>{o.status="connecting",document.onvisibilitychange=function(){if("hidden"===document.visibilityState){if("connecting"!=o.status)return;window.servicesHeartbeats=setInterval((()=>{var e;"connecting"!=o.status&&clearInterval(window.servicesHeartbeats),null==(e=o.soc)||e.send(JSON.stringify({attach:{time:(new Date).getTime()},content:"",mid:oe(),type:999}))}),6e4)}else clearInterval(window.servicesHeartbeats)}},rej:e=>{alert("用户绑定失败"),o.status="error"}}),r.send(JSON.stringify({account_id:i,attach:{},bind_role:2,mid:t,type:1})),e("getAssideData"),e("getTransferList")})),r.addEventListener("close",(()=>{var e;null==(e=o.soc.autoReplyQueue)||e.clear(),window.opepSoc=setInterval((()=>{if((!store.state.socket.soc||3===store.state.socket.soc.readyState)&&3!=ce.getters.userInfo.role)try{store.dispatch("initQueueSoc",ce.getters.userInfo.uuid)}catch{}}),2e3)}))},send:function({dispatch:e,commit:t,getters:s,rootGetters:n,state:o},{v:i,type:a,room:r,uploadFn:c,isAuto:l}){var d;r||(r=o.currentClient);let u=oe();if(!r&&ie(o.currentClient))return;if(3===o.soc.readyState)return void S({position:"bottom-right",title:"提示",type:"error",message:"通讯已关闭"});if(!i)return;const m={attach:{readStatus:!1,time:(new Date).getTime()},receiver_id:r.userId,content:i,category:a,mid:u,slaveHeadImg:n.userInfo.headImg,receiverRole:1,senderRole:2,senderId:o.id,receiver_role:1,sender_id:o.id,type:2,read:0,sendStatus:"pending"};r.content=m.content,r.category=m.category,r.read=1,r.senderId=m.sender_id,r.sendAt=null==(d=m.attach)?void 0:d.time,2!==a&&3!==a&&o.soc.send(JSON.stringify(m)),r.mesList.length,o.messageEvents.set(u,{res:e=>{var t;m.sendStatus="success",m.msgId=e.data,!0!==l&&(null==(t=o.autoReplyQueue.get(r.consultId))||t.forEach((e=>clearTimeout(e.timeout))))},rej:e=>{var t;2===e.code&&ne.set(m,(null==(t=r.mesList.at(-2))?void 0:t.mid)||""),m.sendStatus="fail"}}),t("sortList"),r.mesList.push(m)},cancleTransfer:({state:e},{receiver_id:t,consult_id:s})=>{let n=oe();e.soc.send(JSON.stringify({attach:{},consult_id:s,mid:n,type:7})),e.messageEvents.set(n,{res(t){e.currentClient.status=1,e.currentClient.transferSlaveId=""},rej(e){}})},transfer({dispatch:e,commit:t,getters:s,state:n,rootGetters:o},{customer:i}){if(ie(n.currentClient,["online"]))return;let a=oe();n.soc.send(JSON.stringify({attach:{},consult_id:n.currentClient.consultId,from_account_id:n.id,mid:a,to_account_id:i.uuid,type:5})),n.messageEvents.set(a,{res(e){n.currentClient.status=4,n.currentClient.transferSlaveId=i.uuid},rej(e){}})},addClient:({dispatch:e,commit:t,getters:s,rootGetters:n,state:o},{client:i,type:a})=>new Promise(((t,s)=>{let n=oe();o.soc.send(JSON.stringify({attach:{},consult_id:i.consultId,mid:n,slave_access_type:a||1,type:4})),o.messageEvents.set(n,{res:s=>{const n=x(i);o.list.set(n.consultId,n),o.queue.delete(n.consultId),i.senderId!==i.userId&&""!==i.senderId||e("setAutoReply",i),t(n)},rej:e=>{s(e)}})})),setAutoReply({state:e,dispatch:t},s){var n;null==(n=e.autoReplyQueue.get(s.consultId))||n.forEach((e=>clearTimeout(e.timeout))),e.autoReplyQueue.set(s.consultId,e.autoReply.map((e=>{let n={v:e.content,id:e.id,getV:function(){return this.v},timeout:setTimeout((()=>{t("send",{v:n.getV(),type:1,room:s,isAuto:!0})}),6e4*e.timeout)};return n})))},initObserver({state:e}){var t;null==(t=e.intersectionObserver)||t.disconnect(),e.intersectionObserver=new IntersectionObserver((t=>{const s=t.filter((e=>e.isIntersecting)).map((t=>(e.intersectionObserver.unobserve(t.target),t.target.dataset.mes))),n=e.currentClient.mesList.filter((e=>s.includes(e.mid)));if(n.length<=0)return;let o=oe();e.soc.send(JSON.stringify({attach:{},mid:o,msg_id:n.map((e=>String(e.msgId))).filter((e=>e)),type:3}));let i=e.currentClient;e.messageEvents.set(o,{res(e){n.forEach((e=>e.read=1)),i.unReadCount-=n.length,i.unReadCount=i.unReadCount>0?i.unReadCount:0},rej(e){}})}),{root:document.querySelector("#serviceMessageList")})},getAssideData({state:e,dispatch:t}){const s=ye.config.globalProperties.$http;t("updateAutoreply").then((()=>{s.get("/api/v1/customer/customer/online/chatting").then((({data:s})=>{s.sort(((e,t)=>e.sendAt-t.sendAt>0?-1:0)).forEach((t=>{e.list.set(t.consultId,{...t,mesList:[]})}));let n=sessionStorage.getItem("consultId");n&&e.list.get(n)&&t("switchClient",e.list.get(n)),e.list.forEach((e=>{e.senderId!==e.userId&&""!==e.senderId||t("setAutoReply",e)}))}))})),s.get("/api/v1/customer/customer/online/leave").then((({data:t})=>t.sort(((e,t)=>e.sendAt-t.sendAt>0?-1:0)).forEach((t=>{t.online?e.queue.set(t.consultId,{...t,mesList:[]}):e.untreated.set(t.consultId,{...t,mesList:[]})})))),s.get("/api/v1/customer/customer/online/waiting").then((({data:t})=>t.sort(((e,t)=>e.sendAt-t.sendAt>0?-1:0)).forEach((t=>{e.queue.set(t.consultId,{...t,mesList:[]})}))))},getMessList:({state:e},{client:t,page:s})=>ye.config.globalProperties.$http.get("/api/v1/customer/customer/online/records",{params:{page:s||1,limit:20,consultId:t.consultId,queryRole:2}}).then((({data:e})=>{let s=e.list.reduce(((e,s)=>(t.mesList.find((e=>e.msgId==s.msgId||s.mid&&e.mid==s.mid))||e.push(s),e)),[]).sort(((e,t)=>e.sendAt-t.sendAt>0?1:-1)).filter((e=>!(-1===e.senderRole&&1===e.receiverRole)));return t.mesList=t.mesList?s.concat(t.mesList):s,ne.get().then((e=>{e.forEach((e=>{let s=t.mesList.findIndex((t=>t.mid===e.prevMid));s>-1&&t.mesList.splice(s+1,0,{mid:e.mid,content:e.content,senderRole:1,read:0,category:e.category,sendStatus:"fail",sendAt:e.time,senderRole:2,attach:{time:e.time}})}))})),e.list})),getTransferList({dispatch:e,commit:t,getters:s,state:n,rootGetters:o}){ye.config.globalProperties.$http.get("/api/v1/customer/customer/online/transfer").then((({data:t})=>{t.forEach((t=>{let s=`客服${t.slaveNickname||t.slaveUsername}将客户\n            ${t.nickname||t.name} 的对话转接给了您`,i={title:"转接通知",message:g(Z,{message:s,close:s=>{if(b.close(),s){let s=oe();n.soc.send(JSON.stringify({attach:{},consult_id:t.consultId,feedback:1,mid:s,reason:"",type:6})),n.messageEvents.set(s,{res(t){t.data.mesList=[],n.list.set(t.data.consultId,t.data);let s=o.notice.findIndex((e=>e.consultId===t.data.consultId));s>-1&&o.notice.splice(s,1),e("switchClient",t.data),de.push("/service")},rej(e){}})}else i.messageBoxClass="conI"+t.consultId,b.alert('<textarea rows="6" id="rejTransfer" style="width:332px;outline: none;border-color: #D8D8D8;color: #333333;font-size: 12px;border-radius: 4px;padding: 4px 12px;">我现在比较繁忙，请转接给其他客服</textarea>',"Tip",{confirmButtonText:"确认",cancelButtonText:"取消",title:"拒绝接入原因",customClass:i.messageBoxClass,dangerouslyUseHTMLString:!0}).then((()=>{let e=document.querySelector("#rejTransfer").value,s=o.notice.findIndex((e=>e.consultId===t.consultId));s>-1&&o.notice.splice(s,1),n.soc.send(JSON.stringify({attach:{},consult_id:t.consultId,feedback:2,mid:oe(),reason:e,type:6}))})).catch((()=>{}))}}),consultId:t.consultId};o.notice.unshift(i)}))}))},updateAutoreply:({dispatch:e,commit:t,getters:s,state:n,rootGetters:o})=>ye.config.globalProperties.$http.get("/api/v1/customer/auto-reply").then((e=>{n.autoReply=[],n.autoReplyQueue.forEach(((e,t)=>{n.autoReplyQueue.set(t,e.filter((e=>{let t=n.autoReply.find((t=>t.id===e.id));return t?(e.v=t.content,!0):(clearTimeout(e.timeout),!1)})))}))}))},mutations:{sortList(e){let t=Array.from(e.list.values());e.list.clear(),t.sort(((e,t)=>e.sendAt-t.sendAt>0?-1:1)),t.forEach((t=>{e.list.set(t.consultId,t)}))},playAudio(e){e.audio&&(te=setTimeout((()=>{se.play()}),500))}}},notice:{state:{data:[]},getters:{notice:e=>e.data},actions:{},mutations:{setNotice(e,t){e.data=t}}}},state:{routeList:B.getSession("csRouteList")||[],userInfo:B.getSession("csUserInfo")||{},pageSizes:[10,20,30,50,80,100,200,500],pageSize:30,api:B.getSession("csApi")||"",homeIsMap:0},getters:{routeList:e=>e.routeList,userInfo:e=>e.userInfo,api:e=>e.api,homeIsMap:e=>e.homeIsMap},mutations:{SETISMAP(e,t){e.homeIsMap=t},SETROUTER(e,t){e.routeList=t,B.setSession("csRouteList",t)},SETAPI(e,t){B.setSession("csApi",t),e.api=t},SETUSERINFO(e,t){B.setSession("csUserInfo",t),e.userInfo=t}},actions:{logout:({commit:e,state:t,dispatch:s})=>new Promise((e=>{Q(),B.clearAllSession(),t.homeIsMap=0,location.href=location.origin+location.pathname,e()})),filterRouter:({commit:e,state:t})=>new Promise((s=>{let n=t.userInfo;var o=[];o=1==n.role?ae.filter((e=>["Note","ClientList","ClientTag","Auto"].indexOf(e.name)<0)):3==n.role?re:ae,e("SETROUTER",o),s()}))}}),le=[{path:"/",name:"login",component:()=>P((()=>import("./login-bd71c461.js")),["./login-bd71c461.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","../css/login-65a13afc.css"],import.meta.url),meta:{title:"登录"}},{path:"/kefu",name:"Guest",component:()=>P((()=>import("./index-6a7a3d4c.js")),["./index-6a7a3d4c.js","./404-060407f8.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","../css/404-045cf6fc.css","./updatePassword-07a57af0.js","../css/updatePassword-ec48af6a.css","../css/index-c7016988.css"],import.meta.url),meta:{title:"管理系统"},children:[...ae,...re,{path:"/:pathMatch(.*)*",name:"noFound",component:()=>P((()=>import("./404-060407f8.js")),["./404-060407f8.js",".pnpm-9c274078.js","../css/.pnpm-be635a85.css","../css/404-045cf6fc.css"],import.meta.url),meta:{title:"404"}}]}],de=L({history:k(),scrollBehavior:()=>({y:0}),routes:le}),ue=["xlink:href","fill"],me=W(C({__name:"index",props:{name:{type:String,required:!0},color:{type:String,default:""},size:{type:String,default:"1em"},className:{type:String}},setup(e){const t=e,s=O((()=>t.className?"svg-icon "+t.className:"svg-icon")),n=O((()=>`#icon-${t.name}`));return(o,i)=>(u(),_("svg",{"aria-hidden":"true",class:N(f(s)),style:R(`width:${e.size};height:${e.size};color:${e.color}`)},[v("use",{"xlink:href":f(n),fill:t.color},null,8,ue)],6))}}),[["__scopeId","data-v-0b225b8a"]]),pe=new Map;function ge(e){let{url:t,method:s,params:n,data:o}=e;return"string"==typeof o&&(o=JSON.parse(o)),[t,s,JSON.stringify(n),JSON.stringify(o)].join("&")}function fe(e){const t=ge(e);if(pe.has(t)){pe.get(t)(t),pe.delete(t)}}const he=["login"];de.beforeEach(((e,t,s)=>{var n;const o=H();document.title=`${e.meta.title} - 客服系统`,o?"/login"===e.path||"/"===e.path?(ce.dispatch("logout"),s({name:"login"})):(ce.dispatch("filterRouter"),s()):(null==(n=ce.state.socket.soc)||n.close(),-1!==he.indexOf(e.name)?s():(ce.dispatch("logout"),s({name:"login",params:{redirect:e.path}})))}));const _e=A(j);_e.component("svg-icon",me);let ve=location.origin;ce.commit("SETAPI",ve),_e.config.globalProperties.$http=function(e){let t=T.create({baseURL:e||location.origin,timeout:5e3});return t.interceptors.request.use((e=>(H()&&(e.headers.Authorization=H()),fe(e),function(e){if("/api/v1/customer/user/statistic1"===e.url||e.url.includes("statistics"))return;const t=ge(e);e.cancelToken=e.cancelToken||new T.CancelToken((e=>{pe.has(t)||pe.set(t,e)}))}(e),e.params||(e.params={}),e.params.t=(new Date).getTime(),e)),(e=>Promise.reject(e))),t.interceptors.response.use((e=>(fe(e.config),e.data)),(e=>(function(e){var t,s,n;if(T.isCancel(e))return;let o="";if(e&&e.response)switch(e.response.status){case 302:o="接口重定向了！";break;case 400:o="参数不正确！";break;case 401:o="您未登录，或者登录已经超时，请先登录！";break;case 403:o="您没有权限操作！";break;case 404:o=`请求地址出错: ${e.response.config.url}`;break;case 408:o="请求超时！";break;case 409:o="系统已存在相同数据！";break;case 500:o="服务器内部错误！";break;case 501:o="服务未实现！";break;case 502:o="网关错误！";break;case 503:o="服务不可用！";break;case 504:o="服务暂时无法访问，请稍后再试！";break;case 505:o="HTTP版本不受支持！";break;default:o="异常问题，请联系管理员！"}e.message.includes("timeout")&&(o="网络请求超时！");e.message.includes("Network")&&(o=window.navigator.onLine?"服务端异常！":"您断网了！");S({position:"bottom-right",title:"提示",message:(null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.message)||o,type:"error"}),[401,403].indexOf(null==(n=e.response)?void 0:n.status)>=0&&(Q(),window.sessionStorage.removeItem("userInfo"),de.push({name:"login"}))}(e),Promise.reject(e)))),t}(ve),_e.use(de),_e.use(ce),_e.mount("#app"),_e.config.globalProperties.$formatter=(e,t)=>e[t.property]||"-";const ye=_e;export{U as G,W as _,me as a,ce as b,ae as c,B as d,V as g,M as p,de as r,G as s};
