import{x as e,h as a,R as t,D as l,ap as i,aO as s,o as n,b as r,aw as o,af as c,d as v,q as u,p as d,u as p,a as y,t as g,S as f,B as h,ai as m,ao as x,O as k,P as b}from"./.pnpm-9c274078.js";import{_ as K}from"./index-e716b57f.js";const C=e=>(k("data-v-19ce6cdb"),e=e(),b(),e),w={class:"line-box huihua"},M={class:"top-right"},F={class:"legend"},D={class:"currDate"},$=C((()=>v("span",{class:"tag",style:{background:"#899bff"}},null,-1))),z={key:0},S={key:1},_={key:2},A={class:"lastDate"},O=C((()=>v("span",{class:"tag",style:{background:"#f0866a"}},null,-1))),T={key:0},Y={key:1},B={key:2},N=K({__name:"bar",props:["height"],setup(k){const b=h(),{$http:K}=b.appContext.config.globalProperties,C=e();function N(e){return e.getTime()>(new Date).getTime()}const P=a({activeKey:7,activeName:1,currMap:[],lastMap:[],list:[],loading:!1}),R=e=>{if(e==P.activeKey&&!C.value)return!1;P.activeKey=e,C.value=void 0,I()},{activeKey:V,activeName:j,currMap:E,lastMap:L}=t(P),W=e(null),q={chart:null};function I(){let e={};if(P.loading=!0,C.value)P.activeKey=Math.floor(C.value[1]-C.value[0])/86400+1,e.timeStart=Number(C.value[0])-86400*P.activeKey,e.timeEnd=Number(C.value[1])+86399;else{let a=864e5*(2*P.activeKey-1),t=(new Date).getTime();e.timeEnd=Math.floor(t/1e3),e.timeStart=Math.floor((t-a-t%864e5-288e5)/1e3),e.today=1===P.activeKey}K.get("/api/v1/customer/user/statistic1",{params:e}).then((({data:e})=>{P.list=e,U()})).finally((()=>{P.loading=!1}))}l((()=>{q.chart=i(W.value),U(),I()}));const U=()=>{let e=P.list||[];if(1!=P.activeKey||C.value)a=e.slice(0,e.length/2).reverse(),t=e.slice(e.length/2).reverse();else var a=e.slice(0,24).reverse(),t=e.slice(24).reverse();let l=a.map((e=>e.key)),i=a.map((e=>e.total)),s=t.map((e=>e.total));P.currMap=a,P.lastMap=t,X(l,i,s)},X=(e,a,t)=>{(1!=P.activeKey||C.value)&&P.activeKey,(1!=P.activeKey||C.value)&&P.activeKey,q.chart.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){return(e=>{let a=1!=P.activeKey||C.value?"":G(0),t=`<div style='display:flex;align-items:center;'><span style="\n        background: #899BFF;width: 14px;\n          height: 10px; border-radius: 2px; margin: 0 4px 2px 0;"></span>\n        <span style='font-size:12px;color:#C2C3C8;'>${a}    ${e[0].name}</span></div>`,l=1!=P.activeKey||C.value?G(-P.activeKey,e[0].name):e[1].name;a=1!=P.activeKey||C.value?"":G(-1);let i=`<div style='display:flex;align-items:center;'><span style="\n        background: #F0866A;width: 14px;\n          height: 10px; border-radius: 2px; margin: 0 4px 2px 0;"></span>\n          <span style='font-size:12px;color:#C2C3C8;'>${a}    ${l}</span></div>`;var s=P.currMap.filter((a=>(1!=P.activeKey||C.value,a.key==e[0].name)))[0],n=P.lastMap.filter((e=>(1!=P.activeKey||C.value,e.key==l)))[0];return"<div style='padding:0 6px;'>"+t+`<div style='font-size:12px;color:#666;'>会话次数: ${s.total}例</div>`+i+`<div style='font-size:12px;color:#666;'>会话次数: ${n.total}例</div></div>`})(e)}},grid:{top:"20%",left:"0%",right:"1%",bottom:"2%",containLabel:!0},xAxis:{type:"category",data:(null==e?void 0:e.length)?e:["","","","","","",""],axisLabel:{color:"#999999",formatter:function(e,a){let t=1!=P.activeKey||C.value?e.indexOf("-"):e.indexOf(" ");return 1!=P.activeKey||C.value?e.substring(t+1):e}}},yAxis:{type:"value"},series:[{data:(null==a?void 0:a.length)?a:[0,0,0,0,0,0,0],barWidth:20,itemStyle:{borderRadius:[10,10,0,0],color:new s(0,1,0,0,[{offset:0,color:"#C1CAFF"},{offset:1,color:"#8D9FFF"}])},type:"bar"},{data:(null==t?void 0:t.length)?t:[0,0,0,0,0,0,0],barWidth:20,itemStyle:{borderRadius:[10,10,0,0],color:new s(0,1,0,0,[{offset:0,color:"#FFB192"},{offset:1,color:"#FA5B50"}])},type:"bar"}]},!0),window.onresize=function(){q.chart.resize()}};function G(e,a){const t=e=>{var a=e;return 1==e.toString().length&&(a="0"+e),a};var l=a?new Date(a):new Date,i=l.getTime()+864e5*e;l.setTime(i);var s=l.getFullYear(),n=l.getMonth(),r=l.getDate();return s+"-"+(n=t(n+1))+"-"+(r=t(r))}return(e,a)=>{var t,l,i,s,h,b,K,j,q,U;const X=m,G=x;return n(),r(f,null,[o(e.$slots,"default",{},void 0,!0),c((n(),r("div",w,[v("div",{ref_key:"classChart",ref:W,style:u({width:"100%",height:k.height||"230px"})},null,4),v("div",M,[v("span",{onClick:a[0]||(a[0]=e=>R(1)),class:d({active:1==p(V)&&!C.value})},"今天",2),v("span",{onClick:a[1]||(a[1]=e=>R(7)),class:d({active:7==p(V)&&!C.value})},"7天",2),v("span",{onClick:a[2]||(a[2]=e=>R(15)),class:d({active:15==p(V)&&!C.value})},"15天",2),v("span",{onClick:a[3]||(a[3]=e=>R(30)),class:d({active:30==p(V)&&!C.value})},"1月",2),y(X,{modelValue:C.value,"onUpdate:modelValue":a[4]||(a[4]=e=>C.value=e),style:{width:"260px"},type:"daterange","range-separator":"～",format:"YYYY/MM/DD","value-format":"X","start-placeholder":"开始时间","end-placeholder":"结束时间",size:"small","disabled-date":N,onChange:a[5]||(a[5]=e=>e?I():R(7))},null,8,["modelValue"])]),v("div",F,[v("div",D,[$,1!=p(V)||C.value?(null==(t=p(E)[0])?void 0:t.key)===(null==(l=p(E)[p(E).length-1||0])?void 0:l.key)?(n(),r("span",S,g(null==(i=p(E)[p(E).length-1||0])?void 0:i.key),1)):(n(),r("span",_,g(null==(s=p(E)[0])?void 0:s.key)+" 至 "+g(null==(h=p(E)[p(E).length-1||0])?void 0:h.key),1)):(n(),r("span",z,"今天"))]),v("div",A,[O,1!=p(V)||C.value?(null==(b=p(L)[0])?void 0:b.key)===(null==(K=p(L)[p(L).length-1||0])?void 0:K.key)?(n(),r("span",Y,g(null==(j=p(L)[0])?void 0:j.key),1)):(n(),r("span",B,g(null==(q=p(L)[0])?void 0:q.key)+" 至 "+g(null==(U=p(L)[p(L).length-1||0])?void 0:U.key),1)):(n(),r("span",T,"昨天"))])])])),[[G,P.loading]])],64)}}},[["__scopeId","data-v-19ce6cdb"]]);export{N as c};
