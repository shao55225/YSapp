import{A as e,x as a,h as t,R as l,D as s,aj as n,ak as o,al as i,am as r,an as c,ad as p,ao as u,o as d,b as m,d as g,a as h,w as f,u as v,a3 as b,L as _,af as y,c as z,t as w,q as C,e as S,B as D,I as L,f as k,O as x,P as V}from"./.pnpm-9c274078.js";import{_ as I,p as P,a as j}from"./index-e716b57f.js";import{_ as A}from"./empty-6f66e897.js";import{M as $}from"./mesList-6e63e858.js";/* empty css                                                 */const U=e=>(x("data-v-f82c1425"),e=e(),V(),e),K={class:"container"},M={class:"filter"},R=U((()=>g("div",null,null,-1))),q={class:"right"},B={class:"search-item"},N=U((()=>g("span",null,"在线状态",-1))),O={class:"custom-input"},E=U((()=>g("div",{class:"table-empty"},[g("img",{src:A,alt:"空状态"}),g("p",null,"暂无数据")],-1))),F={class:"statusMap"},G={class:"pagination"},H=I({__name:"index",setup(x){const V=e(),I=D(),{$http:A}=I.appContext.config.globalProperties,U=a(),H=t({visible:!1,data:[],loading:!1,client:{},chatList:[],get:async e=>{var a;e.consultId=e.memberId,(null==(a=U.value)?void 0:a.page)&&(U.value.page=1),e.mesList||(e.mesList=[]);const t=await J(e.consultId);H.client=e,H.chatList=t,H.visible=!0}}),J=async e=>{const a={masterId:e};let t=[];return await A.get("/api/v1/customer/customer/online/master_consult_latest",{params:a}).then((e=>{t=e.data})),t},Q=t({loading:!1,search:"",online:""}),{loading:T,search:W,online:X}=l(Q);s((()=>{Y()}));const Y=()=>{Q.loading=!0;let e={limit:Z.pageSize,page:Z.currentPage};if(""!=Q.online&&(e.online=Q.online),""!=Q.search&&(e.keyword=Q.search),Z.order){let a=Z.order.split(",");e.orderName=a[0],e.orderSerial=a[1]}A.get("/api/v1/customer/administrator/agent_member/chat",{params:e}).then((e=>{let{data:a}=e;Z.tableData=a.list,Z.total=a.total,Q.loading=!1}))},Z=t({tableData:[],currentPage:1,pageSize:V.state.pageSize,total:0,multipleSelection:[],order:"",size(e){Z.pageSize=e,Z.currentPage=1,Y()},current(e){Z.currentPage=e,Y()},selection(e){Z.multipleSelection=e},sort(e){const{prop:a,order:t}=e;Z.order=a&&t?`${a},${"descending"==t?"desc":"asc"}`:"",Y()}}),{total:ee,currentPage:ae,pageSize:te,tableData:le}=l(Z);return(e,a)=>{var t;const l=n,s=o,D=j,x=L,I=i,A=k,J=r,Q=c,se=p,ne=u;return d(),m("div",K,[g("div",M,[R,g("div",q,[g("div",B,[N,h(s,{modelValue:v(X),"onUpdate:modelValue":a[0]||(a[0]=e=>b(X)?X.value=e:null),onChange:Y,clearable:"",placeholder:"选择在线状态 "},{default:f((()=>[h(l,{label:"离线",value:"0"}),h(l,{label:"在线",value:"1"})])),_:1},8,["modelValue"])]),g("div",O,[h(D,{onClick:Y,color:"#999",size:"14 px",name:"search"}),h(x,{class:"seachInput",placeholder:"搜索关键字",onKeyup:_(Y,["enter","native"]),modelValue:v(W),"onUpdate:modelValue":a[1]||(a[1]=e=>b(W)?W.value=e:null)},null,8,["onKeyup","modelValue"])])])]),y((d(),z(J,{onSortChange:Z.sort,"tooltip-effect":"light",height:"77vh",data:v(le),style:{width:"100%"}},{empty:f((()=>[E])),default:f((()=>[h(I,{prop:"username","min-width":"100",align:"left",label:"用户名"}),h(I,{label:"IP信息",prop:"ip",formatter:e.$formatter},null,8,["formatter"]),h(I,{label:"所在地",prop:"ipRegion",formatter:e.$formatter},null,8,["formatter"]),h(I,{label:"操作系统 ","min-width":"150","show-overflow-tooltip":!0},{default:f((({row:e})=>[g("span",null,w(e.operatingSystem||"-"),1)])),_:1}),h(I,{label:"最近登录时间",sortable:"",prop:"latestAccessAt"},{default:f((({row:e})=>[g("span",null,w(v(P)(e.latestAccessAt)||"-"),1)])),_:1}),h(I,{label:"当前状态"},{default:f((({row:e})=>[g("div",F,[g("span",{class:"tags",style:C({"background-color":1==e.online?"#52C41A":"#D9D9D9"})},null,4),g("span",{style:C({color:1==e.online?"#606266":"#D9D9D9"})},w(["离线","在线"][e.online]),5)])])),_:1}),h(I,{label:"操作",width:"80",align:"right"},{default:f((({row:e})=>[h(A,{type:"primary",onClick:a=>H.get(e),link:""},{default:f((()=>[S("聊天记录")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["onSortChange","data"])),[[ne,v(T)]]),g("div",G,[h(Q,{onSizeChange:Z.size,small:"",onCurrentChange:Z.current,"current-page":v(ae),"page-sizes":v(V).state.pageSizes,"page-size":v(te),layout:"total, prev, pager, next, sizes, jumper",total:v(ee)},null,8,["onSizeChange","onCurrentChange","current-page","page-sizes","page-size","total"])]),h(se,{modelValue:H.visible,"onUpdate:modelValue":a[2]||(a[2]=e=>H.visible=e),title:(null==(t=H.client)?void 0:t.username)+"的聊天记录",width:"880px","close-on-click-modal":!1},{default:f((()=>[y(h($,{ref_key:"messageList",ref:U,style:{height:"45vh"},class:"dis-list",client:H.client,chatList:H.chatList},null,8,["client","chatList"]),[[ne,H.loading]])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-f82c1425"]]);export{H as default};
