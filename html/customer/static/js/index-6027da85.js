import{x as e,D as a,a9 as t,$ as l,af as s,u as n,o,b as i,S as d,T as r,p as c,d as u,a as p,a5 as m,t as v,Q as g,e as y,c as f,w as h,N as b,H as k,ao as x,O as _,P as w,aw as I,h as C,n as V,g as L,ax as N,ay as S,az as U,ag as z,ah as T,aA as P,L as A,I as E,aj as R,ak as M,ai as $,an as H,B as j,aB as q,a7 as B,J as K,f as O,ad as F,aC as D,aD as J,aE as Y,aF as G,K as Q,aG as W,i as X,W as Z,ar as ee,al as ae,am as te,aH as le,aI as se,aJ as ne,aK as oe}from"./.pnpm-9c274078.js";import{_ as ie,b as de,p as re,a as ce}from"./index-e716b57f.js";import{_ as ue}from"./empty-6f66e897.js";import{_ as pe,u as me}from"./updatePassword-07a57af0.js";import{_ as ve}from"./tiny-d6f4af2f.js";import{_ as ge}from"./update-8ac83b51.js";const ye=e=>(_("data-v-d746a463"),e=e(),w(),e),fe=["data-mes"],he={key:0,class:"sys-notice"},be=ye((()=>u("span",{class:"line"},null,-1))),ke=["innerHTML"],xe=ye((()=>u("span",{class:"line"},null,-1))),_e={class:"mes-text"},we={class:"time"},Ie={key:0,class:"mes-name"},Ce={key:1,class:"mes-name"},Ve=["innerHTML"],Le=["src"],Ne=["src"],Se=["src"],Ue=["src"],ze={key:0,style:{"font-size":"14px",padding:"0 16px",width:"347px"}},Te={style:{color:"#4b82fa"}},Pe={key:0,style:{margin:"8px 0"}},Ae={key:0,style:{color:"#52c41a"}},Ee={key:1,style:{color:"#ff4d4f"}},Re={key:1,style:{display:"flex","line-height":"1"}},Me={style:{"flex-shrink":"0"}},$e=["innerHTML"],He={key:1,class:"order"},je={class:"title"},qe={class:"num"},Be={class:"num"},Ke={key:0,style:{color:"#f7ad1e"}},Oe={key:1,style:{color:"#4e83f7"}},Fe={key:2,style:{color:"#55c31f"}},De={key:3,style:{color:"#d9d9d9"}},Je={class:"num"},Ye={class:"num"},Ge={class:"order-time"},Qe={key:2,class:"order"},We={class:"title"},Xe={class:"num"},Ze={class:"num"},ea={class:"num"},aa={class:"order-time"},ta={key:3,class:"order"},la={class:"title"},sa={class:"type"},na={class:"icon"},oa={class:"info"},ia={key:0,style:{color:"#faad14","font-size":"12px","margin-left":"12px"}},da={key:1,style:{color:"#52c41a","font-size":"12px","margin-left":"12px"}},ra={key:2,style:{color:"#ff4d4f","font-size":"12px","margin-left":"12px"}},ca={class:"num"},ua={class:"order-time"},pa={key:1,class:"read"},ma={key:2,class:"noread"},va=ie({__name:"mesList",props:{client:{type:Object,default:()=>({})}},setup(_){const w=_,I=e(),C=e(1);let V=e();function L(){var e;w.client.consultId&&void 0===V.value&&0===(null==(e=I.value)?void 0:e.scrollTop)&&window.sessionStorage.getItem("csToken")&&(V.value=de.dispatch("getMessList",{client:w.client,page:C.value++}).then((e=>{var a;if(e&&0!=e.length){let t=null==(a=e.find((e=>e.mid)))?void 0:a.mid;if(t){const e=document.querySelector(`[data-mes="${t}"]`);null==e||e.scrollIntoView()}V.value=void 0}else V.value=!0})).catch((e=>{C.value--,V.value=void 0})))}a((()=>{var e;null==(e=I.value)||e.addEventListener("scroll",(function(e){L()})),I.value.addEventListener("click",(function(e){if("IMG"===e.target.tagName){let a=document.createElement("div");a.style="position:fixed;width:100vw !important;height:100vh !important;top:0;left:0;z-index:99999999;max-width:none !important;object-fit: contain;background-color:rgb(36 36 36 / 50%);padding:15vh 15vw;box-sizing: border-box;display:flex;flex-direction:column;justify-content:center;text-align:right;align-items: center;",a.onclick=function(e){return e.stopPropagation(),!1};let t=document.createElement("span");t.innerText="×",t.style="color: white;font-size: 32px;position: fixed;top: 32px;right: 32px;cursor: pointer;padding: 8px;",t.addEventListener("click",(e=>{a.parentNode.removeChild(a)})),a.appendChild(t);let l=document.createElement("img");l.src=e.target.src,l.style="object-fit: contain;max-width: 70vw !important;max-height: 70vh;",a.appendChild(l),document.body.appendChild(a)}})),t((()=>w.client.consultId),(e=>{V.value=void 0,C.value=1,e&&L()}),{immediate:!0})}));let N=new Map;function S(e){try{N.get(e)||N.set(e,JSON.parse(e))}catch{}return N.get(e)||{}}return(e,a)=>{const t=l,w=ce,C=k,L=x;return s((o(),i("div",{class:"mes-box",ref_key:"box",ref:I},[(o(!0),i(d,null,r(_.client.mesList,(e=>(o(),i("div",{class:c(["mes-item",1!==e.senderRole?"send":"get"]),"data-mes":e.mid},[7===e.category?(o(),i("div",he,[be,u("span",{style:{"vertical-align":"middle",color:"#666666","max-width":"60%"},innerHTML:e.content},null,8,ke),xe])):(o(),i(d,{key:1},[p(t,{size:60,icon:n(m),src:1!==e.senderRole?e.slaveHeadImg:e.masterHeadImg,class:"avatar"},null,8,["icon","src"]),u("div",null,[u("div",_e,[u("span",we,[1===e.senderRole?(o(),i("span",Ie,v(e.masterUserName),1)):g("",!0),y(" "+v(n(re)(e.sendAt||e.attach.time))+" ",1),1!==e.senderRole?(o(),i("span",Ce,v(e.slaveUserName),1)):g("",!0)]),1===e.category?(o(),i("div",{key:0,innerHTML:e.content},null,8,Ve)):g("",!0),2===e.category?(o(),i("img",{key:1,src:e.content,alt:"",style:{"max-width":"250px"}},null,8,Le)):g("",!0),3===e.category?(o(),i("video",{key:2,src:e.content,alt:"",style:{width:"250px"},controls:""},null,8,Ne)):g("",!0),4===e.category?(o(),i("video",{key:3,src:e.content,alt:"",style:{width:"250px"},controls:""},null,8,Se)):g("",!0),5===e.category?(o(),i("video",{key:4,src:e.content,alt:"",style:{width:"250px"},controls:""},null,8,Ue)):g("",!0),6===e.category?(o(),i(d,{key:5},["withdrawChangeStatus"===S(e.content).type?(o(),i("div",ze,[u("p",null,[y(" 亲，您于"+v(n(re)(S(e.content).statusAt))+"发起的 ",1),u("span",Te,v(S(e.content).amount||0),1),y("元 提现状态已更改为 ")]),300===S(e.content).status||400===S(e.content).status?(o(),i("p",Pe,[300===S(e.content).status?(o(),i("span",Ae,"完成")):g("",!0),400===S(e.content).status?(o(),i("span",Ee,"关闭")):g("",!0)])):g("",!0),300!==S(e.content).status&&400!==S(e.content).status||!S(e.content).because?g("",!0):(o(),i("p",Re,[u("span",Me,v(400===S(e.content).status?"关闭原因":"摘要"),1),y("："),u("p",{innerHTML:S(e.content).because},null,8,$e)]))])):"withdraw"===S(e.content).type?(o(),i("div",He,[u("p",je,v(1!==e.senderRole?"亲，请核对":"")+"提现信息",1),u("p",qe,"提现金额："+v(S(e.content).amount),1),u("p",Be,[y(" 提现状态： "),100===S(e.content).status?(o(),i("span",Ke,"待受理")):200===S(e.content).status?(o(),i("span",Oe,"处理中")):300===S(e.content).status?(o(),i("span",Fe,"已完成")):400===S(e.content).status?(o(),i("span",De,"已关闭")):g("",!0)]),u("p",Je,"手续费："+v(S(e.content).handleFee),1),u("p",Ye,"提现地址："+v(S(e.content).address),1),u("p",Ge," 创建时间："+v(n(re)(S(e.content).statusAt)||"-"),1)])):"commission"===S(e.content).type?(o(),i("div",Qe,[u("p",We,v(1!==e.senderRole?"亲，请核对":"")+"佣金信息",1),u("p",Xe,"订单号："+v(S(e.content).orderNo),1),u("p",Ze," 充值账号："+v(S(e.content).rechargeUsername),1),u("p",ea,"获得佣金："+v(S(e.content).amount),1),u("p",aa," 提成时间："+v(n(re)(S(e.content).timeAt)||"-"),1)])):(o(),i("div",ta,[u("p",la,v(1!==e.senderRole?"亲，请核对":"")+"订单信息",1),u("div",sa,[u("div",na,[p(w,{color:"#4c83ff",name:"huangguan"})]),u("div",oa,[u("p",null,[y(v(S(e.content).title)+" ",1),1===S(e.content).payStatus?(o(),i("span",ia,"待付款")):g("",!0),2===S(e.content).payStatus?(o(),i("span",da,"成功")):g("",!0),3===S(e.content).payStatus?(o(),i("span",ra,"失败")):g("",!0)]),u("p",null,"合计：￥"+v(S(e.content).amount),1)])]),u("p",ca,"订单号："+v(S(e.content).orderNo),1),u("p",ua," 创建时间："+v(n(re)(S(e.content).payAt)||"-"),1)]))],64)):g("",!0)])]),"fail"===e.sendStatus?(o(),f(C,{key:0,class:"err"},{default:h((()=>[p(n(b))])),_:1})):g("",!0),1===e.read?(o(),i("span",pa,"已读")):0===e.read?(o(),i("span",ma,"未读")):g("",!0)],64))],10,fe)))),256))])),[[L,n(V)&&!0!==n(V)]])}}},[["__scopeId","data-v-d746a463"]]),ga=""+new URL("../png/null_client-9988ee2c.png",import.meta.url).href,ya={class:"list"},fa=["onClick"],ha={class:"centent"},ba={class:"name"},ka=["innerHTML"],xa={__name:"userList",props:{data:{type:Map,default:()=>new Map([])},rowClick:{type:Function}},setup:e=>(a,t)=>{const s=l;return o(),i("ul",ya,[(o(!0),i(d,null,r(e.data,(([t,l])=>(o(),i("li",{key:t,class:c([l.online?"online":"offline",n(de).state.socket.currentClient===l?"active":""]),onClick:a=>!!e.rowClick&&e.rowClick(l)},[p(s,{size:40,icon:n(m),style:{"font-size":"24px"},src:l.headImg},null,8,["icon","src"]),u("div",ha,[u("p",ba,v(l.name),1),u("p",{class:c(["ellipsis","yes"]),style:{height:"14px"}},[1===l.category?(o(),i("span",{key:0,innerHTML:l.content.replace(/<img.+?>/g,"【图片】")},null,8,ka)):g("",!0),7===l.category?(o(),i(d,{key:1},[y(v(l.content),1)],64)):2===l.category?(o(),i(d,{key:2},[y(" 【图片】 ")],64)):3===l.category?(o(),i(d,{key:3},[y(" 【文件】 ")],64)):4===l.category?(o(),i(d,{key:4},[y(" 【音频】 ")],64)):5===l.category?(o(),i(d,{key:5},[y(" 【视频】 ")],64)):6===l.category?(o(),i(d,{key:6},[y(" 【订单】 ")],64)):g("",!0)])]),I(a.$slots,"default",{item:l})],10,fa)))),128))])}},_a={key:0,class:"null-client"},wa=(e=>(_("data-v-68c2ddb6"),e=e(),w(),e))((()=>u("img",{src:ga,alt:""},null,-1))),Ia={key:0},Ca={key:1},Va={key:2},La=["title"],Na=["onClick"],Sa=["title"],Ua=["onClick"],za=["title"],Ta={class:"time",style:{position:"absolute",right:"0",top:"0"}},Pa=ie({__name:"index",setup(e){const a=C({activeName:"当前对话",tabNames:[{name:"当前对话",data:de.state.socket.list,clickE(e){de.dispatch("switchClient",e)},showRemind:V((()=>{let e=0;return de.state.socket.list.forEach((a=>{e+=a.unReadCount})),e>0}))},{name:"排队列表",data:de.state.socket.queue,showRemind:V((()=>de.state.socket.queue.size>0)),clickE(e){t({client:e,type:1})}},{name:"待接入留言",data:de.state.socket.untreated,showRemind:V((()=>de.state.socket.untreated.size>0)),clickE(e){t({client:e,type:2})}}]}),t=e=>{de.dispatch("addClient",e).then((e=>{de.dispatch("switchClient",e)})).catch((e=>{L({position:"bottom-right",title:"提示",message:e.message,type:"error"})})),a.activeName="当前对话"};return(e,l)=>{const m=z,y=T;return o(),f(y,{modelValue:a.activeName,"onUpdate:modelValue":l[0]||(l[0]=e=>a.activeName=e),type:"border-card",class:"user-tab"},{default:h((()=>[p(N,{name:"list",tag:"ul"},{default:h((()=>[(o(!0),i(d,null,r(a.tabNames,(e=>(o(),f(m,{key:e.name,name:e.name},{label:h((()=>[u("span",{class:c(["tab-name",{remind:e.showRemind}])},v(e.name),3)])),default:h((()=>[e.data&&0!==e.data.size?(o(),f(xa,{key:1,data:e.data,rowClick:e.clickE},{default:h((({item:a})=>["排队列表"===e.name?(o(),i("div",{key:0,class:"tr",style:{position:"absolute",right:"19px"},title:a.roomId},[u("p",{class:"time point",onClick:S((e=>t({client:a,type:1})),["stop"]),style:{color:"#55a0ff"}}," 点击接入 ",8,Na)],8,La)):"待接入留言"===e.name?(o(),i("div",{key:1,class:"tr",style:{position:"absolute",right:"19px"},title:a.roomId},[u("p",{class:"time point",onClick:S((e=>t({client:a,type:2})),["stop"]),style:{color:"#55a0ff"}}," 点击处理 ",8,Ua)],8,Sa)):(o(),i("div",{key:2,class:"tr",style:{position:"relative",display:"flex","flex-direction":"column-reverse","white-space":"nowrap"},title:a.roomId},[u("p",Ta,v(n(re)(a.sendAt,"{m}-{d} {h}:{i}")),1),s(u("span",{class:"no-read-number",style:{"margin-bottom":"4px"}},v(a.unReadCount),513),[[U,a.unReadCount]])],8,za))])),_:2},1032,["data","rowClick"])):(o(),i("div",_a,[wa,"当前对话"===e.name?(o(),i("p",Ia,"当前没有对话，赶快去接入吧")):g("",!0),"排队列表"===e.name?(o(),i("p",Ca,"当前没有用户")):g("",!0),"待接入留言"===e.name?(o(),i("p",Va,"当前没有用户留言")):g("",!0)]))])),_:2},1032,["name"])))),128))])),_:1})])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-68c2ddb6"]]),Aa=e=>(_("data-v-b70d4895"),e=e(),w(),e),Ea={key:1,style:{display:"flex",gap:"16px","margin-top":"16px"}},Ra={key:2,class:"null-client"},Ma=[Aa((()=>u("img",{src:pe,alt:""},null,-1))),Aa((()=>u("p",null,"暂无数据",-1)))],$a={class:"infinite-list",style:{overflow:"auto",flex:"1"}},Ha=ie({__name:"list",props:{data:{type:Object,default:()=>{}},pageIndex:{type:Number,default:()=>1},serchKeys:{type:Array,default:["keyword"]},total:{type:Number,default:()=>1}},emits:["load","nextPage"],setup(a,{emit:t}){const l=e(1),s=e(),c=e(),m=e(),v=e();return(e,y)=>{const b=E,k=R,x=M,_=$,w=H;return o(),i(d,null,[a.serchKeys.includes("keyword")?(o(),f(b,{key:0,placeholder:"请输入您想搜索的关键字",clearable:"",modelValue:s.value,"onUpdate:modelValue":y[0]||(y[0]=e=>s.value=e),"prefix-icon":n(P),style:{width:"100%"},onBlur:y[1]||(y[1]=e=>{t("load",{keyword:s.value||void 0,status:c.value||void 0,timeStart:m.value,timeEnd:v.value?Number(v.value)+86399:void 0},1),l.value=1}),onKeyup:y[2]||(y[2]=A((e=>{t("load",{keyword:s.value||void 0,status:c.value||void 0,timeStart:m.value,timeEnd:v.value?Number(v.value)+86399:void 0},1),l.value=1}),["enter"])),onClear:y[3]||(y[3]=e=>{t("load",{keyword:s.value||void 0,status:c.value||void 0,timeStart:m.value,timeEnd:v.value?Number(v.value)+86399:void 0},1),l.value=1})},null,8,["modelValue","prefix-icon"])):g("",!0),a.serchKeys.includes("status")?(o(),i("div",Ea,[p(x,{modelValue:c.value,"onUpdate:modelValue":y[4]||(y[4]=e=>c.value=e),style:{width:"90px"},placeholder:"全部",clearable:"",onChange:y[5]||(y[5]=e=>{t("load",{keyword:s.value||void 0,status:c.value||void 0,timeStart:m.value,timeEnd:v.value?Number(v.value)+86399:void 0},1),l.value=1})},{default:h((()=>[a.serchKeys.includes("status2")?(o(),i(d,{key:0},[p(k,{label:"待受理",value:100}),p(k,{label:"处理中",value:200}),p(k,{label:"已完成",value:300}),p(k,{label:"已关闭",value:400})],64)):(o(),i(d,{key:1},[p(k,{label:"待付款",value:1}),p(k,{label:"成功",value:2}),p(k,{label:"失败",value:3})],64))])),_:1},8,["modelValue"]),a.serchKeys.includes("timeStart")?(o(),f(_,{key:0,style:{flex:"1"},clearable:"","value-format":"X",onChange:y[6]||(y[6]=e=>{t("load",{keyword:s.value||void 0,status:c.value||void 0,timeStart:m.value,timeEnd:v.value?Number(v.value)+86399:void 0},1),l.value=1}),modelValue:m.value?[m.value,v.value]:[],"onUpdate:modelValue":y[7]||(y[7]=e=>[m.value,v.value]=e||[]),type:"daterange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])):g("",!0)])):g("",!0),a.data&&0!==a.data.length?(o(),i(d,{key:3},[u("ul",$a,[(o(!0),i(d,null,r(a.data,(a=>(o(),i("li",{key:a.id},[I(e.$slots,"default",{row:a},void 0,!0)])))),128))]),p(w,{"page-size":30,"pager-count":5,"current-page":a.pageIndex,"onUpdate:currentPage":y[8]||(y[8]=e=>t("nextPage",e)),layout:"prev, pager, next",total:a.total,style:{"margin-left":"auto"}},null,8,["current-page","total"])],64)):(o(),i("div",Ra,Ma))],64)}}},[["__scopeId","data-v-b70d4895"]]),ja=e=>(_("data-v-a36d052d"),e=e(),w(),e),qa={class:"usernfo"},Ba={class:"top"},Ka={class:"base"},Oa={class:"name ellipsis"},Fa={class:"level ellipsis"},Da={class:"state",style:{color:"#4b82fa"}},Ja={class:"achievement"},Ya={class:"money"},Ga={class:"label"},Qa={class:"other-info"},Wa={class:"label"},Xa={class:"content ellipsis"},Za={class:"list-item"},et=ja((()=>u("span",{class:"label"},"订单号：",-1))),at={class:"content"},tt={key:0,class:"other",style:{color:"#faad14"}},lt={key:1,class:"other",style:{color:"#52c41a"}},st={key:2,class:"other",style:{color:"#ff4d4f"}},nt=ja((()=>u("span",{class:"label"},"金额：",-1))),ot={class:"content"},it={class:"other"},dt=ja((()=>u("span",{class:"label"},"创建时间：",-1))),rt={class:"content"},ct=ja((()=>u("span",{class:"label"},"说明：",-1))),ut={class:"content"},pt=["onClick"],mt=[ja((()=>u("p",{class:"btn"},"发送",-1)))],vt={class:"list-item"},gt=ja((()=>u("span",{class:"label"},"提现金额：",-1))),yt={class:"content"},ft={key:0,class:"other",style:{color:"#f7ad1e"}},ht={key:1,class:"other",style:{color:"#4e83f7"}},bt={key:2,class:"other",style:{color:"#55c31f"}},kt={key:3,class:"other",style:{color:"#d9d9d9"}},xt=ja((()=>u("span",{class:"label"},"手续费：",-1))),_t={class:"content"},wt=ja((()=>u("span",{class:"label"},"提现地址：",-1))),It={class:"content"},Ct=ja((()=>u("span",{class:"label"},"发起时间：",-1))),Vt={class:"content"},Lt={class:"btnBox"},Nt=ja((()=>u("p",{class:"btn"},"修改状态",-1))),St=["onClick"],Ut=["onClick"],zt=["onClick"],Tt={class:"list-item"},Pt=ja((()=>u("span",{class:"label"},"订单号：",-1))),At={class:"content"},Et=ja((()=>u("span",{class:"label"},"充值账号：",-1))),Rt={class:"content"},Mt=ja((()=>u("span",{class:"label"},"获得佣金：",-1))),$t={class:"content"},Ht=ja((()=>u("span",{class:"label"},"提成时间：",-1))),jt={class:"content"},qt=["onClick"],Bt=[ja((()=>u("p",{class:"btn"},"发送",-1)))],Kt={class:"list-item team"},Ot=ja((()=>u("span",{class:"label"},"账号：",-1))),Ft={class:"content"},Dt=ja((()=>u("span",{class:"label"},"代理等级：",-1))),Jt={class:"content"},Yt=ja((()=>u("span",{class:"label"},"账号状态：",-1))),Gt={class:"content"},Qt=ja((()=>u("span",{class:"label"},"推广码：",-1))),Wt={class:"content"},Xt={class:"dialog-footer"},Zt=ie({__name:"index",props:{id:{required:!0}},setup(a){const c=a,{$http:b}=j().appContext.config.globalProperties,k=e("个人信息"),x=C({value:{},keyword:"",listValue:[],get(){c.id&&b.get("/api/v1/customer/customer/agent_member/profile",{params:{memberId:c.id}}).then((e=>{x.value=e.data,x.listValue=[{label:"账号ID",value:e.data.memberId},{label:"账号",value:e.data.username},{label:"性别",value:1===e.data.sex?"男":2===e.data.sex?"女":"未知"},{label:"手机号",value:e.data.mobile||"未绑定"},{label:"邮箱",value:e.data.email||"未绑定"},{label:"最近登录IP",value:e.data.lastLoginIp||"-"},{label:"注册时间",value:e.data.registeredAt?re(e.data.registeredAt):"-"},{label:"最近登录时间",value:e.data.lastLoginAt?re(e.data.lastLoginAt):"-"},{label:"个性签名",value:e.data.signature||"-"},{label:"会员到期日期",value:e.data.expireTime?re(e.data.expireTime):"未开通会员"},{label:"上级代理",value:e.data.patent1Username||"-"},{label:"所属团队",value:e.data.patent2Username||"-"}]}))}}),_=C({value:[],pageIndex:1,searchV:{},total:0,load(e,a){void 0!==e&&(_.searchV=e,_.pageIndex=1),_.pageIndex=a||_.pageIndex,b.get("/api/v1/customer/customer/agent_member/recharge",{params:{..._.searchV,page:_.pageIndex,limit:30,memberId:c.id}}).then((e=>{_.value=e.data.list,_.total=e.data.total}))}}),w=C({value:[],searchV:{},pageIndex:1,total:0,load(e,a){void 0!==e&&(w.searchV=e,w.pageIndex=1),w.pageIndex=a||w.pageIndex,b.get("/api/v1/customer/customer/agent_member/withdraw",{params:{...w.searchV,page:w.pageIndex,limit:30,memberId:c.id}}).then((e=>{w.value=e.data.list||[],w.total=e.data.total}))}}),I=C({value:[],searchV:{},pageIndex:1,total:0,load(e,a){void 0!==e&&(I.searchV=e,I.pageIndex=1),I.pageIndex=a||I.pageIndex,b.get("/api/v1/customer/customer/agent_member/brokerage",{params:{...I.searchV,page:I.pageIndex,limit:30,memberId:c.id}}).then((e=>{I.value=e.data.list||[],I.total=e.data.total}))}}),V=C({value:[],searchV:{},pageIndex:1,total:0,load(e,a){void 0!==e&&(V.searchV=e,V.pageIndex=1),V.pageIndex=a||V.pageIndex,b.get("/api/v1/customer/customer/agent_member/team",{params:{...V.searchV,page:V.pageIndex,limit:30,memberId:c.id}}).then((e=>{V.value=e.data.list||[],V.total=e.data.total}))}});let S;q((()=>{k.value="个人信息",clearInterval(S)})),t((()=>c.id),(e=>{clearInterval(S),e&&(x.get(),_.load(""),w.load(""),I.load(""),V.load("")),S=setInterval((()=>{c.id?(x.get(),_.load(),w.load(),I.load(),V.load()):(x.value={},_.value=[],w.value=[],I.value=[],V.value=[])}),3e3)}),{immediate:!0});const A=C({visible:!1,withdraw:void 0,because:"",status:0,success(){if(!A.because)return void L({position:"bottom-right",title:"提示",type:"error",message:"请填写"+(400===A.status?"关闭原因":"摘要")});let e=A.withdraw;b.post("/api/v1/customer/customer/handle/withdraw",{remark:A.because,status:A.status,withdrawId:e.withdrawId}).then((a=>{de.dispatch("send",{v:JSON.stringify({amount:e.amount,status:A.status,handleFee:e.handleFee,address:e.address,statusAt:e.createAt,because:A.because,type:"withdrawChangeStatus"}),type:6}),e.status=A.status,A.visible=!1,A.withdraw=void 0,A.because="",w.load(),L({position:"bottom-right",title:"提示",type:"success",message:"状态修改成功"})}))}});de.state.socket.onMessageEvent.add((e=>{6===e.category&&c.id&&(x.get(),_.load(""),w.load(""),I.load(""),V.load(""))}));const R={statusbar:!1,menubar:!1,paste_as_text:!0,powerpaste_allow_local_images:!0,paste_data_images:!0,block_unsupported_drop:!1,quickbars_insert_toolbar:!1,language:"zh_CN",convert_urls:!1,height:300,width:700,language_url:"./tinymce/langs.js",font_size_formats:"12px 14px 16px 18px 24px 36px",paste_preprocess:(e,a)=>{inputValue.value=a.content},toolbar:"undo redo | bold italic underline strikethrough forecolor backcolor | fontsize alignleft aligncenter alignright alignjustify bullist numlist  ",plugins:"image ",file_picker_types:"file image"},M=e=>{let a=new Set;e.on("keyup",(function(e){a.delete(e.key)})),e.on("change",(function(){var a;let t=e.getContent();null==(a=t.match(new RegExp('(?<=(img[^>]*src="))[^"]*',"g")))||a.forEach((e=>{t=t.replace(e,`${e}?t=${(new Date).getTime()}`)})),e.setContent(t)})),e.on("keydown",(function(e){if(a.add(e.key),1===a.size&&"Enter"===a.values().next().value)return e.stopPropagation(),e.preventDefault(),submit(),!1}))};return(e,a)=>{var t;const c=l,b=E,C=z,L=B,S=T,$=K,H=O,j=F;return o(),i("div",qa,[u("div",Ba,[u("div",Ka,[p(c,{size:60,icon:n(m),src:x.value.avatar,class:"avatar"},null,8,["icon","src"]),u("p",Oa,v(x.value.nickname||x.value.username),1),u("p",Fa,v(x.value.agentName),1),u("span",Da,v((null==(t=n(de).getters.currentClient)?void 0:t.online)?"对话中...":"对方已离线"),1)]),u("div",Ja,[(o(),i(d,null,r([{key:"totalPerformance",label:"总业绩"},{key:"brokerageCashed",label:"已提佣金"},{key:"freezeBrokerage",label:"冻结佣金"},{key:"usableBrokerage",label:"可提佣金"}],(e=>u("div",{key:e.label},[u("p",Ya,v(x.value[e.key]||0),1),u("p",Ga,v(e.label),1)]))),64))])]),p(S,{modelValue:k.value,"onUpdate:modelValue":a[5]||(a[5]=e=>k.value=e),type:"border-card",class:"table-tab"},{default:h((()=>[p(N,{name:"list",tag:"ul",style:{height:"100%"}},{default:h((()=>[p(C,{label:"个人信息",name:"个人信息",key:"个人信息"},{default:h((()=>[p(b,{modelValue:x.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>x.keyword=e),placeholder:"请输入您想搜索的关键字",clearable:"",style:{width:"100%"},"prefix-icon":n(P)},null,8,["modelValue","prefix-icon"]),u("div",Qa,[(o(!0),i(d,null,r(x.listValue,(e=>s((o(),i("p",null,[u("span",Wa,v(e.label),1),u("span",Xa,v(e.value),1)],512)),[[U,e.label.includes(x.keyword)||e.value.includes(x.keyword)]]))),256))])])),_:1}),p(C,{label:"充值记录",name:"充值记录",key:"充值记录"},{default:h((()=>[p(Ha,{serchKeys:["keyword","status","timeStart"],data:_.value,pageIndex:_.pageIndex,total:_.total,onLoad:_.load,onNextPage:a[1]||(a[1]=e=>_.load(void 0,e))},{default:h((({row:e})=>[u("div",Za,[u("p",null,[et,u("span",at,v(e.orderNo||"-"),1),1===e.payStatus?(o(),i("span",tt,"待付款")):g("",!0),2===e.payStatus?(o(),i("span",lt,"成功")):g("",!0),3===e.payStatus?(o(),i("span",st,"失败")):g("",!0)]),u("p",null,[nt,u("span",ot,v(e.amount||0),1),u("span",it,v(["-","支付宝","微信","第三方支付"][e.payType]),1)]),u("p",null,[dt,u("span",rt,v(e.placeAt?n(re)(e.placeAt):"-"),1)]),u("p",null,[ct,u("span",ut,v(e.title||"-"),1)]),u("div",{class:"btnBox",onClick:a=>n(de).dispatch("send",{v:JSON.stringify({amount:e.amount,orderNo:e.orderNo,payAt:e.placeAt,payStatus:e.payStatus,payType:e.payType,title:e.title}),type:6})},mt,8,pt)])])),_:1},8,["data","pageIndex","total","onLoad"])])),_:1}),p(C,{label:"提现记录",name:"提现记录",key:"提现记录"},{default:h((()=>[p(Ha,{serchKeys:["keyword","status","timeStart","status2"],data:w.value,pageIndex:w.pageIndex,onLoad:w.load,onNextPage:a[2]||(a[2]=e=>w.load(void 0,e))},{default:h((({row:e})=>[u("div",vt,[u("p",null,[gt,u("span",yt,v(e.amount||0)+"(元)",1),100===e.status?(o(),i("span",ft,"待受理")):g("",!0),200===e.status?(o(),i("span",ht,"处理中")):g("",!0),300===e.status?(o(),i("span",bt,"已完成")):g("",!0),400===e.status?(o(),i("span",kt,"已关闭")):g("",!0)]),u("p",null,[xt,u("span",_t,v(e.handleFee||0)+"(元)",1)]),u("p",null,[wt,u("span",It,v(e.address||"-"),1)]),u("p",null,[Ct,u("span",Vt,v(e.createAt?n(re)(e.createAt):"-"),1)]),u("div",Lt,[100===e.status?(o(),f(L,{key:0,trigger:"click",width:185,"popper-style":"padding: 0;"},{reference:h((()=>[Nt])),default:h((()=>[u("p",{style:{"line-height":"40px","text-align":"center",cursor:"pointer"},class:"changeState",onClick:a=>{A.visible=!0,A.withdraw=e,A.status=400}}," 关闭 ",8,St),u("p",{style:{"line-height":"40px","border-top":"1px solid #f1f1f1","text-align":"center",cursor:"pointer"},class:"changeState",onClick:a=>{A.withdraw=e,A.visible=!0,A.status=300}}," 完成 ",8,Ut)])),_:2},1024)):g("",!0),u("p",{class:"btn",onClick:a=>n(de).dispatch("send",{v:JSON.stringify({amount:e.amount,status:e.status,handleFee:e.handleFee,address:e.address,statusAt:e.createAt,type:"withdraw"}),type:6})}," 发送 ",8,zt)])])])),_:1},8,["data","pageIndex","onLoad"])])),_:1}),p(C,{label:"佣金记录",name:"佣金记录",key:"佣金记录"},{default:h((()=>[p(Ha,{data:I.value,pageIndex:I.pageIndex,onLoad:I.load,serchKeys:["keyword","timeStart"],onNextPage:a[3]||(a[3]=e=>I.load(void 0,e))},{default:h((({row:e})=>[u("div",Tt,[u("p",null,[Pt,u("span",At,v(e.orderNo||"-"),1)]),u("p",null,[Et,u("span",Rt,v(e.rechargeUsername||"-"),1)]),u("p",null,[Mt,u("span",$t,v(e.amount||0)+"(元)",1)]),u("p",null,[Ht,u("span",jt,v(e.timeAt?n(re)(e.timeAt):"-"),1)]),u("div",{class:"btnBox",onClick:a=>n(de).dispatch("send",{v:JSON.stringify({amount:e.amount,orderNo:e.orderNo,rechargeUsername:e.rechargeUsername,timeAt:e.timeAt,type:"commission"}),type:6})},Bt,8,qt)])])),_:1},8,["data","pageIndex","onLoad"])])),_:1}),p(C,{label:"他的团队",name:"他的团队",key:"他的团队"},{default:h((()=>[p(Ha,{data:V.value,pageIndex:V.pageIndex,onLoad:V.load,onNextPage:a[4]||(a[4]=e=>V.load(void 0,e))},{default:h((({row:e})=>[u("div",Kt,[u("p",null,[Ot,u("span",Ft,v(e.username||"-"),1)]),u("p",null,[Dt,u("span",Jt,v(e.agentLevelName||"-"),1)]),u("p",null,[Yt,u("span",Gt,v(1===e.agentLevelLock?"账号锁定":"账号未锁定"),1)]),u("p",null,[Qt,u("span",Wt,v(e.inviteCode||"-"),1)])])])),_:1},8,["data","pageIndex","onLoad"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),p(j,{modelValue:A.visible,"onUpdate:modelValue":a[8]||(a[8]=e=>A.visible=e),title:400===A.status?"关闭原因":"摘要",width:"800px",onClosed:a[9]||(a[9]=e=>A.because=""),"close-on-click-modal":!1},{footer:h((()=>[u("span",Xt,[p(H,{onClick:a[7]||(a[7]=e=>{A.visible=!1,A.withdraw=void 0}),size:"small"},{default:h((()=>[y("取消")])),_:1}),p(H,{type:"primary",onClick:A.success,size:"small"},{default:h((()=>[y(" 确定 ")])),_:1},8,["onClick"])])])),default:h((()=>[p($,{label:400===A.status?"关闭原因":"摘要",prop:"desc"},{default:h((()=>[p(ve,{setup:M,modelValue:A.because,"onUpdate:modelValue":a[6]||(a[6]=e=>A.because=e),placeholder:"请输入关闭该提现申请的原因",setting:{...R,paste_preprocess:(e,a)=>{A.because=a.content}}},null,8,["modelValue","setting"])])),_:1},8,["label"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-a36d052d"]]),el=e=>(_("data-v-e0fce2bd"),e=e(),w(),e),al={key:0,class:"null-client"},tl=[el((()=>u("img",{src:pe,alt:""},null,-1))),el((()=>u("p",null,"暂无数据",-1)))],ll={class:"infinite-list",style:{overflow:"auto",flex:"1"}},sl={style:{flex:"1 0 0","min-width":"0"}},nl={class:"username"},ol={class:"mes"},il={class:"date"},dl=["innerHTML"],rl=["innerHTML"],cl=ie({__name:"list",props:{data:{type:Array,default:()=>[]},pageIndex:{type:Number,default:()=>1},total:{type:Number,default:()=>1}},emits:["load","nextPage"],setup(a,{emit:t}){const l=e(1),s=e();return(e,c)=>{const m=E,f=H;return o(),i(d,null,[p(m,{placeholder:"请输入您想搜索的关键字",clearable:"",modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=e=>s.value=e),"prefix-icon":n(P),style:{width:"100%"},onBlur:c[1]||(c[1]=e=>{t("load",s.value,1),l.value=1}),onKeyup:c[2]||(c[2]=A((e=>{t("load",s.value,1),l.value=1}),["enter"])),onClear:c[3]||(c[3]=e=>{t("load",s.value,1),l.value=1})},null,8,["modelValue","prefix-icon"]),a.data&&0!==a.data.length?(o(),i(d,{key:1},[u("ul",ll,[(o(!0),i(d,null,r(a.data,(a=>(o(),i("div",{key:a.id,class:"list-item"},[u("div",sl,[u("p",nl,v(a.senderUsername),1),u("p",ol,[u("span",il,v(n(D)(a.sendAt).format("YYYY-MM-DD HH:mm:ss")),1),1===a.category?(o(),i("span",{key:0,style:{},innerHTML:a.content.replace(/<img.+?>/g,"【图片】")},null,8,dl)):g("",!0),7===a.category?(o(),i("span",{key:1,style:{},innerHTML:a.content},null,8,rl)):2===a.category?(o(),i(d,{key:2},[y(" 【图片】 ")],64)):3===a.category?(o(),i(d,{key:3},[y(" 【文件】 ")],64)):4===a.category?(o(),i(d,{key:4},[y(" 【音频】 ")],64)):5===a.category?(o(),i(d,{key:5},[y(" 【视频】 ")],64)):6===a.category?(o(),i(d,{key:6},[y(" 【订单】 ")],64)):g("",!0)])]),I(e.$slots,"default",{row:a},void 0,!0)])))),128))]),p(f,{"page-size":30,"pager-count":5,"current-page":a.pageIndex,"onUpdate:currentPage":c[4]||(c[4]=e=>t("nextPage",e)),layout:"prev, pager, next",total:a.total,style:{"margin-left":"auto"}},null,8,["current-page","total"])],64)):(o(),i("div",al,tl))],64)}}},[["__scopeId","data-v-e0fce2bd"]]),ul=e=>(_("data-v-4ba851ec"),e=e(),w(),e),pl={class:"usernfo"},ml={class:"top"},vl={class:"base"},gl={class:"name"},yl={class:"level ellipsis"},fl={class:"t"},hl={style:{border:"0",float:"right"}},bl={style:{display:"flex","flex-wrap":"wrap","flex-direction":"column"}},kl={class:"t",style:{width:"55px","box-sizing":"border-box","margin-left":"0",border:"0",padding:"0"}},xl={class:"title"},_l={class:"edit-info"},wl=ul((()=>u("p",{class:"title"},"在线服务",-1))),Il={class:"content"},Cl=ul((()=>u("p",{class:"label"},"已完成对话",-1))),Vl={class:"content"},Ll=ul((()=>u("p",{class:"label"},"已完成留言",-1))),Nl={class:"content"},Sl=ul((()=>u("p",{class:"label"},"未完成对话",-1))),Ul=ie({__name:"index",props:{id:{required:!0}},setup(a){const c=a,{$http:b}=j().appContext.config.globalProperties,_=e(!1),w=e("已完成对话"),I=e(0),V=C({visible:!1,data:[],loading:!1,client:{},get(e){e.consultId=e.consult_id,e.mesList||(e.mesList=[]),V.client=e,V.visible=!0}}),S=e(),U=C({value:[],keyword:"",pageIndex:1,total:0,load(e,a){void 0!==e&&(U.keyword=e,U.pageIndex=1),U.pageIndex=a||U.pageIndex,b.get("/api/v1/customer/customer/online/handled/msg",{params:{keyword:U.keyword||void 0,page:U.pageIndex,limit:30}}).then((e=>{U.value=e.data.list,U.total=e.data.total}))}});U.load();const P=C({value:[],keyword:"",pageIndex:1,total:0,load(e,a){void 0!==e&&(P.keyword=e,P.pageIndex=1),P.pageIndex=a||P.pageIndex,b.get("/api/v1/customer/customer/online/handled/msg/leave",{params:{keyword:P.keyword||void 0,page:P.pageIndex,limit:30}}).then((e=>{P.value=e.data.list,P.total=e.data.total}))}});P.load();const A=C({value:[],keyword:"",pageIndex:1,total:0,load(e,a){void 0!==e&&(A.keyword=e,A.pageIndex=1),A.pageIndex=a||A.pageIndex,b.get("/api/v1/customer/customer/online/not_handled/msg/leave",{params:{keyword:A.keyword||void 0,page:A.pageIndex,limit:30}}).then((e=>{A.value=e.data.list,A.total=e.data.total}))}});A.load(),t((()=>c.id),(e=>{}));const E=J("childEvents");E.onlineServicesReset=function(){U.value=[],P.value=[],A.value=[],U.load(),P.load(),A.load()},t((()=>de.state.socket.list.size),(e=>{window.sessionStorage.getItem("csToken")&&E.onlineServicesReset()}));return(e,a)=>{var t,c,b,C,E;const R=l,M=k,$=B,H=K,j=O,q=Q,D=z,J=T,W=F,X=x;return o(),i("div",pl,[u("div",ml,[u("div",vl,[p(R,{size:60,icon:n(m),src:null==(t=n(de).getters.userInfo)?void 0:t.headImg,class:"avatar"},null,8,["icon","src"]),u("p",gl,v(n(de).getters.userInfo.nickName),1),u("p",yl,[(o(!0),i(d,null,r(null==(c=n(de).getters.userInfo.labels)?void 0:c.slice(0,3),(e=>(o(),i("span",fl,v(e.title||e),1)))),256)),(null==(b=n(de).getters.userInfo.labels)?void 0:b.length)>3?(o(),f($,{key:0,placement:"bottom",width:80,trigger:"click",teleported:!1},{reference:h((()=>[u("span",hl,[y("其他标签 "),p(M,{style:{"vertical-align":"text-top"}},{default:h((()=>[p(n(Y))])),_:1})])])),default:h((()=>{var e;return[u("div",bl,[(o(!0),i(d,null,r(null==(e=n(de).getters.userInfo.labels)?void 0:e.slice(3),(e=>(o(),i("span",kl,v(e.title||e),1)))),256))])]})),_:1})):g("",!0)])]),u("p",xl,[y(" 基础资料 "),p(M,{class:"point"},{default:h((()=>[p(n(G),{onClick:a[0]||(a[0]=e=>{I.value=1,_.value=!0})})])),_:1})]),u("div",_l,[p(q,{ref_key:"ruleFormRef",ref:S,"label-width":"40px",model:n(de).getters.userInfo},{default:h((()=>[p(H,{label:"账号"},{default:h((()=>[y(v(n(de).getters.userInfo.userName)+" ",1)])),_:1}),p(H,{label:"昵称"},{default:h((()=>[y(v(n(de).getters.userInfo.nickName)+" ",1)])),_:1}),p(H,{label:"性别"},{default:h((()=>[y(v(1===n(de).getters.userInfo.sex?"男":2===n(de).getters.userInfo.sex?"女":"未知"),1)])),_:1}),p(H,{label:"密码"},{default:h((()=>[y(" ******** "),p(j,{type:"warning",style:{"margin-left":"20px"},onClick:a[1]||(a[1]=e=>{I.value=0,_.value=!0}),link:""},{default:h((()=>[y("修改")])),_:1})])),_:1})])),_:1},8,["model"])])]),wl,p(J,{modelValue:w.value,"onUpdate:modelValue":a[5]||(a[5]=e=>w.value=e),type:"border-card",class:"table-tab"},{default:h((()=>[p(N,{name:"list",tag:"ul",style:{display:"flex","flex-direction":"column",height:"100%"}},{default:h((()=>[p(D,{label:"已完成对话",name:"已完成对话",key:"已完成对话"},{label:h((()=>[u("p",Il,v(U.total),1),Cl])),default:h((()=>[p(cl,{data:U.value,pageIndex:U.pageIndex,total:U.total,onLoad:U.load,onNextPage:a[2]||(a[2]=e=>U.load(void 0,e))},{default:h((({row:e})=>[p(j,{type:"primary",link:"",onClick:a=>V.get(e)},{default:h((()=>[y(" 查看 ")])),_:2},1032,["onClick"])])),_:1},8,["data","pageIndex","total","onLoad"])])),_:1}),p(D,{label:"已完成留言",name:"已完成留言",key:"已完成留言"},{label:h((()=>[u("p",Vl,v(P.total),1),Ll])),default:h((()=>[p(cl,{data:P.value,pageIndex:P.pageIndex,onLoad:P.load,total:P.total,onNextPage:a[3]||(a[3]=e=>P.load(void 0,e))},{default:h((({row:e})=>[p(j,{type:"primary",link:"",onClick:a=>V.get(e)},{default:h((()=>[y(" 查看 ")])),_:2},1032,["onClick"])])),_:1},8,["data","pageIndex","onLoad","total"])])),_:1}),p(D,{label:"未完成对话",name:"未完成对话",key:"未完成对话"},{label:h((()=>[u("p",Nl,v(A.total),1),Sl])),default:h((()=>[p(cl,{data:A.value,pageIndex:A.pageIndex,onLoad:A.load,total:A.total,onNextPage:a[4]||(a[4]=e=>A.load(void 0,e))},{default:h((({row:e})=>{var a;return[(null==(a=n(de).state.socket.currentClient)?void 0:a.consultId)!==e.consult_id?(o(),f(j,{key:0,type:"primary",link:"",onClick:a=>(e=>{const a=de.state.socket.list.get(e.consult_id);a?(de.dispatch("switchClient",a),tab.activeName="当前对话"):(e.consultId=e.consult_id,de.dispatch("addClient",{client:e,type:2}).then((e=>{de.dispatch("switchClient",e),L({position:"bottom-right",title:"提示",message:"切换成功",type:"success"})})).catch((e=>{L({position:"bottom-right",title:"提示",message:"聊天接入失败，请稍后重试",type:"error"})})))})(e)},{default:h((()=>[y(" 立即处理 ")])),_:2},1032,["onClick"])):(o(),f(j,{key:1,type:"primary",link:""},{default:h((()=>[y(" 对话中 ")])),_:1}))]})),_:1},8,["data","pageIndex","onLoad","total"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),p(me,{visible:_.value,"onUpdate:visible":a[6]||(a[6]=e=>_.value=e),type:I.value,"onUpdate:type":a[7]||(a[7]=e=>I.value=e)},null,8,["visible","type"]),p(W,{modelValue:V.visible,"onUpdate:modelValue":a[8]||(a[8]=e=>V.visible=e),title:((null==(E=null==(C=V.client.mesList)?void 0:C[0])?void 0:E.masterUserName)||"")+"的聊天记录",width:"880px","close-on-click-modal":!1},{default:h((()=>[s(p(va,{style:{height:"45vh"},class:"dis-list",client:V.client},null,8,["client"]),[[X,V.loading]])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-4ba851ec"]]),zl=e=>(_("data-v-75d914d4"),e=e(),w(),e),Tl={class:"null-client"},Pl=[zl((()=>u("img",{src:ue,alt:""},null,-1))),zl((()=>u("p",null,"当前没有访客，赶快去接入吧",-1)))],Al=ie({__name:"index",props:{userId:{required:!0},currentClient:{type:Object}},setup(a){const t=e("访客信息");return(e,l)=>{const i=z,d=T;return o(),f(d,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value=e),type:"border-card",class:"infoTab"},{default:h((()=>[p(N,{name:"list",tag:"ul",style:{height:"100%",display:"flex","flex-direction":"column"}},{default:h((()=>[p(i,{label:"访客信息",name:"访客信息",key:"访客信息"},{default:h((()=>[s(u("div",Tl,Pl,512),[[U,!a.userId]]),s(p(Zt,{id:a.userId},null,8,["id"]),[[U,a.userId]])])),_:1}),p(i,{label:"我的信息",name:"我的信息",key:"我的信息"},{default:h((()=>[p(Ul,{id:n(de).state.userInfo.uuid},null,8,["id"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-75d914d4"]]),El={class:"list"},Rl={class:"list-wra"},Ml={style:{"flex-shrink":"0"}},$l=["onClick"],Hl={style:{"flex-shrink":"0"}},jl=["innerHTML"],ql=ie({__name:"commonlyProblem",setup(a){const{$http:t}=j().appContext.config.globalProperties,l=e(!1),c=e(),m=e(!1),g=e(),b=e(!1),_={1:"注册",2:"充值",3:"套餐购买",4:"图文",5:"播放"},w=C({value:[],get(){t.get("/api/v1/customer/qa",{params:{limit:500}}).then((e=>{w.value=e.data.list}))}}),I=e=>{l.value=!0;let a=JSON.parse(JSON.stringify(e));Z((()=>{c.value.init(a,Math.max(...w.value.map((e=>e.sort)))||0)}))};return w.get(),(e,a)=>{const C=O,V=ee,N=k,S=B,U=ae,z=te,T=Q,P=F,A=x;return o(),i(d,null,[p(S,{placement:"top",width:335,trigger:"click",teleported:!1},{reference:h((()=>[p(C,{round:""},{default:h((()=>[y("常见问题")])),_:1})])),default:h((()=>[u("div",El,[u("div",Rl,[(o(!0),i(d,null,r(w.value,((e,a)=>(o(),f(V,{effect:"light",placement:"top-start",teleported:!1},{content:h((()=>[u("div",null,[u("span",Ml,v(e.sort)+".",1),y(" "+v(e.title),1)])])),default:h((()=>[u("p",{onClick:a=>n(de).dispatch("send",{v:e.content,type:1})},[u("span",Hl,v(e.sort)+".",1),y(" "+v(e.title),1)],8,$l)])),_:2},1024)))),256))]),u("p",{class:"customer",onClick:a[0]||(a[0]=e=>m.value=!0)},[p(N,null,{default:h((()=>[p(n(W))])),_:1}),y("自定义 ")])])])),_:1}),p(P,{modelValue:m.value,"onUpdate:modelValue":a[4]||(a[4]=e=>m.value=e),title:"自定义常见问题",width:"640px","destroy-on-close":"",onClose:a[5]||(a[5]=e=>w.get())},{default:h((()=>[p(C,{onClick:a[1]||(a[1]=e=>I("add")),style:{"margin-bottom":"16px"}},{default:h((()=>[y("+ 添加")])),_:1}),s((o(),f(T,{ref_key:"ruleFormRef",ref:g,"label-width":"0",model:w.value,class:"form","hide-required-asterisk":!1},{default:h((()=>[p(z,{data:w.value,style:{width:"100%"},height:"300"},{default:h((()=>[p(U,{prop:"sort",label:"顺序",width:"110"},{default:h((({row:e,$index:a})=>[y(v(e.sort),1)])),_:1}),p(U,{prop:"sort",label:"类型",width:"110"},{default:h((({row:e,$index:a})=>[y(v(_[e.type]),1)])),_:1}),p(U,{prop:"title",label:"标题",width:"110","show-overflow-tooltip":!0},{default:h((({row:e,$index:a})=>[y(v(e.title),1)])),_:1}),p(U,{prop:"content",label:"内容","show-overflow-tooltip":!0},{default:h((({row:e,$index:a})=>[u("p",{innerHTML:e.content},null,8,jl)])),_:1}),p(U,{prop:"location",label:"操作",align:"right",width:"140px"},{default:h((({row:e,$index:a})=>[p(C,{type:"primary",onClick:a=>{n(de).dispatch("send",{v:e.content,type:1}),l.value=!1,m.value=!1},link:""},{default:h((()=>[y("发送")])),_:2},1032,["onClick"]),p(C,{type:"primary",onClick:a=>I(e.id),link:""},{default:h((()=>[y("编辑")])),_:2},1032,["onClick"]),p(C,{type:"danger",link:"",onClick:l=>((e,a)=>{X.confirm("确定要删除这条常见问题吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e.id?t.delete("/api/v1/customer/qa",{data:{ids:[e.id]}}).then((e=>{w.value.splice(a,1),L({position:"bottom-right",title:"提示",type:"success",message:"删除成功"})})):(w.value.splice(a,1),L({position:"bottom-right",title:"提示",type:"success",message:"删除成功"}))}))})(e,a)},{default:h((()=>[y(v(e.id?"删除":"移除"),1)])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["model"])),[[A,b.value]]),p(ge,{visible:l.value,"onUpdate:visible":a[2]||(a[2]=e=>l.value=e),ref_key:"updateRef",ref:c,onRefreshDataList:a[3]||(a[3]=e=>w.get())},null,8,["visible"])])),_:1},8,["modelValue"])],64)}}},[["__scopeId","data-v-0e949028"]]),Bl={class:"list"},Kl={class:"list-wra"},Ol=["onClick"],Fl={class:"dialog-footer"},Dl=ie({__name:"commonlyUsed",setup(a){const{$http:t}=j().appContext.config.globalProperties,l=e(!1),c=e(),m=e(!1),g=C({value:[],get(){t.get("/api/v1/customer/express",{params:{limit:500}}).then((e=>{g.value=e.data.list||[]}))}}),b=()=>{var e;null==(e=c.value)||e.validate((e=>{e&&(m.value=!0,t.post("/api/v1/customer/express/batch",g.value).then((e=>{l.value=!1,g.get(),L({position:"bottom-right",title:"提示",type:"success",message:"保存成功"})})).finally((e=>{m.value=!1})))}))};return g.get(),(e,a)=>{const _=O,w=ee,I=k,C=B,V=le,N=K,S=ae,U=E,z=te,T=Q,P=F,A=x;return o(),i(d,null,[p(C,{placement:"top",width:335,trigger:"click",teleported:!1},{reference:h((()=>[p(_,{round:""},{default:h((()=>[y("常用语")])),_:1})])),default:h((()=>[u("div",Bl,[u("div",Kl,[(o(!0),i(d,null,r(g.value.filter((e=>e.id)),((e,a)=>(o(),f(w,{effect:"light",placement:"top-start",teleported:!1},{content:h((()=>[u("div",null,v(e.sort)+"."+v(e.content),1)])),default:h((()=>[u("p",{onClick:a=>n(de).dispatch("send",{v:e.content,type:1})},v(e.sort)+"."+v(e.content),9,Ol)])),_:2},1024)))),256))]),u("p",{class:"customer",onClick:a[0]||(a[0]=e=>l.value=!0)},[p(I,null,{default:h((()=>[p(n(W))])),_:1}),y("自定义 ")])])])),_:1}),p(P,{modelValue:l.value,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value=e),title:"自定义常用语",width:"640px","destroy-on-close":"",onClose:a[3]||(a[3]=e=>g.get())},{footer:h((()=>[u("span",Fl,[p(_,{type:"primary",onClick:b,size:"small"},{default:h((()=>[y(" 保存并更新 ")])),_:1})])])),default:h((()=>[p(_,{onClick:a[1]||(a[1]=e=>g.value.push({})),style:{"margin-bottom":"16px"}},{default:h((()=>[y("+ 添加")])),_:1}),s((o(),f(T,{ref_key:"ruleFormRef",ref:c,"label-width":"0",model:g.value,class:"form","hide-required-asterisk":!1},{default:h((()=>[p(z,{data:g.value,style:{width:"100%"},height:"300"},{default:h((()=>[p(S,{prop:"sort",label:"顺序",width:"110"},{default:h((({row:e,$index:a})=>[p(N,{rules:{required:!0,message:"请输入顺序"},prop:[a,"sort"],"label-width":"0"},{default:h((()=>[p(V,{modelValue:e.sort,"onUpdate:modelValue":a=>e.sort=a,modelModifiers:{number:!0},clearable:"",precision:0,style:{width:"80px"},placeholder:"顺序","step-strictly":"",min:1,controls:!1},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1}),p(S,{prop:"content",label:"内容"},{default:h((({row:e,$index:a})=>[p(N,{rules:{required:!0,message:"请输入内容"},prop:[a,"content"],"label-width":"0"},{default:h((()=>[p(U,{modelValue:e.content,"onUpdate:modelValue":a=>e.content=a,modelModifiers:{trim:!0},clearable:"",class:"input",placeholder:"请输入内容"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:1}),p(S,{prop:"location",label:"操作",align:"right",width:"60px"},{default:h((({row:e,$index:a})=>[p(_,{type:"danger",link:"",onClick:l=>((e,a)=>{e.id?X.confirm("确定要删除这条常用语吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{t.delete("/api/v1/customer/express",{data:{ids:[e.id]}}).then((e=>{g.value.splice(a,1),L({position:"bottom-right",title:"提示",type:"success",message:"删除成功"})}))})):(g.value.splice(a,1),L({position:"bottom-right",title:"提示",type:"success",message:"删除成功"}))})(e,a)},{default:h((()=>[y(v(e.id?"删除":"移除"),1)])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["model"])),[[A,m.value]])])),_:1},8,["modelValue"])],64)}}},[["__scopeId","data-v-40e11cb0"]]),Jl=e=>(_("data-v-8da650af"),e=e(),w(),e),Yl={style:{display:"inline-block"}},Gl=Jl((()=>u("p",{class:"label"},"客服",-1))),Ql={key:0,class:"null-client"},Wl=[Jl((()=>u("img",{src:pe,alt:""},null,-1))),Jl((()=>u("p",null,"暂无数据",-1)))],Xl=["infinite-scroll-disabled"],Zl={class:"name"},es=ie({__name:"serviceList",setup(a){const{$http:t}=j().appContext.config.globalProperties,m=e(!1),b=C({value:[],search:{},pageIndex:1,dis:!1,get(e=!1){if(m.value)return;m.value=!0;const a={keywords:b.search.keywords||void 0,labelId:b.search.labelId||void 0,page:b.pageIndex,excludeRole:3,limit:20};e&&(a.site_id=sessionStorage.getItem("consultSiteId")),t.get("/api/v1/customer/user/list",{params:a}).then((e=>{b.pageIndex++,e.data.list.length<20&&(b.dis=!0),b.value=b.value.concat(e.data.list)})).finally((()=>{m.value=!1}))}}),k=e(!1),_=e([]);return t.get("/api/v1/customer/labels",{params:{page:1,limit:500}}).then((({data:e})=>{_.value=e.list})),b.get(),(e,a)=>{const t=ce,w=O,I=R,C=M,V=E,L=l,N=B,U=x,z=se;return o(),f(N,{placement:"top",visible:k.value,"onUpdate:visible":a[7]||(a[7]=e=>k.value=e),width:335,trigger:"click",teleported:!1,"hide-after":0},{reference:h((()=>[u("div",Yl,[p(w,ne({size:"small",class:"transmit"},e.$attrs,{onClick:a[0]||(a[0]=e=>{b.search={},b.value=[],b.pageIndex=1,b.get(!0)})}),{default:h((()=>[p(t,{color:"white",size:"14px",name:"zhuanjie"}),y(" 转接 ")])),_:1},16)])])),default:h((()=>[p(V,{modelValue:b.search.keywords,"onUpdate:modelValue":a[3]||(a[3]=e=>b.search.keywords=e),placeholder:"请输入您想搜索的关键字",class:"search","prefix-icon":n(P),style:{width:"auto"},clearable:"",onBlur:a[4]||(a[4]=e=>{b.pageIndex=1,b.get(),b.value=[]}),onKeyup:a[5]||(a[5]=A((e=>{b.pageIndex=1,b.get(),b.value=[]}),["enter"]))},{prepend:h((()=>[p(C,{modelValue:b.search.labelId,"onUpdate:modelValue":a[1]||(a[1]=e=>b.search.labelId=e),placeholder:"全部标签",clearable:"",teleported:!1,style:{width:"115px",background:"white"},onChange:a[2]||(a[2]=e=>{b.pageIndex=1,b.get(),b.value=[]})},{default:h((()=>[(o(!0),i(d,null,r(_.value,(e=>(o(),f(I,{label:e.title,value:e.id},null,8,["label","value"])))),256))])),_:1},8,["modelValue"])])),_:1},8,["modelValue","prefix-icon"]),Gl,0===b.value.length?(o(),i("div",Ql,Wl)):s((o(),i("div",{key:1,class:"list","infinite-scroll-disabled":b.dis},[(o(!0),i(d,null,r(b.value,((e,t)=>{var l,s,r,m;return o(),i(d,null,[e.id!==n(de).state.userInfo.id?(o(),i("div",{key:0,class:c(!0===e.chatStatus?"online":"offline")},[p(L,{size:20,src:e.headImg},null,8,["src"]),u("p",Zl,v(e.nickName||e.userName)+" ",1),(null==(l=n(de).getters.currentClient)?void 0:l.transferSlaveId)&&(null==(s=n(de).getters.currentClient)?void 0:s.transferSlaveId)===e.uuid?(o(),f(w,{key:1,type:"primary",link:"",onClick:a[6]||(a[6]=S((e=>{var a;return n(de).dispatch("cancleTransfer",{receiver_id:null==(a=n(de).getters.currentClient)?void 0:a.transferSlaveId,consult_id:n(de).getters.currentClient.consultId})}),["stop"]))},{default:h((()=>[y(" 取消转接 ")])),_:1})):(o(),f(w,{key:0,type:"primary",link:"",disabled:!0!==e.chatStatus||!!(null==(r=n(de).getters.currentClient)?void 0:r.transferSlaveId)&&(null==(m=n(de).getters.currentClient)?void 0:m.transferSlaveId)!==e.uuid,onClick:S((a=>{n(de).dispatch("transfer",{customer:e}),k.value=!1}),["stop"])},{default:h((()=>[y(" 转给他 ")])),_:2},1032,["disabled","onClick"]))],2)):g("",!0)],64)})),256))],8,Xl)),[[U,m.value],[z,()=>{b.get()}]])])),_:1},8,["visible"])}}},[["__scopeId","data-v-8da650af"]]),as={class:"service-box"},ts={class:"header"},ls={class:"name"},ss=(e=>(_("data-v-c324b6dc"),e=e(),w(),e))((()=>u("span",{class:"line"},"|",-1))),ns={class:"botton"},os={class:"btns"},is=ie({__name:"index",setup(l){const{$http:s}=j().appContext.config.globalProperties,n=e(""),r=e();t((()=>de.state.socket.currentClient),(e=>{r.value=e,e&&(n.value=r.value.inputValue||"",setTimeout((()=>{f(0)}),300))}),{immediate:!0});const m=e();function f(e){const a=de.state.socket.intersectionObserver;Z((()=>{var t,l;null==(l=null==(t=r.value)?void 0:t.mesList)||l.forEach((e=>{if(0===e.read&&1===e.senderRole){const t=document.querySelector(`[data-mes="${e.mid}"]`);t&&a.observe(t)}})),(0===e||m.value.scrollTop+m.value.clientHeight+800>m.value.scrollHeight)&&(m.value.scrollTop=m.value.scrollHeight)}))}function b(){if(!r.value)return void L({position:"bottom-right",title:"提示",type:"error",message:"当前未接入聊天，请点击左侧选择客户"});if(r.value.close)return void L({position:"bottom-right",title:"提示",type:"error",message:"当前对话已关闭"});let e=n.value;de.dispatch("send",{v:e,type:1}),n.value="",r.value.inputValue=""}a((()=>{m.value=document.querySelector("#serviceMessageList"),de.dispatch("initObserver")})),t((()=>{var e;return(null==(e=de.state.socket.currentClient)?void 0:e.mesList.length)||0}),((e,a)=>{f(a)}));const k=function(){4!==r.value.status?X.confirm("确定要结束此对话吗？","确认").then((async()=>{let e=r.value;s.get(`/api/v1/customer/customer/online/close/${e.consultId}`).then((e=>{var a,t;de.state.socket.list.delete(de.state.socket.currentClient.consultId),de.state.socket.currentClient=void 0,null==(t=de.state.socket.autoReplyQueue.get(null==(a=r.value)?void 0:a.consultId))||t.forEach((e=>clearTimeout(e))),L({position:"bottom-right",title:"提示",type:"success",message:"当前对话已关闭"})}))})):L({position:"bottom-right",title:"提示",type:"error",message:"对话处于转接中，无法关闭"})},x={statusbar:!1,menubar:!1,paste_as_text:!0,powerpaste_allow_local_images:!1,paste_data_images:!1,block_unsupported_drop:!1,quickbars_insert_toolbar:!1,language:"zh_CN",convert_urls:!1,language_url:"./tinymce/langs.js",font_size_formats:"12px 14px 16px 18px 24px 36px",paste_preprocess:(e,a)=>{n.value=a.content},toolbar:"undo redo | bold italic underline strikethrough forecolor backcolor | fontsize alignleft aligncenter alignright alignjustify bullist numlist image ",plugins:"image ",file_picker_types:"file image",images_upload_handler:(e,a)=>new Promise(((t,l)=>{const n=e.blob();if(!["jpg","jpeg","png","gif"].some((e=>n.type.includes(e))))return void l("图片类型错误");const o=new FormData;o.append("file",n),s.post("/api/v1/customer/upload/img",o,{}).then((e=>0!==e.code?(l("文件上传失败"),Promise.reject("文件上传失败")):(t(e.data),e))).catch((()=>{l("文件上传失败")})).finally((()=>{a(100)}))}))},_=e=>{let a=new Set;e.on("change",(function(){var a;let t=e.getContent();null==(a=t.match(new RegExp('(?<=(img[^>]*src="))[^"]*',"g")))||a.forEach((e=>{t=t.replace(e,`${e}?t=${(new Date).getTime()}`)}))})),e.on("keyup",(function(e){a.delete(e.key)})),e.on("keydown",(function(e){if(a.add(e.key),a.delete("Unidentified"),!a.has("Shift")&&"Enter"===e.key)return e.stopPropagation(),e.preventDefault(),b(),!1}))};return oe("childEvents",{onlineServicesReset:void 0}),(e,a)=>{var t,l,s,m;const f=ce,w=O;return o(),i("div",as,[p(Pa),u("div",{class:c(["chatting-box",{dis:!r.value}])},[u("div",ts,[u("p",null,[r.value?(o(),i(d,{key:0},[u("span",ls,v(null==(t=r.value)?void 0:t.name),1),ss,u("span",{class:c((null==(l=r.value)?void 0:l.online)?"online":"offline")},v((null==(s=r.value)?void 0:s.online)?"在线":"离线"),3)],64)):g("",!0)]),u("div",null,[p(es,{disabled:!r.value},null,8,["disabled"]),p(w,{size:"small",type:"primary",disabled:!r.value,style:{padding:"5px"},onClick:k},{default:h((()=>[p(f,{color:"white",size:"14px",name:"jieshu"})])),_:1},8,["disabled"])])]),p(va,{class:"messageList",client:r.value,id:"serviceMessageList"},null,8,["client"]),u("div",ns,[p(ve,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),setting:x,setup:_,onChange:a[1]||(a[1]=()=>{r.value&&(r.value.inputValue=n.value)})},null,8,["modelValue"]),u("div",os,[p(ql),p(Dl),p(w,{round:"",type:"primary",disabled:!n.value,onClick:a[2]||(a[2]=e=>b())},{default:h((()=>[y("发送")])),_:1},8,["disabled"])])])],2),p(Al,{"user-id":null==(m=r.value)?void 0:m.userId,currentClient:r.value},null,8,["user-id","currentClient"])])}}},[["__scopeId","data-v-c324b6dc"]]);export{is as default};
