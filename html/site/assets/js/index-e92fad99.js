import{h as L,b as ee,a as le,c as P,d as te,aC as N,v as R,_ as j,i as T,l as q,j as O}from"./entry-8561ffba.js";import{E as oe,m as ae}from"./message-48c984f7.js";import{A as ne,B as ue,n as se,f as ie,h as de,a as Q,_ as W,C as re,D as ce,F as pe,G as he}from"./videoAlbum-3de0ee4f.js";import{P as G}from"./pagination-6c424080.js";/* empty css                       */import{F as z,b as w,Y as $,y as ge,i as J,c as S,T as e,R as u,u as s,o as C,a5 as v,K as M,a as b,ad as U,am as Y,an as H,Q as D,C as X,V as B,h as me}from"./vue-e9f47459.js";const _e=V=>(Y("data-v-316889fa"),V=V(),H(),V),fe=_e(()=>b("i",{style:{"font-size":"14px","margin-right":"6px"},class:"iconfont icon-suijibofang"},null,-1)),ve=z({__name:"editor",emits:["load"],setup(V,{expose:x,emit:c}){const f=w(),o=$({id:0,introduce:"",note:"",popularityDay:void 0,popularityMonth:void 0,popularitySum:void 0,popularityWeek:void 0,recommend:1,surfacePlot:"",title:""}),t=$({loading:!1,visible:!1,other:void 0}),a=ge("debounce")(n=>{!n||n.validate(l=>{l&&(t.loading=!0,(o.id?ne(o):ue(o)).then(()=>{var d;L({position:"bottom-right",type:"success",message:(d=t.other)!=null&&d.id?"\u4E13\u9898\u66F4\u65B0\u6210\u529F":"\u4E13\u9898\u65B0\u589E\u6210\u529F"}),c("load"),i()}).finally(()=>{t.loading=!1}))})},300),i=()=>{t.other=void 0,t.visible=!1},_={title:{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898",trigger:"blur"},surfacePlot:{required:!0,message:"\u8BF7\u8F93\u5165\u5C01\u9762",trigger:"blur"},note:{required:!0,message:"\u8BF7\u8F93\u5165\u5907\u6CE8",trigger:"blur"}};function E(){var n;Object.keys(o).forEach(l=>{var d;o[l]=((d=t.other)==null?void 0:d[l])||o[l]}),o.id=(n=t.other)==null?void 0:n.id}x({open(n){var l;(l=f.value)==null||l.resetFields(),t.visible=!0,t.other=n}});const g=J(()=>{var n;return(n=t.other)!=null&&n.id?"\u7F16\u8F91\u4E13\u9898":"\u65B0\u589E\u4E13\u9898"});return(n,l)=>{const d=U("MyImage"),r=se,m=ee,F=le,A=oe,I=P,h=ie,p=de,k=te,K=N,Z=R;return C(),S("div",null,[e(K,{"model-value":t.visible,"show-close":!t.loading,"close-on-press-escape":!1,title:s(g),width:450,"z-index":20,"close-on-click-modal":!1,onClose:i,onOpened:E},{footer:u(()=>[e(I,{class:"ml-auto",size:"small",loading:t.loading,onClick:i},{default:u(()=>[v(" \u53D6\u6D88 ")]),_:1},8,["loading"]),e(I,{size:"small",loading:t.loading,type:"primary",class:"border-0 bg-orange group-hover:bg-orangeLight",onClick:l[7]||(l[7]=y=>s(a)(f.value))},{default:u(()=>[v(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),default:u(()=>[M((C(),S("div",null,[e(k,{ref_key:"ruleFormRef",ref:f,"label-width":"60px",model:o,rules:_,"hide-required-asterisk":!1,class:"flex-x-between"},{default:u(()=>[b("div",null,[e(m,{label:""},{default:u(()=>[e(r,{class:"avatar-uploader",action:"/api/v1/upload","show-file-list":!1,data:{exts:"jpg,jpeg,png,gif"},"auto-upload":!0,accept:"image/jpg,image/jpeg,image/png,image/gif","on-success":y=>o.surfacePlot=y.path,"on-error":y=>s(L)({position:"bottom-right",type:"error",message:JSON.parse(y.message).message})},{default:u(()=>[e(d,{placement:"bottom",trigger:"hover",src:o.surfacePlot,style:{width:"60px",height:"60px"}},null,8,["src"])]),_:1},8,["on-success","on-error"])]),_:1}),e(m,{label:"\u5C01\u9762",prop:"surfacePlot"},{default:u(()=>[e(F,{spellcheck:"false",modelValue:o.surfacePlot,"onUpdate:modelValue":l[0]||(l[0]=y=>o.surfacePlot=y),modelModifiers:{trim:!0},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5C01\u9762"},null,8,["modelValue"])]),_:1}),e(m,{label:"\u6807\u9898",prop:"title"},{default:u(()=>[e(F,{spellcheck:"false",modelValue:o.title,"onUpdate:modelValue":l[1]||(l[1]=y=>o.title=y),modelModifiers:{trim:!0},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"},null,8,["modelValue"])]),_:1}),e(m,{label:"\u7B80\u4ECB",prop:"introduce"},{default:u(()=>[e(F,{spellcheck:"false",modelValue:o.introduce,"onUpdate:modelValue":l[2]||(l[2]=y=>o.introduce=y),rows:8,type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u7B80\u4ECB"},null,8,["modelValue"])]),_:1}),e(m,{label:"\u4EBA\u6C14",prop:"popularitySum"},{default:u(()=>[e(A,{spellcheck:"false",modelValue:o.popularitySum,"onUpdate:modelValue":l[3]||(l[3]=y=>o.popularitySum=y),modelModifiers:{number:!0},clearable:"",precision:0,"step-strictly":"",min:0,"controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u4EBA\u6C14",onBlur:l[4]||(l[4]=y=>o.popularitySum||(o.popularitySum=0))},null,8,["modelValue"]),e(I,{style:{margin:"0 8px","line-height":"14px"},type:"primary",link:"",onClick:l[5]||(l[5]=y=>o.popularitySum=Math.ceil(Math.random()*10*100*(Math.random()*10)))},{default:u(()=>[fe,v(" \u968F\u673A\u4EBA\u6C14 ")]),_:1})]),_:1}),e(m,{label:"\u63A8\u8350",prop:"recommend"},{default:u(()=>[e(p,{modelValue:o.recommend,"onUpdate:modelValue":l[6]||(l[6]=y=>o.recommend=y)},{default:u(()=>[e(h,{label:1},{default:u(()=>[v(" \u662F ")]),_:1}),e(h,{label:2},{default:u(()=>[v(" \u5426 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1},8,["model"])])),[[Z,t.loading]])]),_:1},8,["model-value","show-close","title"])])}}});const ye=j(ve,[["__scopeId","data-v-316889fa"]]),be=V=>(Y("data-v-6a17a157"),V=V(),H(),V),Ce={class:"flex-y",style:{height:"100%"}},xe={class:"flex-x-between"},Fe={class:"flex-x-center search"},Ve=be(()=>b("span",{style:{flexShrink:0}},"\u5206\u7C7B",-1)),ke=["onClick"],Ee={key:1},Be={class:"flex-x-end dia-footer"},we=z({__name:"addVideo",emits:["close"],setup(V,{expose:x,emit:c}){const f=w({pageIndex:1,pageSize:20,total:0}),o=w([]),t=$({loading:!1,data:[],selectList:[],searchVal:{categoryId:void 0,keywords:"",order:""},load(g){var n;f.value=g||f.value,t.loading=!0,Q({page:f.value.pageIndex,limit:f.value.pageSize,skipAlbumId:(n=a.other)==null?void 0:n.id,categoryId:o.value?o.value[o.value.length-1]:0,order:t.searchVal.order,keywords:t.searchVal.keywords}).then(l=>{t.data=l.list,f.value.total=l.total}).finally(()=>{t.loading=!1})},sortChnage({column:g,prop:n,order:l}){l?t.searchVal.order=`${n} ${l==="ascending"?"asc":"desc"}`:t.searchVal.order="",t.load()},handleSelectionChange(g){t.selectList=g}}),a=$({visible:!1,other:void 0}),i=()=>{a.visible=!1,f.value.pageIndex=1,o.value=[],t.searchVal={},c("close")},_={search(){f.value.pageIndex=1,t.load()},add(g){var n,l;(n=a.other)!=null&&n.id&&re((l=a.other)==null?void 0:l.id,g.map(d=>d.id)).then(()=>{L({position:"bottom-right",type:"success",message:"\u6DFB\u52A0\u6210\u529F"}),t.load()})}};x({open(g){a.other=g,a.visible=!0,f.value.pageIndex=1,t.load()}});const E=J(()=>{var g,n,l;return(((g=a.other)==null?void 0:g.title.length)>20?((n=a.other)==null?void 0:n.title.substring(0,15))+"...":(l=a.other)==null?void 0:l.title)+"\u7684\u89C6\u9891\u5217\u8868"});return(g,n)=>{const l=P,d=T,r=q,m=U("MyImage"),F=O,A=N,I=R;return C(),D(A,{"model-value":s(a).visible,"show-close":!0,"close-on-press-escape":!1,"before-close":i,title:s(E),width:1100,"z-index":20,top:"20vh",style:{height:"65vh"},"close-on-click-modal":!1,onClose:i},{default:u(()=>[M((C(),S("div",Ce,[b("header",xe,[e(l,{disabled:s(t).selectList.length<1,onClick:n[0]||(n[0]=h=>{_.add(s(t).selectList),s(t).selectList=[]})},{default:u(()=>[v(" \u6279\u91CF\u6DFB\u52A0 ")]),_:1},8,["disabled"]),b("div",Fe,[Ve,e(W,{modelValue:s(o),"onUpdate:modelValue":n[1]||(n[1]=h=>X(o)?o.value=h:null),type:"videoType",checkStrictly:!0,placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B",onChange:_.search},null,8,["modelValue","onChange"]),e(d,{modelValue:s(t).searchVal.keywords,"onUpdate:modelValue":n[2]||(n[2]=h=>s(t).searchVal.keywords=h),onBlur:_.search},null,8,["modelValue","onBlur"])])]),M((C(),D(F,{data:s(t).data,class:"auto",stripe:!1,border:!0,onSelectionChange:s(t).handleSelectionChange,onSortChange:s(t).sortChnage},{default:u(()=>[e(r,{type:"selection",width:"35"}),e(r,{prop:"id",label:"ID",width:"80"},{default:u(({row:h,store:p})=>[b("div",{onClick:k=>p.toggleRowSelection(h,void 0)},B(h.id),9,ke)]),_:1}),e(r,{label:"\u7F29\u7565\u56FE",width:"90"},{default:u(({row:h})=>[h.surfacePlot?(C(),D(m,{key:0,src:h.surfacePlot,style:{width:"50px",height:"30px"}},null,8,["src"])):(C(),S("span",Ee,"-"))]),_:1}),e(r,{prop:"title",label:"\u540D\u79F0","min-width":"150"}),e(r,{label:"\u5206\u7C7B",width:"150"},{default:u(({row:h})=>[v(B(h.categoryName)+"/"+B(h.childCategoryName),1)]),_:1}),e(r,{prop:"popularitySum",label:"\u4EBA\u6C14","min-width":"80"}),e(r,{label:"\u6536\u8D39","min-width":"100"},{default:u(({row:h})=>[v(B(h.buyMode===1?h.chargingMode===1?"\u6309\u90E8-\u514D\u8D39":h.chargingMode===2?"\u6309\u90E8-VIP\u514D\u8D39":h.chargingMode===3?"\u6309\u90E8-\u91D1\u5E01\u70B9\u64AD":"-":h.buyMode===2?"\u6309\u96C6":"-"),1)]),_:1}),e(r,{prop:"releaseAt",label:"\u4E0A\u6620\u65E5\u671F",type:"day",width:"150",sortable:""}),e(r,{prop:"shelfAt",label:"\u66F4\u65B0\u65F6\u95F4",width:"150",type:"date"}),e(r,{fixed:"right",label:"\u64CD\u4F5C",align:"right","min-width":"55"},{default:u(({row:h})=>[e(l,{type:"primary",link:"",onClick:p=>_.add([h])},{default:u(()=>[v(" \u6DFB\u52A0 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange","onSortChange"])),[[I,s(t).loading]]),b("div",Be,[e(G,{pageinfo:s(f),class:"ml-auto",onChange:s(t).load},null,8,["pageinfo","onChange"])])])),[[I,s(t).loading]])]),_:1},8,["model-value","title"])}}});const Ie=j(we,[["__scopeId","data-v-6a17a157"]]),Se={class:"flex-y",style:{height:"70vh"}},De={class:"flex-x-between search"},$e={class:"flex-x-center search",style:{margin:"0"}},Ae=b("span",{style:{flexShrink:0}},"\u5206\u7C7B",-1),Me=["onClick"],Le={key:1},Pe={class:"flex-x-end dia-footer"},Re=z({__name:"videoList",emits:["load"],setup(V,{expose:x,emit:c}){const f=w(),o=w({pageIndex:1,pageSize:20,total:0}),t=w([]),a=$({loading:!1,data:[],searchVal:{categoryId:void 0,keywords:"",order:""},selectList:[],handleSelectionChange(n){a.selectList=n},sortChnage({column:n,prop:l,order:d}){d?a.searchVal.order=`${l} ${d==="ascending"?"asc":"desc"}`:a.searchVal.order="",a.load()},load(n){var l;o.value=n||o.value,a.loading=!0,Q({page:o.value.pageIndex,limit:o.value.pageSize,albumsId:(l=i.other)==null?void 0:l.id,categoryId:t.value?t.value[t.value.length-1]:0,order:a.searchVal.order,keywords:a.searchVal.keywords}).then(d=>{a.data=d.list,o.value.total=d.total}).finally(()=>{a.loading=!1})}}),i=$({visible:!1,other:void 0}),_={search(){o.value.pageIndex=1,a.load()},del(n){var l,d;(l=i.other)!=null&&l.id&&(a.loading=!0,ce((d=i.other)==null?void 0:d.id,n).then(r=>{a.load(),L({position:"bottom-right",type:"success",message:"\u89E3\u7ED1\u6210\u529F"})}).catch(()=>{a.loading=!1}))},addClose(){o.value.pageIndex=1,a.load()}},E=()=>{i.visible=!1,o.value.pageIndex=1,t.value=[],a.searchVal={},c("load")};x({open(n){i.other=n,i.visible=!0,o.value.pageIndex=1,a.load()}});const g=J(()=>{var n,l,d;return(((n=i.other)==null?void 0:n.title.length)>20?((l=i.other)==null?void 0:l.title.substring(0,15))+"...":(d=i.other)==null?void 0:d.title)+"\u7684\u89C6\u9891\u5217\u8868"});return(n,l)=>{const d=P,r=T,m=q,F=U("MyImage"),A=O,I=N,h=R;return C(),D(I,{"model-value":s(i).visible,"show-close":!0,"close-on-press-escape":!1,title:s(g),width:1200,"z-index":20,"close-on-click-modal":!1,onClose:E},{default:u(()=>[M((C(),S("div",Se,[b("header",De,[b("div",null,[e(d,{type:"primary",onClick:l[0]||(l[0]=p=>{var k;return(k=s(f))==null?void 0:k.open(s(i).other)})},{default:u(()=>[v(" \u7ED1\u5B9A\u5F71\u7247 ")]),_:1}),e(d,{disabled:s(a).selectList.length<1,onClick:l[1]||(l[1]=p=>_.del(s(a).selectList.map(k=>k.id)))},{default:u(()=>[v(" \u6279\u91CF\u89E3\u7ED1 ")]),_:1},8,["disabled"])]),b("div",$e,[Ae,e(W,{modelValue:s(t),"onUpdate:modelValue":l[2]||(l[2]=p=>X(t)?t.value=p:null),type:"videoType",checkStrictly:!0,placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B",onChange:_.search},null,8,["modelValue","onChange"]),e(r,{modelValue:s(a).searchVal.keywords,"onUpdate:modelValue":l[3]||(l[3]=p=>s(a).searchVal.keywords=p),onBlur:_.search},null,8,["modelValue","onBlur"])])]),e(A,{data:s(a).data,class:"auto",stripe:!1,border:!0,onSelectionChange:s(a).handleSelectionChange,onSortChange:s(a).sortChnage},{default:u(()=>[e(m,{type:"selection",width:"55"}),e(m,{prop:"id",label:"ID",width:"100"},{default:u(({row:p,store:k})=>[b("div",{onClick:K=>k.toggleRowSelection(p,void 0)},B(p.id),9,Me)]),_:1}),e(m,{label:"\u7F29\u7565\u56FE","min-width":"100"},{default:u(({row:p})=>[p.surfacePlot?(C(),D(F,{key:0,src:p.surfacePlot,style:{width:"50px",height:"30px"}},null,8,["src"])):(C(),S("span",Le,"-"))]),_:1}),e(m,{prop:"title",label:"\u540D\u79F0","min-width":"150"}),e(m,{label:"\u5206\u7C7B","min-width":"150"},{default:u(({row:p})=>[v(B(p.categoryName)+"/"+B(p.childCategoryName),1)]),_:1}),e(m,{prop:"popularitySum",label:"\u4EBA\u6C14","min-width":"80"}),e(m,{label:"\u6536\u8D39","min-width":"100"},{default:u(({row:p})=>[v(B(p.buyMode===1?p.chargingMode===1?"\u6309\u90E8-\u514D\u8D39":p.chargingMode===2?"\u6309\u90E8-VIP\u514D\u8D39":p.chargingMode===3?"\u6309\u90E8-\u91D1\u5E01\u70B9\u64AD":"-":p.buyMode===2?"\u6309\u96C6":"-"),1)]),_:1}),e(m,{prop:"releaseAt",label:"\u4E0A\u6620\u65E5\u671F",type:"day",width:"150",sortable:""}),e(m,{prop:"shelfAt",label:"\u66F4\u65B0\u65F6\u95F4",width:"150",type:"date"}),e(m,{fixed:"right",label:"\u64CD\u4F5C",align:"right","min-width":"60"},{default:u(({row:p})=>[e(d,{type:"danger",link:"",onClick:k=>_.del([p.id])},{default:u(()=>[v(" \u89E3\u7ED1 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange","onSortChange"]),b("div",Pe,[e(G,{pageinfo:s(o),class:"ml-auto",onChange:s(a).load},null,8,["pageinfo","onChange"])])])),[[h,s(a).loading]]),e(Ie,{ref_key:"addVideoRef",ref:f,onClose:_.addClose},null,8,["onClose"])]),_:1},8,["model-value","title"])}}}),ze={class:"flex-y box"},Ue={class:"flex-x-between"},Ne={class:"earch"},je={key:1},Te=z({__name:"index",setup(V){const x=w({pageIndex:1,pageSize:20,total:0}),c=$({loading:!1,data:[],searchVal:{keywords:"",order:""},selectList:[],load(a){x.value=a||x.value,c.loading=!0,pe({page:x.value.pageIndex,limit:x.value.pageSize,...c.searchVal}).then(i=>{c.data=i.list,c.data=c.data.sort((_,E)=>_.videoCount-E.videoCount>0?-1:0),x.value.total=i.total}).finally(()=>{c.loading=!1})},handleSelectionChange(a){this.selectList=a},sortChnage({column:a,prop:i,order:_}){_?c.searchVal.order=`${i} ${_==="ascending"?"asc":"desc"}`:c.searchVal.order="",c.load()}}),f=w(),o=w(),t={del:a=>ae({message:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",okEms:"\u4E13\u9898\u5220\u9664\u6210\u529F"},()=>he(a.id).then(i=>(c.load(),i)))};return me(()=>{c.load()}),(a,i)=>{const _=P,E=T,g=q,n=U("MyImage"),l=O,d=R;return C(),S("div",ze,[b("div",Ue,[b("div",null,[e(_,{type:"primary",onClick:i[0]||(i[0]=r=>{var m;return(m=f.value)==null?void 0:m.open({})})},{default:u(()=>[v(" \u65B0\u589E\u4E13\u9898 ")]),_:1})]),b("div",Ne,[e(E,{modelValue:c.searchVal.keywords,"onUpdate:modelValue":i[1]||(i[1]=r=>c.searchVal.keywords=r),onChange:i[2]||(i[2]=r=>{x.value.pageIndex=1,c.load()})},null,8,["modelValue"])])]),M((C(),D(l,{class:"auto",data:c.data,stripe:!0,onSortChange:c.sortChnage,onSelectionChange:c.handleSelectionChange},{default:u(()=>[e(g,{prop:"id",label:"ID",width:"50"}),e(g,{label:"\u7F29\u7565\u56FE","min-width":"150"},{default:u(({row:r})=>[r.surfacePlot?(C(),D(n,{key:0,src:r.surfacePlot,style:{width:"50px",height:"30px"}},null,8,["src"])):(C(),S("span",je,"-"))]),_:1}),e(g,{prop:"title",label:"\u540D\u79F0","min-width":"150","show-overflow-tooltip":!0}),e(g,{label:"\u89C6\u9891\u6570\u91CF","min-width":"150",prop:"videoCount"}),e(g,{prop:"popularitySum",label:"\u4EBA\u6C14","min-width":"150"}),e(g,{label:"\u63A8\u8350","min-width":"150"},{default:u(({row:r})=>[v(B(r.recommend===1?"\u662F":"\u5426"),1)]),_:1}),e(g,{prop:"updateAt",label:"\u66F4\u65B0\u65F6\u95F4",width:"150",type:"date",sortable:""}),e(g,{fixed:"right",label:"\u64CD\u4F5C",align:"right","min-width":"170"},{default:u(({row:r})=>[e(_,{type:"primary",link:"",onClick:m=>{var F;return(F=o.value)==null?void 0:F.open(r)}},{default:u(()=>[v(" \u89C6\u9891\u7BA1\u7406 ")]),_:2},1032,["onClick"]),e(_,{type:"primary",link:"",onClick:m=>{var F;return(F=f.value)==null?void 0:F.open(r)}},{default:u(()=>[v(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),e(_,{type:"danger",link:"",onClick:m=>t.del(r)},{default:u(()=>[v(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSortChange","onSelectionChange"])),[[d,c.loading]]),e(G,{pageinfo:x.value,onChange:c.load},null,8,["pageinfo","onChange"]),e(ye,{ref_key:"editorRef",ref:f,onLoad:c.load},null,8,["onLoad"]),e(Re,{ref_key:"videoListRef",ref:o,onLoad:c.load},null,8,["onLoad"])])}}});const We=j(Te,[["__scopeId","data-v-f6ba95cc"]]);export{We as default};
