import{E as U,b as ee,c as ie,F as de,G as re,g as ce,i as pe,j as te,k as _e,v as ae,_ as oe,C as ge,s as me,o as fe,c5 as he,q as ye,m as ve}from"./entry-9cc5c370.js";/* empty css                   *//* empty css                        */import{G as W,a as V,d as le,l as p,R as I,S as n,p as d,W as b,u as B,Z as L,z as se,m as E,U as o,as as Q,at as ue,a6 as g,L as ne,O as k,e as be,ag as Ce,P as q,af as Z,X as K,ap as Ee,aq as Fe,Q as Be,V as R,ac as H}from"./vue-11eabec3.js";import{b as Y,r as xe,a as ke,u as De}from"./repositoryDatail-9562783b.js";import{g as Ve}from"./repository-d7a349f9.js";import{P as Ie}from"./pagination-db6078c7.js";import{E as we}from"./el-cascader-panel-27ac6c37.js";import{g as P,a as J}from"./videoType-587f3494.js";/* empty css                                                 */import{E as Ae}from"./index-bf5a11eb.js";/* empty css                      */import"./index-971e6ee4.js";/* empty css                                                                   */import"./arrays-2e03ed1f.js";const Me=["onClick"],Se=W({__name:"cascader",props:{checkStrictly:{type:Boolean,default:!1},modelValue:{type:Array,require:!0,default:()=>[]},type:{type:String,required:!0},page:{type:String,default:void 0},siteId:{type:Number,default:0}},emits:["update:modelValue"],setup(w,{emit:$}){const x=w,M={videoType:()=>x.siteId?P("1",x.siteId):J("1"),starType:()=>x.siteId?P("2",x.siteId):J("2"),article:()=>x.siteId?P("3",x.siteId):J("3")},F=V();function D(h){F.value.handleSuggestionClick(h),$("update:modelValue",h.pathValues),F.value.togglePopperVisible(!1),$("change",h.pathValues)}const S=V([]);return le(()=>{M[x.type]().then(h=>{h.forEach(t=>{t.parentId===0&&S.value.push({value:t.id,label:t.name})}),h.forEach(t=>{if(t.parentId!==0){const l=S.value.find(e=>e.value===t.parentId);l&&(l.children||(l.children=[]),l.children.push({value:t.id,label:t.name,leaf:!0}))}})})}),(h,t)=>{const l=we;return p(),I(l,{"model-value":w.modelValue,options:B(S),clearable:"","popper-class":"my-cascader",props:{expandTrigger:"hover",checkStrictly:!0},ref_key:"cascader",ref:F,placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B","onUpdate:modelValue":t[0]||(t[0]=e=>$("update:modelValue",e))},{default:n(e=>[d("div",{onClick:A=>D(e.node)},b(e.data.label),9,Me)]),_:1},8,["model-value","options"])}}}),$e=W({__name:"bind",props:{resource:{type:Object,default:()=>({})}},emits:["load"],setup(w,{expose:$,emit:x}){const M=w,F=Q(),D=ue(),S=V(""),h=V(),t=L({category_child_id:void 0,category_id:void 0,class_id:0,class_name:"",buyMode:1,id:0,chargingMode:1,resource_id:0,gold:0,siteId:0}),l=L({loading:!1,visible:!1,other:void 0}),e=se("debounce")(c=>{!c||c.validate(s=>{s&&(l.loading=!0,m.status?m.mateCate.length?m.mateCate.forEach(async(f,y)=>{const i={buyMode:t.buyMode,category_child_id:f.category_child_id,category_id:f.category_id,class_id:f.class_id,class_name:f.class_name,chargingMode:t.chargingMode,gold:t.gold,id:t.id,resource_id:t.resource_id,siteId:t.siteId};await Y(i).then(()=>{y===m.mateCate.length-1&&(U({position:"bottom-right",type:"success",message:"\u5206\u7C7B\u7ED1\u5B9A\u6210\u529F"}),x("load"),A())}).finally(()=>{y===m.mateCate.length-1&&(l.loading=!1)})}):(l.loading=!1,U({position:"bottom-right",type:"warning",message:"\u6CA1\u6709\u53EF\u5339\u914D\u7684\u5206\u7C7B"})):Y(t).then(()=>{U({position:"bottom-right",type:"success",message:"\u5206\u7C7B\u7ED1\u5B9A\u6210\u529F"}),x("load"),A()}).finally(()=>{l.loading=!1}))})},300),A=()=>{l.other=void 0,l.visible=!1,t.category_id=void 0,t.category_child_id=void 0},z={buyMode:{required:!0,validator:(c,s,f)=>{s!==1&&s!==2&&f(new Error("\u8BF7\u9009\u62E9\u8BA1\u8D39\u6A21\u5F0F")),f()},trigger:"blur"},category_id:{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7C7B",trigger:"blur"},gold:{required:!0,message:"\u8BF7\u8F93\u5165\u91D1\u5E01\u6570\u91CF",trigger:"blur"}},m=L({status:!0,mateCate:[]});function r(){var c,s;t.class_id=((c=l.other)==null?void 0:c.id)||0,t.class_name=((s=l.other)==null?void 0:s.name)||"",t.resource_id=M.resource.id,console.log(F.query,"====")}$({open(c,s,f=!1,y=[]){var C;console.log(c),m.status=f,m.mateCate=y,f&&(a.value="\u4E00\u952E\u7ED1\u5B9A\u5206\u7C7B"),t.siteId=s,(C=h.value)==null||C.resetFields(),l.visible=!0,l.other=c;const i=F.query.t==="1"?"videoType":F.query.t==="2"?"starType":F.query.t==="3"?"article":"";i===""&&D.push("/collect/repository"),S.value=i}});const a=V("\u7ED1\u5B9A\u5206\u7C7B");return(c,s)=>{const f=ee,y=ie,i=Se,C=de,T=re,G=ce,j=pe,u=te,_=_e,N=ae;return p(),E("div",null,[o(_,{"model-value":l.visible,"show-close":!l.loading,"close-on-press-escape":!1,title:a.value,width:450,"z-index":20,"close-on-click-modal":!1,"destroy-on-close":!0,onClose:A,onOpened:r,class:"not_pb"},{footer:n(()=>[o(u,{class:"ml-auto",size:"small",loading:l.loading,onClick:A},{default:n(()=>[g(" \u53D6\u6D88 ")]),_:1},8,["loading"]),o(u,{size:"small",loading:l.loading,type:"primary",class:"border-0 bg-orange group-hover:bg-orangeLight",onClick:s[6]||(s[6]=v=>B(e)(h.value))},{default:n(()=>[g(b(m.status?"\u4E00\u952E\u7ED1\u5B9A":"\u4FDD\u5B58"),1)]),_:1},8,["loading"])]),default:n(()=>[ne((p(),E("div",null,[o(j,{ref_key:"ruleFormRef",ref:h,"label-width":"70px",model:t,rules:z,"hide-required-asterisk":!1},{default:n(()=>[m.status?k("",!0):(p(),I(y,{key:0,label:"\u91C7\u96C6\u5206\u7C7B",prop:"class_name"},{default:n(()=>[o(f,{spellcheck:"false",modelValue:t.class_name,"onUpdate:modelValue":s[0]||(s[0]=v=>t.class_name=v),modelModifiers:{trim:!0},disabled:!0,clearable:"",class:"input",placeholder:"\u8BF7\u8F93\u5165\u5206\u7C7B\u540D\u79F0"},null,8,["modelValue"])]),_:1})),m.status?k("",!0):(p(),I(y,{key:1,label:"\u7ED1\u5B9A\u5206\u7C7B",prop:"category_id"},{default:n(()=>[o(i,{"model-value":t.category_child_id?[t.category_id,t.category_child_id]:[t.category_id],type:S.value,siteId:t.siteId,placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B",onChange:s[1]||(s[1]=v=>{t.category_id=v?v[0]:void 0,t.category_child_id=v?v[1]:0})},null,8,["model-value","type","siteId"])]),_:1})),B(F).query.t==="1"?(p(),I(y,{key:2,label:"\u6536\u8D39\u89C4\u5219",prop:"chargingMode",onChange:s[3]||(s[3]=()=>{t.chargingMode===3&&(t.gold=0)})},{default:n(()=>[o(T,{modelValue:t.chargingMode,"onUpdate:modelValue":s[2]||(s[2]=v=>t.chargingMode=v),size:"small"},{default:n(()=>[o(C,{label:1},{default:n(()=>[g(" \u514D\u8D39 ")]),_:1}),o(C,{label:2},{default:n(()=>[g(" VIP\u64AD\u653E ")]),_:1}),o(C,{label:3},{default:n(()=>[g(" \u91D1\u5E01\u70B9\u64AD ")]),_:1})]),_:1},8,["modelValue"])]),_:1})):k("",!0),t.chargingMode===3?(p(),I(y,{key:3,label:"\u6240\u9700\u91D1\u5E01",prop:"gold"},{default:n(()=>[o(G,{spellcheck:"false",modelValue:t.gold,"onUpdate:modelValue":s[4]||(s[4]=v=>t.gold=v),modelModifiers:{number:!0},clearable:"",precision:0,"step-strictly":"",min:1,"value-on-clear":1,"controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u91D1\u5E01\u6570\u91CF"},null,8,["modelValue"])]),_:1})):k("",!0),B(F).query.t==="1"?(p(),I(y,{key:4,label:"\u8BA1\u8D39\u65B9\u5F0F",prop:"buyMode"},{default:n(()=>[o(T,{modelValue:t.buyMode,"onUpdate:modelValue":s[5]||(s[5]=v=>t.buyMode=v),size:"small"},{default:n(()=>[o(C,{label:1},{default:n(()=>[g(" \u6309\u90E8 ")]),_:1}),o(C,{label:2},{default:n(()=>[g(" \u6309\u96C6 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})):k("",!0)]),_:1},8,["model"])])),[[N,l.loading]])]),_:1},8,["model-value","show-close","title"])])}}});const qe=oe($e,[["__scopeId","data-v-97f523b1"]]),O=w=>(Ee("data-v-a4881fbf"),w=w(),Fe(),w),ze={class:"flex-x box",style:{height:"100%"}},Le={class:"flex-y",style:{flex:"1 1 0",gap:"16px",height:"100%",overflow:"hidden"}},Te={class:"head-b"},Ne={class:"flex header"},Re=O(()=>d("i",{class:"iconfont icon-fanhui"},null,-1)),Ue=O(()=>d("span",{class:"line"},null,-1)),Pe={style:{"flex-shrink":"0"}},Oe={class:"flex-x-between btn"},Ge={class:"flex-x",style:{"align-items":"center"}},je=O(()=>d("div",{style:{width:"2px",height:"80%",background:"#ebe9e9",margin:"0 24px"}},null,-1)),Ke={class:"search",style:{margin:"0"}},Je={key:1},Qe={class:"flex-y"},We={class:"site_type_top"},Xe={style:{margin:"16px"}},Ze={style:{"font-weight":"400","font-size":"14px"}},He={style:{display:"flex","justify-content":"space-between","flex-wrap":"wrap",padding:"0 10px"}},Ye={style:{width:"50%"}},et=["onClick"],tt=["onClick"],at=O(()=>d("span",null,[g(" ["),d("span",{class:"binded"},"\u672A\u7ED1\u5B9A"),g("]")],-1)),ot=["onClick"],lt=["onClick"],st={style:{padding:"8px"}},ut={style:{"font-size":"12px","margin-bottom":"12px"}},nt={key:0,style:{"font-size":"12px","margin-bottom":"12px"}},it={style:{"font-size":"12px"}},dt={key:0,style:{display:"none"}},rt=W({__name:"index",setup(w){const $=V([]);Ve().then(r=>{$.value=r.list});const x=V(!0),M=decodeURIComponent(Q().query.center||""),F=be(()=>{var r;return M?decodeURIComponent(((r=JSON.parse(M))==null?void 0:r.name)||""):""}),D=Q(),S=ue(),h=D.query.t,t=L({currCate:[],siteCate:[]});h||S.push({name:"collectRepository"});const l=V({pageIndex:1,pageSize:20,total:0}),e=L({loading:!1,data:[],searchVal:{wd:"",t:0,order:""},selectList:[],categories:[],resource:{},list:[],load(r){l.value=r||l.value,e.loading=!0,ke({rid:Number(D.query.i)||0,page:l.value.pageIndex,limit:l.value.pageSize,...e.searchVal}).then(a=>{switch(h){case"1":e.data=a.vod_data.list,e.list=a.cateList,e.resource=a.resource,l.value.total=a.vod_data.total;break;case"2":e.data=a.celebrity_data.data,e.list=a.cateList,e.resource=a.resource,l.value.total=a.celebrity_data.total;break;case"3":e.data=a.article_data.list,e.list=a.cateList,e.resource=a.resource,l.value.total=a.article_data.recordcount;break}}).finally(()=>{e.loading=!1})},handleSelectionChange(r){e.selectList=r},sortChnage({column:r,prop:a,order:c}){c?e.searchVal.order=`${a} ${c==="ascending"?"asc":"desc"}`:e.searchVal.order="",e.load()}}),A=V(),z=V(!1),m={changeType(r){e.searchVal.t=r,l.value.pageIndex=1,e.load()},collect:se("debounce")(r=>{z.value||(z.value=!0,xe({...r,siteIds:D.query.sid,rid:Number(D.query.i)||0,t:e.searchVal.t,log_id:e.resource.log_id,srid:M?Number(D.query.tid):void 0},h,M||void 0).then(()=>{U({position:"bottom-right",type:"success",message:"\u6570\u636E\u91C7\u96C6\u63D0\u4EA4\u6210\u529F"})}).finally(()=>{setTimeout(()=>{z.value=!1},100)}))},300),unBind:r=>ge({message:"\u786E\u5B9A\u8981\u89E3\u9664\u7ED1\u5B9A\u5417\uFF1F",okEms:"\u7C7B\u578B\u89E3\u7ED1\u6210\u529F"},()=>De(r).then(a=>(e.load(),a))),autoBind:(r,a)=>{P("1",r).then(c=>{var y;t.siteCate=m.caseLev(c);const s=[];a.forEach(i=>{s.push({class_id:i.id,class_name:i.name})}),t.currCate=s;const f=[];t.siteCate.forEach(i=>{t.currCate.forEach(C=>{(i.name==C.class_name||i.name.split("/")[1]==C.class_name)&&f.push({category_id:i.category_id,category_child_id:i.category_child_id,class_id:C.class_id,class_name:C.class_name})})}),(y=A.value)==null||y.open({},r,!0,f)})},caseLev:r=>{let a=[],c=[];return r.forEach(s=>{s.parentId===0&&a.push({value:s.id,label:s.name})}),r.forEach(s=>{const f=a.find(y=>y.value===s.parentId);f&&c.push({category_id:f.value,category_child_id:s.id,name:f.label+"/"+s.name})}),c}};return le(()=>{e.load()}),(r,a)=>{const c=te,s=H("Search"),f=me,y=ee,i=ve,C=H("MyImage"),T=fe,G=Ae,j=ae;return p(),E("div",ze,[d("div",Le,[d("div",Te,[d("div",Ne,[d("span",{class:"point",style:{"flex-shrink":"0"},onClick:a[0]||(a[0]=u=>r.$router.go(-1))},[Re,g("\u8FD4\u56DE")]),Ue,d("span",Pe,b(e.resource.name||B(F)),1)])]),d("div",Oe,[d("div",Ge,[o(c,{disabled:e.selectList.length<1,onClick:a[1]||(a[1]=u=>m.collect({ids:e.selectList.map(_=>_.vod_id||_.id||_.pic_id)}))},{default:n(()=>[g(" \u91C7\u96C6\u9009\u4E2D ")]),_:1},8,["disabled"]),o(c,{onClick:a[2]||(a[2]=u=>m.collect({op:"day"}))},{default:n(()=>[g(" \u91C7\u96C6\u5F53\u5929 ")]),_:1}),o(c,{onClick:a[3]||(a[3]=u=>m.collect({op:"week"}))},{default:n(()=>[g(" \u91C7\u96C6\u672C\u5468 ")]),_:1}),o(c,{onClick:a[4]||(a[4]=u=>m.collect({op:"all"}))},{default:n(()=>[g(b(e.searchVal.t==0?"\u91C7\u96C6\u6240\u6709":"\u91C7\u96C6\u672C\u7C7B"),1)]),_:1}),je,o(c,{type:"primary",onClick:a[5]||(a[5]=u=>m.collect({op:"all",page:l.value.pageIndex,pg:l.value.pageIndex,limit:l.value.pageSize,ps:l.value.pageSize}))},{default:n(()=>[g(" \u4ECE\u672C\u9875\u5F00\u91C7 ")]),_:1})]),d("div",Ke,[o(y,{spellcheck:"false",placeholder:"\u641C\u7D22\u5173\u952E\u5B57",clearable:"",style:{width:"160px"},modelValue:e.searchVal.wd,"onUpdate:modelValue":a[7]||(a[7]=u=>e.searchVal.wd=u),onKeyup:a[8]||(a[8]=Ce(u=>e.load(),["enter"])),onClear:a[9]||(a[9]=u=>e.load())},{suffix:n(()=>[o(f,{onClick:a[6]||(a[6]=u=>e.load())},{default:n(()=>[o(s)]),_:1})]),_:1},8,["modelValue"])])]),ne((p(),I(T,{data:e.data,class:"auto",style:{height:"100%"},stripe:!0,onSortChange:e.sortChnage,onSelectionChange:e.handleSelectionChange},{default:n(()=>[B(h)==="1"?(p(),E(q,{key:0},[o(i,{type:"selection",width:"55"}),o(i,{prop:"vod_name",label:"\u5F71\u7247\u540D\u79F0","min-width":"100"},{default:n(({row:u})=>[g(b(u.vod_name)+" ",1),u.vod_note?(p(),E("span",{key:0,class:"note",style:K({color:u.vod_note.includes("\u5DF2\u5B8C\u7ED3")?"#E6A23C":"#4b82fa"})},b(u.vod_note),5)):k("",!0)]),_:1}),o(i,{prop:"vod_type_name",label:"\u5206\u7C7B",width:"180"}),o(i,{prop:"vod_dt",label:"\u6765\u6E90",width:"130"}),o(i,{prop:"vod_release_time",label:"\u66F4\u65B0\u65F6\u95F4",type:"date",width:"170"},{default:n(({row:u})=>[d("span",{class:Be(B(he)(u.vod_release_time)?"red_color":"")},b(B(ye)(u.vod_release_time)),3)]),_:1})],64)):k("",!0),B(h)==="2"?(p(),E(q,{key:1},[o(i,{type:"selection",width:"55"}),o(i,{label:"\u5934\u50CF","min-width":"100"},{default:n(({row:u})=>[u.head_img?(p(),I(C,{key:0,src:u.head_img,style:{width:"50px",height:"30px"}},null,8,["src"])):(p(),E("span",Je,"-"))]),_:1}),o(i,{prop:"name",label:"\u540D\u79F0","min-width":"100"}),o(i,{prop:"class_names",label:"\u804C\u4E1A","min-width":"150"}),o(i,{prop:"sex",label:"\u6027\u522B","min-width":"100"},{default:n(({row:u})=>[g(b(u.sex===1?"\u7537":u.sex===2?"\u5973":"\u5176\u4ED6"),1)]),_:1}),o(i,{prop:"update_time",label:"\u66F4\u65B0\u65F6\u95F4",type:"date"})],64)):k("",!0),B(h)==="3"?(p(),E(q,{key:2},[o(i,{type:"selection",width:"55"}),o(i,{label:"\u56FE\u6587\u540D\u79F0","min-width":"100"},{default:n(({row:u})=>[g(b(u.pic_name),1)]),_:1}),o(i,{prop:"pic_type_name",label:"\u5206\u7C7B",width:"180"}),o(i,{prop:"pic_shelf_time",label:"\u66F4\u65B0\u65F6\u95F4",type:"date",width:"170"})],64)):k("",!0)]),_:1},8,["data","onSortChange","onSelectionChange"])),[[j,e.loading]]),o(Ie,{layout:"total,prev,pager,next,jumper",pageinfo:l.value,onChange:e.load},null,8,["pageinfo","onChange"]),o(qe,{ref_key:"bindRef",ref:A,resource:e.resource,onLoad:e.load},null,8,["resource","onLoad"])]),d("div",{class:"flex-y",style:K({width:x.value?"430px":"0",transition:"all 0.1s",height:"100%","border-left":"12px solid #f5f5f5",overflow:"auto"})},[(p(!0),E(q,null,Z(e.list,u=>(p(),E("div",Qe,[d("div",We,[d("h4",Xe,[g(b(u.siteName)+" ",1),d("span",Ze,"[ "+b(e.resource.name||B(F))+" ]",1)]),B(h)==1?(p(),I(c,{key:0,type:"primary",plain:"",size:"small",onClick:_=>m.autoBind(u.siteId,u.categories)},{default:n(()=>[g("\u4E00\u952E\u7ED1\u5B9A")]),_:2},1032,["onClick"])):k("",!0)]),d("div",He,[(p(!0),E(q,null,Z(u.categories,(_,N)=>(p(),E(q,{key:_.id},[d("div",Ye,[d("p",{class:"popover-item point",style:K("display: inline-block;font-size:14px;"+(e.searchVal.t===_.id?"border-bottom:2px solid #4b82fa":""))},[_.binded?(p(),I(G,{key:1,placement:"left","popper-class":"not_pb",width:140,trigger:"hover",disabled:B(D).query.t==="2"},{reference:n(()=>[d("span",null,[d("span",{onClick:R(v=>m.changeType(_.id),["stop"])},b(_.name),9,ot),g(" ["),d("span",{onClick:R(v=>m.unBind(_.pk),["stop"]),class:"no-bind"},b(_.binded_name),9,lt),g("] ")])]),default:n(()=>[d("div",st,[d("p",ut," \u6536\u8D39\u89C4\u5219\uFF1A"+b(_.chargingMode===1?"\u514D\u8D39":_.chargingMode===2?"VIP\u64AD\u653E":_.chargingMode===3?"\u91D1\u5E01\u70B9\u64AD":"-"),1),_.chargingMode===3?(p(),E("p",nt," \u6240\u9700\u91D1\u5E01\uFF1A"+b(_.gold),1)):k("",!0),d("p",it," \u8BA1\u8D39\u65B9\u5F0F\uFF1A"+b(_.buyMode===1?"\u6309\u90E8":_.buyMode===2?"\u6309\u96C6":"-"),1)])]),_:2},1032,["disabled"])):(p(),E("span",{key:0,onClick:R(v=>{var X;return(X=A.value)==null?void 0:X.open(_,u.siteId)},["stop"])},[d("span",{onClick:R(v=>m.changeType(_.id),["stop"])},b(_.name),9,tt),at],8,et))],4)]),N!==0&&N%2===1?(p(),E("br",dt)):k("",!0)],64))),128))])]))),256))],4)])}}});const kt=oe(rt,[["__scopeId","data-v-a4881fbf"]]);export{kt as default};
