import{N as E,G as L,a as oe,l as h,R as U,S as _,m as S,P as ve,af as me,Q as g,u as e,ag as le,H as w,O as b,p as D,V as T,U as C,W as Q,X as ye,ay as ge,f as he,z as be,s as V,b as Y,K as ke,e as Z,A as Ee,y as $e,B as Re,ab as x,I as ee}from"./vue-11eabec3.js";import{$ as J,as as re,X as A,Y as y,Z as W,ar as we,a0 as j,at as q,s as F,au as _e,av as Ce,aw as Se,ax as Ue,a8 as Le,ay as Pe,x as Fe,a2 as H,az as Te,aA as Oe,aB as Be,af as De}from"./entry-9cc5c370.js";const ie=Symbol("uploadContextKey"),je="ElUpload";class Ae extends Error{constructor(r,s,o,c){super(r),this.name="UploadAjaxError",this.status=s,this.method=o,this.url=c}}function te(n,r,s){let o;return s.response?o=`${s.response.error||s.response}`:s.responseText?o=`${s.responseText}`:o=`fail to ${r.method} ${n} ${s.status}`,new Ae(o,s.status,r.method,n)}function Ne(n){const r=n.responseText||n.response;if(!r)return r;try{return JSON.parse(r)}catch{return r}}const qe=n=>{typeof XMLHttpRequest>"u"&&J(je,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,s=n.action;r.upload&&r.upload.addEventListener("progress",p=>{const f=p;f.percent=p.total>0?p.loaded/p.total*100:0,n.onProgress(f)});const o=new FormData;if(n.data)for(const[p,f]of Object.entries(n.data))Array.isArray(f)?o.append(p,...f):o.append(p,f);o.append(n.filename,n.file,n.file.name),r.addEventListener("error",()=>{n.onError(te(s,n,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return n.onError(te(s,n,r));n.onSuccess(Ne(r))}),r.open(n.method,s,!0),n.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const c=n.headers||{};if(c instanceof Headers)c.forEach((p,f)=>r.setRequestHeader(f,p));else for(const[p,f]of Object.entries(c))re(f)||r.setRequestHeader(p,String(f));return r.send(o),r},ue=["text","picture","picture-card"];let He=1;const G=()=>Date.now()+He++,de=A({action:{type:String,default:"#"},headers:{type:y(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>W({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:y(Array),default:()=>W([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ue,default:"text"},httpRequest:{type:y(Function),default:qe},disabled:Boolean,limit:Number}),Ke=A({...de,beforeUpload:{type:y(Function),default:E},beforeRemove:{type:y(Function)},onRemove:{type:y(Function),default:E},onChange:{type:y(Function),default:E},onPreview:{type:y(Function),default:E},onSuccess:{type:y(Function),default:E},onProgress:{type:y(Function),default:E},onError:{type:y(Function),default:E},onExceed:{type:y(Function),default:E}}),Me=A({files:{type:y(Array),default:()=>W([])},disabled:{type:Boolean,default:!1},handlePreview:{type:y(Function),default:E},listType:{type:String,values:ue,default:"text"}}),ze={remove:n=>!!n},Ie=["onKeydown"],Xe=["src"],Ve=["onClick"],We=["onClick"],Ge=["onClick"],Je=L({name:"ElUploadList"}),Qe=L({...Je,props:Me,emits:ze,setup(n,{emit:r}){const{t:s}=we(),o=j("upload"),c=j("icon"),p=j("list"),f=q(),R=oe(!1),$=u=>{r("remove",u)};return(u,k)=>(h(),U(ge,{tag:"ul",class:g([e(o).b("list"),e(o).bm("list",u.listType),e(o).is("disabled",e(f))]),name:e(p).b()},{default:_(()=>[(h(!0),S(ve,null,me(u.files,v=>(h(),S("li",{key:v.uid||v.name,class:g([e(o).be("list","item"),e(o).is(v.status),{focusing:R.value}]),tabindex:"0",onKeydown:le(a=>!e(f)&&$(v),["delete"]),onFocus:k[0]||(k[0]=a=>R.value=!0),onBlur:k[1]||(k[1]=a=>R.value=!1),onClick:k[2]||(k[2]=a=>R.value=!1)},[w(u.$slots,"default",{file:v},()=>[u.listType==="picture"||v.status!=="uploading"&&u.listType==="picture-card"?(h(),S("img",{key:0,class:g(e(o).be("list","item-thumbnail")),src:v.url,alt:""},null,10,Xe)):b("v-if",!0),v.status==="uploading"||u.listType!=="picture-card"?(h(),S("div",{key:1,class:g(e(o).be("list","item-info"))},[D("a",{class:g(e(o).be("list","item-name")),onClick:T(a=>u.handlePreview(v),["prevent"])},[C(e(F),{class:g(e(c).m("document"))},{default:_(()=>[C(e(_e))]),_:1},8,["class"]),D("span",{class:g(e(o).be("list","item-file-name"))},Q(v.name),3)],10,Ve),v.status==="uploading"?(h(),U(e(Ce),{key:0,type:u.listType==="picture-card"?"circle":"line","stroke-width":u.listType==="picture-card"?6:2,percentage:Number(v.percentage),style:ye(u.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):b("v-if",!0)],2)):b("v-if",!0),D("label",{class:g(e(o).be("list","item-status-label"))},[u.listType==="text"?(h(),U(e(F),{key:0,class:g([e(c).m("upload-success"),e(c).m("circle-check")])},{default:_(()=>[C(e(Se))]),_:1},8,["class"])):["picture-card","picture"].includes(u.listType)?(h(),U(e(F),{key:1,class:g([e(c).m("upload-success"),e(c).m("check")])},{default:_(()=>[C(e(Ue))]),_:1},8,["class"])):b("v-if",!0)],2),e(f)?b("v-if",!0):(h(),U(e(F),{key:2,class:g(e(c).m("close")),onClick:a=>$(v)},{default:_(()=>[C(e(Le))]),_:2},1032,["class","onClick"])),b(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),b(" This is a bug which needs to be fixed "),b(" TODO: Fix the incorrect navigation interaction "),e(f)?b("v-if",!0):(h(),S("i",{key:3,class:g(e(c).m("close-tip"))},Q(e(s)("el.upload.deleteTip")),3)),u.listType==="picture-card"?(h(),S("span",{key:4,class:g(e(o).be("list","item-actions"))},[D("span",{class:g(e(o).be("list","item-preview")),onClick:a=>u.handlePreview(v)},[C(e(F),{class:g(e(c).m("zoom-in"))},{default:_(()=>[C(e(Pe))]),_:1},8,["class"])],10,We),e(f)?b("v-if",!0):(h(),S("span",{key:0,class:g(e(o).be("list","item-delete")),onClick:a=>$(v)},[C(e(F),{class:g(e(c).m("delete"))},{default:_(()=>[C(e(Fe))]),_:1},8,["class"])],10,Ge))],2)):b("v-if",!0)])],42,Ie))),128)),w(u.$slots,"append")]),_:3},8,["class","name"]))}});var se=H(Qe,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const Ye=A({disabled:{type:Boolean,default:!1}}),Ze={file:n=>he(n)},xe=["onDrop","onDragover"],ce="ElUploadDrag",et=L({name:ce}),tt=L({...et,props:Ye,emits:Ze,setup(n,{emit:r}){const s=be(ie);s||J(ce,"usage: <el-upload><el-upload-dragger /></el-upload>");const o=j("upload"),c=oe(!1),p=q(),f=$=>{if(p.value)return;c.value=!1;const u=Array.from($.dataTransfer.files),k=s.accept.value;if(!k){r("file",u);return}const v=u.filter(a=>{const{type:i,name:t}=a,d=t.includes(".")?`.${t.split(".").pop()}`:"",m=i.replace(/\/.*$/,"");return k.split(",").map(l=>l.trim()).filter(l=>l).some(l=>l.startsWith(".")?d===l:/\/\*$/.test(l)?m===l.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(l)?i===l:!1)});r("file",v)},R=()=>{p.value||(c.value=!0)};return($,u)=>(h(),S("div",{class:g([e(o).b("dragger"),e(o).is("dragover",c.value)]),onDrop:T(f,["prevent"]),onDragover:T(R,["prevent"]),onDragleave:u[0]||(u[0]=T(k=>c.value=!1,["prevent"]))},[w($.$slots,"default")],42,xe))}});var st=H(tt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const at=A({...de,beforeUpload:{type:y(Function),default:E},onRemove:{type:y(Function),default:E},onStart:{type:y(Function),default:E},onSuccess:{type:y(Function),default:E},onProgress:{type:y(Function),default:E},onError:{type:y(Function),default:E},onExceed:{type:y(Function),default:E}}),nt=["onKeydown"],ot=["name","multiple","accept"],lt=L({name:"ElUploadContent",inheritAttrs:!1}),rt=L({...lt,props:at,setup(n,{expose:r}){const s=n,o=j("upload"),c=q(),p=V({}),f=V(),R=t=>{if(t.length===0)return;const{autoUpload:d,limit:m,fileList:l,multiple:N,onStart:P,onExceed:K}=s;if(m&&l.length+t.length>m){K(t,l);return}N||(t=t.slice(0,1));for(const M of t){const O=M;O.uid=G(),P(O),d&&$(O)}},$=async t=>{if(f.value.value="",!s.beforeUpload)return u(t);let d;try{d=await s.beforeUpload(t)}catch{d=!1}if(d===!1){s.onRemove(t);return}let m=t;d instanceof Blob&&(d instanceof File?m=d:m=new File([d],t.name,{type:t.type})),u(Object.assign(m,{uid:t.uid}))},u=t=>{const{headers:d,data:m,method:l,withCredentials:N,name:P,action:K,onProgress:M,onSuccess:O,onError:pe,httpRequest:fe}=s,{uid:z}=t,I={headers:d||{},withCredentials:N,file:t,data:m,method:l,filename:P,action:K,onProgress:B=>{M(B,t)},onSuccess:B=>{O(B,t),delete p.value[z]},onError:B=>{pe(B,t),delete p.value[z]}},X=fe(I);p.value[z]=X,X instanceof Promise&&X.then(I.onSuccess,I.onError)},k=t=>{const d=t.target.files;!d||R(Array.from(d))},v=()=>{c.value||(f.value.value="",f.value.click())},a=()=>{v()};return r({abort:t=>{Te(p.value).filter(t?([m])=>String(t.uid)===m:()=>!0).forEach(([m,l])=>{l instanceof XMLHttpRequest&&l.abort(),delete p.value[m]})},upload:$}),(t,d)=>(h(),S("div",{class:g([e(o).b(),e(o).m(t.listType),e(o).is("drag",t.drag)]),tabindex:"0",onClick:v,onKeydown:le(T(a,["self"]),["enter","space"])},[t.drag?(h(),U(st,{key:0,disabled:e(c),onFile:R},{default:_(()=>[w(t.$slots,"default")]),_:3},8,["disabled"])):w(t.$slots,"default",{key:1}),D("input",{ref_key:"inputRef",ref:f,class:g(e(o).e("input")),name:t.name,multiple:t.multiple,accept:t.accept,type:"file",onChange:k,onClick:d[0]||(d[0]=T(()=>{},["stop"]))},null,42,ot)],42,nt))}});var ae=H(rt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const ne="ElUpload",it=n=>{var r;(r=n.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(n.url)},ut=(n,r)=>{const s=Oe(n,"fileList",void 0,{passive:!0}),o=a=>s.value.find(i=>i.uid===a.uid);function c(a){var i;(i=r.value)==null||i.abort(a)}function p(a=["ready","uploading","success","fail"]){s.value=s.value.filter(i=>!a.includes(i.status))}const f=(a,i)=>{const t=o(i);!t||(console.error(a),t.status="fail",s.value.splice(s.value.indexOf(t),1),n.onError(a,t,s.value),n.onChange(t,s.value))},R=(a,i)=>{const t=o(i);!t||(n.onProgress(a,t,s.value),t.status="uploading",t.percentage=Math.round(a.percent))},$=(a,i)=>{const t=o(i);!t||(t.status="success",t.response=a,n.onSuccess(a,t,s.value),n.onChange(t,s.value))},u=a=>{re(a.uid)&&(a.uid=G());const i={name:a.name,percentage:0,status:"ready",size:a.size,raw:a,uid:a.uid};if(n.listType==="picture-card"||n.listType==="picture")try{i.url=URL.createObjectURL(a)}catch(t){Be(ne,t.message),n.onError(t,i,s.value)}s.value=[...s.value,i],n.onChange(i,s.value)},k=async a=>{const i=a instanceof File?o(a):a;i||J(ne,"file to be removed not found");const t=d=>{c(d);const m=s.value;m.splice(m.indexOf(d),1),n.onRemove(d,m),it(d)};n.beforeRemove?await n.beforeRemove(i,s.value)!==!1&&t(i):t(i)};function v(){s.value.filter(({status:a})=>a==="ready").forEach(({raw:a})=>{var i;return a&&((i=r.value)==null?void 0:i.upload(a))})}return Y(()=>n.listType,a=>{a!=="picture-card"&&a!=="picture"||(s.value=s.value.map(i=>{const{raw:t,url:d}=i;if(!d&&t)try{i.url=URL.createObjectURL(t)}catch(m){n.onError(m,i,s.value)}return i}))}),Y(s,a=>{for(const i of a)i.uid||(i.uid=G()),i.status||(i.status="success")},{immediate:!0,deep:!0}),{uploadFiles:s,abort:c,clearFiles:p,handleError:f,handleProgress:R,handleStart:u,handleSuccess:$,handleRemove:k,submit:v}},dt=L({name:"ElUpload"}),ct=L({...dt,props:Ke,setup(n,{expose:r}){const s=n,o=ke(),c=q(),p=V(),{abort:f,submit:R,clearFiles:$,uploadFiles:u,handleStart:k,handleError:v,handleRemove:a,handleSuccess:i,handleProgress:t}=ut(s,p),d=Z(()=>s.listType==="picture-card"),m=Z(()=>({...s,fileList:u.value,onStart:k,onProgress:t,onSuccess:i,onError:v,onRemove:a}));return Ee(()=>{u.value.forEach(({url:l})=>{l!=null&&l.startsWith("blob:")&&URL.revokeObjectURL(l)})}),$e(ie,{accept:Re(s,"accept")}),r({abort:f,submit:R,clearFiles:$,handleStart:k,handleRemove:a}),(l,N)=>(h(),S("div",null,[e(d)&&l.showFileList?(h(),U(se,{key:0,disabled:e(c),"list-type":l.listType,files:e(u),"handle-preview":l.onPreview,onRemove:e(a)},x({append:_(()=>[C(ae,ee({ref_key:"uploadRef",ref:p},e(m)),{default:_(()=>[e(o).trigger?w(l.$slots,"trigger",{key:0}):b("v-if",!0),!e(o).trigger&&e(o).default?w(l.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)]),_:2},[l.$slots.file?{name:"default",fn:_(({file:P})=>[w(l.$slots,"file",{file:P})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):b("v-if",!0),!e(d)||e(d)&&!l.showFileList?(h(),U(ae,ee({key:1,ref_key:"uploadRef",ref:p},e(m)),{default:_(()=>[e(o).trigger?w(l.$slots,"trigger",{key:0}):b("v-if",!0),!e(o).trigger&&e(o).default?w(l.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)):b("v-if",!0),l.$slots.trigger?w(l.$slots,"default",{key:2}):b("v-if",!0),w(l.$slots,"tip"),!e(d)&&l.showFileList?(h(),U(se,{key:3,disabled:e(c),"list-type":l.listType,files:e(u),"handle-preview":l.onPreview,onRemove:e(a)},x({_:2},[l.$slots.file?{name:"default",fn:_(({file:P})=>[w(l.$slots,"file",{file:P})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):b("v-if",!0)]))}});var pt=H(ct,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const mt=De(pt);export{mt as E,qe as a,G as g};
