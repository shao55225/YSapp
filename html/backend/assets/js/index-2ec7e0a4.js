import{R as E,_ as $,u as N,E as R,b as H,c as ee,g as te,F as le,G as oe,h as P,d as ae,f as ie,i as ne,j as O,k as se,v as G,o as re,bV as ue,q,C as de,m as pe}from"./entry-9cc5c370.js";/* empty css                        *//* empty css                   */import{p as me}from"./plugHeader-c50619f4.js";import{f as ce}from"./filter-808d0c52.js";import{P as ge}from"./pagination-db6078c7.js";import{E as _e}from"./el-date-picker-4cb808f0.js";import"./wangEditor.vue_vue_type_style_index_0_scoped_ecc7ed11_lang-d1f96ae7.js";import{w as fe}from"./wangEditor-4ddf8920.js";import{a as I,Z as L,z as he,e as be,d as K,C as ve,m as v,U as t,S as o,u as x,l as g,a6 as f,L as W,R as C,O as M,P as Te,af as xe,ap as ye,aq as Ve,p as T,G as ke,W as V}from"./vue-11eabec3.js";import{E as Ce}from"./index-bf5a11eb.js";/* empty css                                                               *//* empty css                      */import"./index-971e6ee4.js";/* empty css                                                                   */import"./panel-time-pick-2e9d1eeb.js";import"./arrays-2e03ed1f.js";const Ee=(p={page:0})=>E({url:"/notices/page",method:"get",params:p}),Fe=p=>E({url:"/notices/"+p,method:"delete"}),we=p=>E({url:"/notices",method:"post",data:p}),Z=p=>E({url:"/notices/"+p.id,method:"put",data:p});const F=p=>(ye("data-v-55f8f530"),p=p(),Ve(),p),Se=F(()=>T("span",{style:{"font-size":"12px"}},"\u666E\u901A",-1)),Be=F(()=>T("span",{style:{"font-size":"12px"}},"\u5F39\u7A97",-1)),Ae=F(()=>T("span",{style:{"font-size":"12px"}},"\u6BCF\u6B21",-1)),Ie=F(()=>T("span",{style:{"font-size":"12px"}},"\u4E00\u6B21",-1)),Le={__name:"editor",emits:["load"],setup(p,{expose:w,emit:_}){const s=N(),h=I(),e=L({content:"",expirationTime:void 0,name:"",link:"",noticeType:2,popupTrigger:1,sort:1,id:0,startTime:void 0,state:1,isAllSite:1}),n=L({loading:!1,visible:!1,other:{}}),r=he("debounce")(m=>{!m||m.validate(l=>{l&&e.expirationTime!=0&&e.startTime!=0&&(console.log(new Date(e.expirationTime).getHours()),e.startTime=parseInt((e.startTime/1e3).toFixed(0)),e.expirationTime=Math.floor((new Date(e.expirationTime).getHours()!==23?e.expirationTime+86399999:e.expirationTime)/1e3),e.link&&(e.link=e.link.includes("http")?e.link:"http://"+e.link),l&&(n.loading=!0,(e.id?Z(e):we(e)).then(()=>{R.success({message:n.other.id?"\u516C\u544A\u66F4\u65B0\u6210\u529F":"\u516C\u544A\u65B0\u589E\u6210\u529F",showClose:!0,position:"bottom-right"}),_("load"),y()}).finally(()=>{n.loading=!1})),e.startTime<2e9&&(e.startTime=e.startTime*1e3),e.expirationTime<2e9&&(e.expirationTime=e.expirationTime*1e3))})},300),d=()=>{e.sort==null&&(e.sort=1)},y=()=>{n.other={},n.visible=!1},c={name:{required:!0,message:"\u8BF7\u8F93\u5165\u516C\u544A\u540D\u79F0",trigger:"blur"},content:{required:!0,message:"\u8BF7\u8F93\u5165\u516C\u544A\u5185\u5BB9",trigger:"blur"},startTime:[{required:!0,message:"\u8BF7\u9009\u62E9\u542F\u7528\u65E5\u671F",trigger:"blur"},{validator:(m,l,a)=>{l?a():a(new Error("\u8BF7\u9009\u62E9\u542F\u7528\u65E5\u671F"))},trigger:"blur"}],expirationTime:[{required:!0,message:"\u8BF7\u9009\u62E9\u8FC7\u671F\u65E5\u671F",trigger:"blur"},{validator:(m,l,a)=>{l?a():a(new Error("\u8BF7\u9009\u62E9\u8FC7\u671F\u65E5\u671F"))},trigger:"blur"}],sort:{required:!0,pattern:/^(-)?[0-9]*$/,message:"\u8BF7\u8F93\u5165\u6570\u5B57",trigger:"blur"},noticeType:{required:!0,message:"\u8BF7\u9009\u62E9\u7C7B\u578B",trigger:"blur"},popupTrigger:{required:!0,message:"\u8BF7\u9009\u62E9\u65B9\u5F0F",trigger:"blur"},state:{required:!0,message:"\u8BF7\u9009\u62E9\u72B6\u6001",trigger:"blur"},siteIds:{required:!0,message:"\u8BF7\u9009\u62E9\u7AD9\u70B9",trigger:"change"}};function S(){var m;Object.keys(e).forEach(l=>{e[l]=n.other[l]||e[l]}),e.id=(m=n.other)==null?void 0:m.id,e.id?e.siteIds=n.other.sites.map(l=>l.id)||"":s.siteVal>0&&(e.siteIds=[s.siteVal])}w({open(m){var l;e.startTime=void 0,e.expirationTime=void 0,(l=h.value)==null||l.resetFields(),n.other=m,n.visible=!0}});const B=be(()=>n.other.id?"\u7F16\u8F91\u516C\u544A":"\u65B0\u589E\u516C\u544A");return K(()=>{document.getElementsByTagName("body")[0].classList.add("notice")}),ve(()=>{document.getElementsByTagName("body")[0].classList.remove("notice")}),(m,l)=>{const a=H,u=ee,b=_e,A=te,k=le,D=oe,U=P,J=ae,Q=ie,X=ne,z=O,Y=se,j=G;return g(),v("div",null,[t(Y,{"model-value":n.visible,"show-close":!n.loading,"close-on-press-escape":!1,title:x(B),width:600,"z-index":20,"close-on-click-modal":!1,onClose:y,onOpened:S},{footer:o(()=>[t(z,{class:"ml-auto",size:"small",loading:n.loading,onClick:y},{default:o(()=>[f(" \u53D6\u6D88 ")]),_:1},8,["loading"]),t(z,{size:"small",loading:n.loading,type:"primary",class:"border-0 bg-orange group-hover:bg-orangeLight",onClick:l[11]||(l[11]=i=>x(r)(h.value))},{default:o(()=>[f(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),default:o(()=>[W((g(),v("div",null,[t(X,{ref_key:"ruleFormRef",ref:h,"label-width":"80px",model:e,rules:c,"hide-required-asterisk":!1},{default:o(()=>[t(u,{label:"\u516C\u544A\u540D\u79F0",prop:"name"},{default:o(()=>[t(a,{spellcheck:"false",modelValue:e.name,"onUpdate:modelValue":l[0]||(l[0]=i=>e.name=i),modelModifiers:{trim:!0},clearable:"",class:"input",placeholder:"\u8BF7\u8F93\u5165\u516C\u544A\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(u,{label:"\u8DF3\u8F6C\u94FE\u63A5",prop:"link"},{default:o(()=>[t(a,{spellcheck:"false",modelValue:e.link,"onUpdate:modelValue":l[1]||(l[1]=i=>e.link=i),modelModifiers:{trim:!0},clearable:"",class:"input",placeholder:"\u8BF7\u8F93\u5165\u8DF3\u8F6C\u94FE\u63A5"},null,8,["modelValue"])]),_:1}),t(u,{label:"\u516C\u544A\u5185\u5BB9",prop:"content"},{default:o(()=>[t(fe,{"model-value":e.content,height:"200px",config:{pasteIgnoreImg:!0},type:"text",class:"linkwangEdit",style:{"z-index":"1",width:"100%"},"toolbar-cfg":{toolbarKeys:["bold","color","italic","fontSize","underline",{key:"group-link",title:"\u94FE\u63A5",menuKeys:["insertLink","editLink","unLink","viewLink"]}],modalAppendToBody:!0},"onUpdate:modelValue":l[2]||(l[2]=i=>e.content=i==="<p><br></p>"?"":i)},null,8,["model-value"])]),_:1}),t(u,{prop:"startTime",label:"\u6709\u6548\u671F",clearable:"",class:"group"},{default:o(()=>[t(b,{"model-value":e.expirationTime?[e.startTime,e.expirationTime]:[],type:"daterange",placeholder:"\u8BF7\u9009\u62E9\u6709\u6548\u671F","value-format":"x","onUpdate:modelValue":l[3]||(l[3]=i=>[e.startTime,e.expirationTime]=i&&i[1]?i:[void 0,void 0])},null,8,["model-value"])]),_:1}),t(u,{label:"\u663E\u793A\u987A\u5E8F",prop:"sort",clearable:""},{default:o(()=>[t(A,{spellcheck:"false",modelValue:e.sort,"onUpdate:modelValue":l[4]||(l[4]=i=>e.sort=i),modelModifiers:{number:!0},clearable:"",class:"input xuhao",placeholder:"\u9ED8\u8BA41","controls-position":"right",min:1,precision:0,"value-on-clear":1,"step-strictly":"",onBlur:l[5]||(l[5]=i=>d())},null,8,["modelValue"])]),_:1}),t(u,{label:"\u516C\u544A\u7C7B\u578B",prop:"noticeType"},{default:o(()=>[t(D,{modelValue:e.noticeType,"onUpdate:modelValue":l[6]||(l[6]=i=>e.noticeType=i),modelModifiers:{number:!0}},{default:o(()=>[t(k,{label:2},{default:o(()=>[Se]),_:1}),t(k,{label:1},{default:o(()=>[Be]),_:1})]),_:1},8,["modelValue"])]),_:1}),e.noticeType==1?(g(),C(u,{key:0,label:"\u89E6\u53D1\u65B9\u5F0F",prop:"popupTrigger"},{default:o(()=>[t(D,{modelValue:e.popupTrigger,"onUpdate:modelValue":l[7]||(l[7]=i=>e.popupTrigger=i),modelModifiers:{number:!0}},{default:o(()=>[t(k,{label:1},{default:o(()=>[Ae]),_:1}),t(k,{label:2},{default:o(()=>[Ie]),_:1})]),_:1},8,["modelValue"])]),_:1})):M("",!0),t(u,{label:"\u516C\u544A\u72B6\u6001",prop:"state"},{default:o(()=>[t(U,{modelValue:e.state,"onUpdate:modelValue":l[8]||(l[8]=i=>e.state=i),"active-value":1,"inactive-value":2,size:"small"},null,8,["modelValue"])]),_:1}),t(u,{label:"\u5E94\u7528\u5168\u7AD9",prop:"isAllSite"},{default:o(()=>[t(U,{modelValue:e.isAllSite,"onUpdate:modelValue":l[9]||(l[9]=i=>e.isAllSite=i),"active-value":1,"inactive-value":2,size:"small"},null,8,["modelValue"])]),_:1}),e.isAllSite==2?(g(),C(u,{key:1,label:"\u7AD9\u70B9\u540D\u79F0",prop:"siteIds"},{default:o(()=>[t(Q,{modelValue:e.siteIds,"onUpdate:modelValue":l[10]||(l[10]=i=>e.siteIds=i),multiple:"",class:"input",placeholder:"\u9009\u62E9\u7AD9\u70B9"},{default:o(()=>[(g(!0),v(Te,null,xe(x(s).list,i=>(g(),C(J,{key:i.id,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):M("",!0)]),_:1},8,["model"])])),[[j,n.loading]])]),_:1},8,["model-value","show-close","title"])])}}},De=$(Le,[["__scopeId","data-v-55f8f530"]]),Ue={class:"flex-y box",style:{"padding-top":"24px"}},ze=["title"],qe=["innerHTML"],Me=["innerHTML"],$e={key:0},Ne={key:1},Re={key:2},He=ke({__name:"index",setup(p){const w=N(),_=I({pageIndex:1,pageSize:20,total:0}),s=L({loading:!1,data:[],searchVal:{keywords:"",order:""},selectList:[],load(n){_.value=n||_.value,s.loading=!0,Ee({page:_.value.pageIndex,limit:_.value.pageSize,siteId:w.siteVal,...s.searchVal}).then(r=>{s.data=r.list,s.data.forEach(d=>{d.startTime<2e9&&(d.startTime=d.startTime*1e3),d.expirationTime<2e9&&(d.expirationTime=d.expirationTime*1e3)}),_.value.total=r.total}).finally(()=>{s.loading=!1})},handleSelectionChange(n){this.selectList=n},sortChnage({column:n,prop:r,order:d}){d?s.searchVal.order=`${r} ${d==="ascending"?"asc":"desc"}`:s.searchVal.order="",s.load()}}),h=I(),e={statusChange(n,r){r.loading=!0,Z({...r,siteIds:r.sites.map(d=>d.id),expirationTime:r.expirationTime/1e3,startTime:r.startTime/1e3}).catch(()=>{r.state=n===1?2:1}).then(()=>{R({position:"bottom-right",type:"success",message:"\u72B6\u6001\u66F4\u65B0\u6210\u529F"})}).catch(()=>{r.state=n===1?2:1}).finally(()=>{r.loading=!1})},del:n=>de({message:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F\u5220\u9664\u540E\u516C\u544A\u5C06\u4E0D\u518D\u663E\u793A",okEms:"\u516C\u544A\u5220\u9664\u6210\u529F"},()=>Fe(n.id).then(r=>(s.load(),r)))};return K(()=>{s.load()}),(n,r)=>{const d=O,y=H,c=pe,S=Ce,B=P,m=re,l=G;return g(),v("div",Ue,[t(me,null,{default:o(()=>[f("\u516C\u544A\u7BA1\u7406")]),_:1}),t(ce,{onLoad:s.load},{prefix:o(()=>[t(d,{type:"primary",onClick:r[0]||(r[0]=a=>{var u;return(u=h.value)==null?void 0:u.open({})})},{default:o(()=>[f(" \u65B0\u589E\u516C\u544A ")]),_:1})]),prepend:o(()=>[]),suffix:o(()=>[t(y,{spellcheck:"false",modelValue:s.searchVal.keywords,"onUpdate:modelValue":r[1]||(r[1]=a=>s.searchVal.keywords=a),"prefix-icon":x(ue),placeholder:"\u641C\u7D22\u5173\u952E\u5B57",class:"mr-4 w-36",clearable:"",onChange:r[2]||(r[2]=a=>{_.value.pageIndex=1,s.load()})},null,8,["modelValue","prefix-icon"])]),_:1},8,["onLoad"]),W((g(),C(m,{data:s.data,class:"auto",stripe:!0,onSortChange:s.sortChnage,onSelectionChange:s.handleSelectionChange},{default:o(()=>[t(c,{prop:"id",label:"ID",width:"100"}),t(c,{prop:"name",label:"\u540D\u79F0","min-width":"80"},{default:o(({row:a})=>[T("div",{class:"index",title:a.name},V(a.name),9,ze)]),_:1}),t(c,{prop:"link",label:"\u8DF3\u8F6C\u94FE\u63A5","min-width":"120","show-overflow-tooltip":!0}),t(c,{prop:"content",label:"\u5185\u5BB9","min-width":"200"},{default:o(({row:a})=>[t(S,{width:500,trigger:"hover"},{reference:o(()=>[T("div",{class:"index",innerHTML:a.content},null,8,Me)]),default:o(()=>[T("div",{style:{"word-wrap":"break-word","max-height":"50vh",overflow:"auto",padding:"12px"},innerHTML:a.content},null,8,qe)]),_:2},1024)]),_:1}),t(c,{prop:"noticeType",label:"\u7C7B\u578B","min-width":"80"},{default:o(({row:a})=>[f(V(a.noticeType===1?"\u5F39\u7A97":a.noticeType===2?"\u666E\u901A":"-"),1)]),_:1}),t(c,{prop:"state",label:"\u72B6\u6001","min-width":"80"},{default:o(({row:a})=>[t(B,{modelValue:a.state,"onUpdate:modelValue":u=>a.state=u,"active-value":1,loading:a.loading,"inactive-value":2,onChange:u=>e.statusChange(u,a)},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]),_:1}),t(c,{label:"\u6240\u5C5E\u7AD9\u70B9","min-width":"95"},{default:o(({row:a})=>{var u,b;return[a.isAllSite==1?(g(),v("span",$e,"\u6240\u6709\u7AD9\u70B9")):((u=a.sites)==null?void 0:u.length)==0?(g(),v("span",Ne,"\u9ED8\u8BA4\u7AD9\u70B9")):(g(),v("span",Re,V(((b=a.sites)==null?void 0:b.map(A=>A.name).join("\uFF0C"))||"-"),1))]}),_:1}),t(c,{prop:"sort",label:"\u663E\u793A\u987A\u5E8F",width:"100"}),t(c,{label:"\u542F\u7528\u65E5\u671F",width:"130px",prop:"startTime",sortable:""},{default:o(({row:a})=>[f(V(x(q)(a.startTime,"{y}-{m}-{d}")),1)]),_:1}),t(c,{label:"\u8FC7\u671F\u65E5\u671F",sortable:"",prop:"expirationTime",width:"130px"},{default:o(({row:a})=>[f(V(x(q)(a.expirationTime,"{y}-{m}-{d}")),1)]),_:1}),t(c,{fixed:"right",label:"\u64CD\u4F5C","min-width":"110",align:"right"},{default:o(({row:a})=>[t(d,{type:"primary",link:"",onClick:u=>{var b;return(b=h.value)==null?void 0:b.open(a)}},{default:o(()=>[f(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),t(d,{type:"danger",link:"",class:"text-dangerColor",onClick:u=>e.del(a)},{default:o(()=>[f(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSortChange","onSelectionChange"])),[[l,s.loading]]),t(ge,{pageinfo:_.value,onChange:s.load},null,8,["pageinfo","onChange"]),t(De,{ref_key:"editorRef",ref:h,onLoad:s.load},null,8,["onLoad"])])}}});const nt=$(He,[["__scopeId","data-v-45623637"]]);export{nt as default};
