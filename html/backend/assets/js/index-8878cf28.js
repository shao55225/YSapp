import{R as B,_ as R,E as j,b as ee,c as te,d as le,f as ae,g as oe,j as P,h as H,i as ne,k as se,v as O,T as ie,o as re,C as ue,m as de}from"./entry-9cc5c370.js";/* empty css                        *//* empty css                   */import{P as pe}from"./pagination-db6078c7.js";import{E as ce}from"./el-time-picker-14ba9785.js";import{a as me}from"./repository-d7a349f9.js";import{a as T,Z as z,z as ge,d as M,e as _e,m as g,U as a,S as o,u as D,l as d,a6 as h,L as G,P as $,af as A,R as I,p as y,W as C,O as x,ap as fe,aq as ve,G as he}from"./vue-11eabec3.js";import{E as be}from"./index-bf5a11eb.js";/* empty css                      */import"./index-971e6ee4.js";/* empty css                                                                   */import"./panel-time-pick-2e9d1eeb.js";const ye=(c={page:0})=>B({url:"/collectionTask/page",method:"get",params:c}),Ce=c=>B({url:"/collectionTask/del",method:"delete",data:{ids:c}}),Ve=c=>B({url:"/collectionTask/save",method:"post",data:c}),ke=(c,V)=>B({url:`/collectionTask/${c}/status/${V}`,method:"put"});const J=c=>(fe("data-v-c5d0f1b2"),c=c(),ve(),c),Fe={style:{display:"flex","align-items":"center",gap:"8px","flex-wrap":"wrap"}},Ee=J(()=>y("span",{class:"icon iconfont icon-xinjian"},null,-1)),xe={style:{width:"100%"}},$e=J(()=>y("span",{style:{"font-size":"14px"},class:"icon iconfont icon-shanchushujuku"},null,-1)),Ie={__name:"editor",emits:["load"],setup(c,{expose:V,emit:_}){const n=T(),e=z({collectionId:void 0,id:0,interval:0,name:"",triggerType:1,status:1,type:1,times:[]}),i=z({loading:!1,visible:!1,other:void 0}),p=[],s=[];for(let t=0;t<60;t++)t>=15&&s.push(t),p.push(t);console.log(p,s);const f=ge("debounce")(t=>{!t||t.validate(l=>{l&&(i.loading=!0,Ve(e).then(()=>{var u;j({position:"bottom-right",type:"success",message:(u=i.other)!=null&&u.id?"\u4EFB\u52A1\u66F4\u65B0\u6210\u529F":"\u4EFB\u52A1\u65B0\u589E\u6210\u529F"}),_("load"),m()}).finally(()=>{i.loading=!1}))})},300),S=(t,l,u)=>{e.triggerType===2?e.times.length===0?u(new Error("\u8BF7\u8BBE\u7F6E\u91C7\u96C6\u65F6\u95F4")):new Set(e.times).size<e.times.length?u(new Error("\u65F6\u95F4\u4E0D\u80FD\u91CD\u590D")):u():u()},m=()=>{i.other=void 0,i.visible=!1},w={name:{required:!0,message:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",trigger:"blur"},collectionId:{required:!0,message:"\u8BF7\u9009\u62E9\u8D44\u6E90\u5E93",trigger:"blur"},type:{required:!0,message:"\u8BF7\u9009\u62E9\u91C7\u96C6\u7C7B\u578B",trigger:"blur"},interval:{required:!0,message:"\u8BF7\u8F93\u5165\u91C7\u96C6\u65F6\u95F4",trigger:"blur"}},k=T([]);M(()=>{me({limit:9999}).then(t=>{k.value=t.list})});function L(){var t,l;(t=n.value)==null||t.resetFields(),Object.keys(e).forEach(u=>{var v;e[u]=((v=i.other)==null?void 0:v[u])||e[u]}),e.id=(l=i.other)==null?void 0:l.id}V({open(t){var l;e.interval=0,e.triggerType=1,e.times=[],(l=n.value)==null||l.resetFields(),i.visible=!0,i.other=t}});const U=_e(()=>{var t;return(t=i.other)!=null&&t.id?"\u7F16\u8F91\u4EFB\u52A1":"\u65B0\u589E\u4EFB\u52A1"});return(t,l)=>{const u=ee,v=te,b=le,N=ae,W=oe,F=P,Z=ce,K=H,Q=ne,X=se,Y=O;return d(),g("div",null,[a(X,{"model-value":i.visible,"show-close":!i.loading,"close-on-press-escape":!1,title:D(U),width:550,"z-index":20,"close-on-click-modal":!1,onClose:m,onOpened:L},{footer:o(()=>[a(F,{class:"ml-auto",size:"small",loading:i.loading,onClick:m},{default:o(()=>[h(" \u53D6\u6D88 ")]),_:1},8,["loading"]),a(F,{size:"small",loading:i.loading,type:"primary",class:"border-0 bg-orange group-hover:bg-orangeLight",onClick:l[7]||(l[7]=r=>D(f)(n.value))},{default:o(()=>[h(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),default:o(()=>[G((d(),g("div",null,[a(Q,{ref_key:"ruleFormRef",ref:n,"label-width":"80px",model:e,rules:w,"hide-required-asterisk":!1},{default:o(()=>[a(v,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"name"},{default:o(()=>[a(u,{spellcheck:"false",modelValue:e.name,"onUpdate:modelValue":l[0]||(l[0]=r=>e.name=r),modelModifiers:{trim:!0},clearable:"",class:"input",placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0"},null,8,["modelValue"])]),_:1}),a(v,{label:"\u8D44\u6E90\u5E93",prop:"collectionId"},{default:o(()=>[a(N,{modelValue:e.collectionId,"onUpdate:modelValue":l[1]||(l[1]=r=>e.collectionId=r),clearable:"",class:"w-full",placeholder:"\u8BF7\u9009\u62E9\u8D44\u6E90\u5E93"},{default:o(()=>[(d(!0),g($,null,A(k.value,r=>(d(),I(b,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"\u91C7\u96C6\u7C7B\u578B",prop:"type"},{default:o(()=>[a(N,{modelValue:e.type,"onUpdate:modelValue":l[2]||(l[2]=r=>e.type=r),clearable:"",class:"w-full",placeholder:"\u8BF7\u9009\u62E9\u91C7\u96C6\u7C7B\u578B"},{default:o(()=>[a(b,{label:"\u5F53\u5929",value:1}),a(b,{label:"\u672C\u5468",value:2}),a(b,{label:"\u672C\u6708",value:3}),a(b,{label:"\u5168\u90E8",value:4})]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"\u91C7\u96C6\u65F6\u95F4",prop:"interval",rules:[{required:!0,message:"\u8BF7\u8BBE\u7F6E\u91C7\u96C6\u65F6\u95F4",trigger:"blur"},{validator:S,trigger:"blur"}]},{default:o(()=>[y("div",Fe,[a(N,{modelValue:e.triggerType,"onUpdate:modelValue":l[3]||(l[3]=r=>e.triggerType=r),style:{width:"90px"},placeholder:"\u8BF7\u9009\u62E9\u65F6\u95F4"},{default:o(()=>[a(b,{label:"\u95F4\u9694(\u5206)",value:1}),a(b,{label:"\u5B9A\u65F6",value:2})]),_:1},8,["modelValue"]),e.triggerType===1?(d(),g($,{key:0},[a(W,{spellcheck:"false",modelValue:e.interval,"onUpdate:modelValue":l[4]||(l[4]=r=>e.interval=r),modelModifiers:{number:!0},clearable:"",min:1,controls:!1,"value-on-clear":1,placeholder:"\u8BF7\u8F93\u5165\u95F4\u9694\u5206\u949F"},null,8,["modelValue"]),h(" "+C(`\uFF08${e.interval>=1440?parseInt(e.interval/1440)+"\u5929":""}${e.interval>=60?parseInt(e.interval%1440/60)+"\u5C0F\u65F6":""}${e.interval%60}\u5206\u949F\uFF09`),1)],64)):x("",!0),e.triggerType===2?(d(),I(F,{key:1,onClick:l[5]||(l[5]=r=>e.times.push(0)),type:"primary",link:""},{default:o(()=>[Ee]),_:1})):x("",!0),e.triggerType===2?(d(!0),g($,{key:2},A(e.times,(r,E)=>(d(),g("div",xe,[a(Z,{"model-value":`${parseInt(e.times[E]/60)}:${e.times[E]%60}`,"onUpdate:modelValue":q=>e.times[E]=Number(q.split(":")[0]*60)+Number(q.split(":")[1]),placeholder:"Arbitrary time",format:"HH:mm",clearable:!1,"value-format":"HH:mm"},null,8,["model-value","onUpdate:modelValue"]),e.triggerType===2?(d(),I(F,{key:0,onClick:q=>e.times.splice(E,1),type:"danger",link:"",style:{"margin-top":"-4px","margin-left":"12px"}},{default:o(()=>[$e]),_:2},1032,["onClick"])):x("",!0)]))),256)):x("",!0)])]),_:1},8,["rules"]),a(v,{label:"\u4EFB\u52A1\u72B6\u6001",prop:"status"},{default:o(()=>[a(K,{modelValue:e.status,"onUpdate:modelValue":l[6]||(l[6]=r=>e.status=r),"active-value":1,"inactive-value":2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])),[[Y,i.loading]])]),_:1},8,["model-value","show-close","title"])])}}},Te=R(Ie,[["__scopeId","data-v-c5d0f1b2"]]),Be={class:"flex-y box"},Se={class:"flex-x-between"},we={class:"search",style:{margin:"0"}},Le={key:0},Ue={key:1},Ne={style:{padding:"8px 18px","word-spacing":"8px"}},qe=he({__name:"index",setup(c){const V={1:"\u5F53\u5929",2:"\u672C\u5468",3:"\u672C\u6708",4:"\u5168\u90E8"},_=T({pageIndex:1,pageSize:20,total:0}),n=z({loading:!1,data:[],searchVal:{keywords:"",order:""},selectList:[],load(p){_.value=p||_.value,n.loading=!0,ye({page:_.value.pageIndex,limit:_.value.pageSize,...n.searchVal}).then(s=>{n.data=s.list,_.value.total=s.total}).finally(()=>{n.loading=!1})},handleSelectionChange(p){this.selectList=p},sortChnage({column:p,prop:s,order:f}){f?n.searchVal.order=`${s} ${f==="ascending"?"asc":"desc"}`:n.searchVal.order="",n.load()}}),e=T(),i={statusChange(p,s){s.loading=!0,ke(s.id,p).catch(()=>{s.status=p===1?2:1}).then(()=>{j({position:"bottom-right",type:"success",message:"\u72B6\u6001\u66F4\u65B0\u6210\u529F"})}).catch(()=>{s.status=p===1?2:1}).finally(()=>{s.loading=!1})},del:p=>ue({message:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",okEms:"\u4EFB\u52A1\u5220\u9664\u6210\u529F"},()=>Ce([p.id]).then(s=>(n.load(),s)))};return M(()=>{n.load()}),(p,s)=>{const f=P,S=ie,m=de,w=H,k=be,L=re,U=O;return d(),g("div",Be,[y("div",Se,[y("div",null,[a(f,{type:"primary",onClick:s[0]||(s[0]=t=>{var l;return(l=e.value)==null?void 0:l.open({})})},{default:o(()=>[h(" \u65B0\u589E\u4EFB\u52A1 ")]),_:1})]),y("div",we,[a(S,{modelValue:n.searchVal.keywords,"onUpdate:modelValue":s[1]||(s[1]=t=>n.searchVal.keywords=t),onBlur:s[2]||(s[2]=t=>{_.value.pageIndex=1,n.load()})},null,8,["modelValue"])])]),G((d(),I(L,{data:n.data,class:"auto",stripe:!0,onSortChange:n.sortChnage,onSelectionChange:n.handleSelectionChange},{default:o(()=>[a(m,{prop:"name",label:"\u4EFB\u52A1\u540D\u79F0","min-width":"150"}),a(m,{prop:"resourceName",label:"\u8D44\u6E90\u5E93\u540D\u79F0","min-width":"150"}),a(m,{prop:"type",label:"\u91C7\u96C6\u7C7B\u578B","min-width":"150"},{default:o(({row:t})=>[h(C(V[t.type]),1)]),_:1}),a(m,{prop:"status",label:"\u72B6\u6001","min-width":"175"},{default:o(({row:t})=>[a(w,{modelValue:t.status,"onUpdate:modelValue":l=>t.status=l,"active-value":1,"inactive-value":2,loading:t.loading,onChange:l=>i.statusChange(l,t)},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]),_:1}),a(m,{prop:"interval",label:"\u91C7\u96C6\u95F4\u9694",width:"210"},{default:o(({row:t})=>[t.triggerType===1?(d(),g("div",Le,C(t.interval)+C(t.interval>60?`\uFF08${t.interval>1440?parseInt(t.interval/1440)+"\u5929":""}${t.interval>60?parseInt(t.interval%1440/60)+"\u5C0F\u65F6":""}${t.interval%60}\u5206\u949F\uFF09`:"\u5206\u949F"),1)):(d(),g("div",Ue,[a(k,{placement:"top-start","popper-class":"not_pb",width:90,trigger:"hover",teleported:!1},{reference:o(()=>[a(f,{type:"primary",link:""},{default:o(()=>[h(" \u5B9A\u65F6 ")]),_:1})]),default:o(()=>[y("div",Ne,[(d(!0),g($,null,A(t.times,l=>(d(),g("p",null,C(parseInt(l/60))+":"+C(l%60>=10?l%60:"0"+l%60),1))),256))])]),_:2},1024)]))]),_:1}),a(m,{prop:"lastCollectionTime",label:"\u4E0A\u6B21\u91C7\u96C6\u65F6\u95F4",type:"date",width:"150",sortable:""}),a(m,{fixed:"right",label:"\u64CD\u4F5C",align:"right","min-width":"110"},{default:o(({row:t})=>[a(f,{type:"primary",link:"",onClick:l=>{var u;return(u=e.value)==null?void 0:u.open(t)}},{default:o(()=>[h(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),a(f,{type:"danger",link:"",onClick:l=>i.del(t)},{default:o(()=>[h(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSortChange","onSelectionChange"])),[[U,n.loading]]),a(pe,{pageinfo:_.value,onChange:n.load},null,8,["pageinfo","onChange"]),a(Te,{ref_key:"editorRef",ref:e,onLoad:n.load},null,8,["onLoad"])])}}});const Ze=R(qe,[["__scopeId","data-v-4261bbe2"]]);export{Ze as default};
