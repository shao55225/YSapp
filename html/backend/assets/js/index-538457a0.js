import{R as F,bb as Z,E as I,g as le,c as H,i as O,j as E,k as W,v as U,_ as X,a as G,b as te,C as oe,T as ae,o as se,H as ne,m as ie}from"./entry-9cc5c370.js";/* empty css                        */import{E as re}from"./el-link-94d8db34.js";import{a as C,Z as V,l as x,m as w,U as l,S as o,a6 as _,u as R,L as z,e as de,p as h,ap as J,aq as K,d as ue,W as N,M as pe,R as ce,X as me,at as fe}from"./vue-11eabec3.js";import{_ as ge}from"./empty3-246c8c4c.js";import{p as _e}from"./plugHeader-c50619f4.js";import{P as he}from"./pagination-db6078c7.js";import{S as ve,C as be,b as ye}from"./createFile-3aa7f896.js";/* empty css                      */import"./index-971e6ee4.js";/* empty css                                                                   */const S={get(){return F({url:"/tools/ftp",method:"get",timeout:3*60*1e3,notice:!1})},set(u){return F({url:"/tools/ftp",method:"put",timeout:3*60*1e3,notice:!1,data:u})},status(u){return F({url:"/tools/ftp/status",method:"get",data:u})}},xe=u=>F({url:"/tools/ftp/user",method:"put",data:u}),ke=u=>F({url:"/tools/ftp/user",method:"delete",data:{ids:u}}),Ce=u=>F({url:"/tools/ftp/user",method:"get",params:u}),we={__name:"editCfg",setup(u,{expose:D,emit:y}){const v=C(),t=V({open:!1,port:21}),d=V({loading:!1,visible:!1,other:void 0}),p=Z(s=>{!s||s.validate((c,$)=>{c&&(d.loading=!0,S.set(t).then(()=>{var b;I({position:"bottom-right",type:"success",message:"FTP\u914D\u7F6E\u66F4\u65B0\u6210\u529F"}),y("load",(b=d.other)==null?void 0:b.id),i()}).finally(()=>{d.loading=!1}))})},300),i=()=>{var s;(s=v.value)==null||s.resetFields(),d.other=void 0,d.visible=!1},a={port:{required:!0,message:"\u8BF7\u8F93\u5165\u7AEF\u53E3\u53F7",trigger:"blur"}};D({open(){d.visible=!0,d.loading=!0,S.get().then(s=>{t.port=s.port,t.open=s.open}).finally(s=>{d.loading=!1})}});const r="\u4FEE\u6539FTP\u7AEF\u53E3";return(s,c)=>{const $=le,b=H,L=O,m=E,e=W,n=U;return x(),w("div",null,[l(e,{"model-value":d.visible,"show-close":!d.loading,"close-on-press-escape":!1,title:r,width:450,"z-index":20,"close-on-click-modal":!1,onClose:i},{footer:o(()=>[l(m,{class:"ml-auto",size:"small",loading:d.loading,onClick:i},{default:o(()=>[_(" \u53D6\u6D88 ")]),_:1},8,["loading"]),l(m,{size:"small",loading:d.loading,type:"primary",class:"border-0 bg-orange group-hover:bg-orangeLight",onClick:c[1]||(c[1]=g=>R(p)(v.value))},{default:o(()=>[_(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),default:o(()=>[z((x(),w("div",null,[l(L,{ref_key:"ruleFormRef",ref:v,"label-width":"80px",model:t,rules:a,"hide-required-asterisk":!1},{default:o(()=>[l(b,{label:"\u9ED8\u8BA4\u7AEF\u53E3",prop:"port",style:{"margin-bottom":"0"}},{default:o(()=>[l($,{spellcheck:"false",modelValue:t.port,"onUpdate:modelValue":c[0]||(c[0]=g=>t.port=g),modelModifiers:{number:!0},clearable:"",style:{width:"320px"},precision:0,min:1,max:65535,class:"section","step-strictly":"","value-on-clear":21,controls:!1,placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3\u53F7"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])),[[n,d.loading]])]),_:1},8,["model-value","show-close"])])}}};const Q=u=>(J("data-v-a9fd47ee"),u=u(),K(),u),Ve={class:"flex-x form-c"},$e=Q(()=>h("span",{style:{display:"inline-block",width:"16px"}},null,-1)),Fe={class:"flex-x form-c"},Se=Q(()=>h("span",{style:{display:"inline-block",width:"16px"}},null,-1)),De={class:"flex-x form-c"},Le={class:"flex-x form-c",style:{gap:"16px",width:"100%"}},Te={__name:"editor",emits:["load"],setup(u,{expose:D,emit:y}){G();const v=C(),t=V({visible:!1}),d=C(),p=C(),i=V({userName:"",password:"",rootDir:"",note:""}),a=V({loading:!1,visible:!1,other:void 0}),r=Z(m=>{!m||(S.set({open:!0}),m.validate(e=>{e&&(a.loading=!0,ye({path:i.rootDir},!0).then(()=>{xe({...i}).then(()=>{var n;I({position:"bottom-right",type:"success",message:(n=a.other)!=null&&n.id?"FTP\u66F4\u65B0\u6210\u529F":"FTP\u65B0\u589E\u6210\u529F"}),y("load"),s()}).finally(()=>{a.loading=!1})}).catch(()=>{a.loading=!1}))}))},500),s=()=>{var m;(m=d.value)==null||m.resetFields(),a.other=void 0,a.visible=!1},c=V({userName:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"},{min:3,max:15,message:"\u957F\u5EA6\u4E3A3\uFF5E15\u4E2A\u5B57\u7B26",trigger:"change"},{pattern:/^[A-Z|a-z][0-9|A-Z|a-z|_|-]*$/,message:"\u4EC5\u652F\u6301\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u5408,\u5E76\u4E14\u4EE5\u5B57\u6BCD\u5F00\u5934",trigger:"change"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"},{min:8,max:16,message:"\u6700\u5C0F\u957F\u5EA6\u4E3A8",trigger:"change"}],rootDir:{required:!0,message:"\u8BF7\u9009\u62E9\u5B58\u653E\u76EE\u5F55",trigger:"change"}});function $(m=8){for(var e=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9"],n="",g=0;g<m;g++)n+=e[Math.floor(Math.random()*e.length)];return console.log(n),n}function b(){}D({open(m){var e,n,g,P,k;a.visible=!0,a.other=m,i.userName=((e=a.other)==null?void 0:e.userName)||"",i.password=((n=a.other)==null?void 0:n.password)||"",i.rootDir=((g=a.other)==null?void 0:g.rootDir)||"",i.note=((P=a.other)==null?void 0:P.note)||"",i.id=(k=a.other)==null?void 0:k.id}});const L=de(()=>{var m;return(m=a.other)!=null&&m.id?"\u7F16\u8F91FTP":"\u65B0\u589EFTP"});return(m,e)=>{const n=te,g=H,P=O,k=E,M=W,ee=U;return x(),w("div",null,[l(M,{"model-value":a.visible,"show-close":!a.loading,"close-on-press-escape":!1,title:R(L),width:450,"z-index":20,"close-on-click-modal":!1,onClose:s,onOpened:b},{footer:o(()=>[l(k,{class:"ml-auto",size:"small",loading:a.loading,onClick:s},{default:o(()=>[_(" \u53D6\u6D88 ")]),_:1},8,["loading"]),l(k,{size:"small",loading:a.loading,type:"primary",class:"border-0 bg-orange group-hover:bg-orangeLight",onClick:e[7]||(e[7]=f=>R(r)(d.value))},{default:o(()=>[_(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),default:o(()=>[z((x(),w("div",null,[l(P,{ref_key:"ruleFormRef",ref:d,"label-width":"80px",model:i,rules:c,style:{"max-width":"460px"},"hide-required-asterisk":!1},{default:o(()=>[l(g,{label:"\u7528\u6237\u540D",prop:"userName"},{default:o(()=>[h("div",Ve,[l(n,{spellcheck:"false",modelValue:i.userName,"onUpdate:modelValue":e[0]||(e[0]=f=>i.userName=f),modelModifiers:{trim:!0},clearable:"",disabled:i.id,maxlength:"16",class:"input",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},null,8,["modelValue","disabled"]),$e])]),_:1}),l(g,{label:"\u5907\u6CE8",prop:"note"},{default:o(()=>[h("div",Fe,[l(n,{spellcheck:"false",modelValue:i.note,"onUpdate:modelValue":e[1]||(e[1]=f=>i.note=f),modelModifiers:{trim:!0},clearable:"",maxlength:"16",class:"input",placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"]),Se])]),_:1}),l(g,{label:"\u5BC6\u7801",prop:"password"},{default:o(()=>[h("div",De,[l(n,{spellcheck:"false",modelValue:i.password,"onUpdate:modelValue":e[2]||(e[2]=f=>i.password=f),modelModifiers:{trim:!0},clearable:"",maxlength:"16",class:"input",style:{flex:"1"},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"},null,8,["modelValue"]),h("i",{class:"iconfont icon-shuaxin1 point",style:{"line-height":"32px"},onClick:e[3]||(e[3]=f=>i.password=$())})])]),_:1}),l(g,{prop:"rootDir",label:"\u5B58\u653E\u76EE\u5F55"},{default:o(()=>[h("div",Le,[l(n,{spellcheck:"false",modelValue:i.rootDir,"onUpdate:modelValue":e[4]||(e[4]=f=>i.rootDir=f),modelModifiers:{trim:!0},clearable:"",style:{flex:"1"},class:"input",placeholder:"\u8BF7\u9009\u62E9\u5B58\u653E\u76EE\u5F55",onFocus:e[5]||(e[5]=f=>{t.visible=!0,p.value.path=i.rootDir||"",p.value.table.load()})},null,8,["modelValue"]),h("i",{class:"iconfont icon-wenjianjia point",style:{"line-height":"32px"},onClick:e[6]||(e[6]=f=>{t.visible=!0,p.value.path=i.rootDir||"",p.value.table.load()})})])]),_:1})]),_:1},8,["model","rules"])])),[[ee,a.loading]])]),_:1},8,["model-value","show-close","title"]),l(M,{modelValue:t.visible,"onUpdate:modelValue":e[11]||(e[11]=f=>t.visible=f),"close-on-press-escape":!1,"close-on-click-modal":!1,width:760,"z-index":25,"destroy-on-close":!0,title:"\u9009\u62E9\u5B58\u653E\u76EE\u5F55"},{footer:o(()=>{var f,T,q,A;return[l(k,{size:"small",loading:(f=p.value)==null?void 0:f.table.loading,type:"primary",class:"border-0 bg-orange group-hover:bg-orangeLight",style:{float:"left"},onClick:e[8]||(e[8]=B=>{var j;return(j=v.value)==null?void 0:j.open(p.value.path||p.value.root)})},{default:o(()=>[_(" \u65B0\u5EFA\u6587\u4EF6\u5939 ")]),_:1},8,["loading"]),l(k,{class:"ml-auto",size:"small",onClick:e[9]||(e[9]=B=>t.visible=!1)},{default:o(()=>[_(" \u53D6\u6D88 ")]),_:1}),l(k,{size:"small",loading:(T=p.value)==null?void 0:T.table.loading,type:"primary",disabled:((q=p.value)==null?void 0:q.path)==="/"&&((A=p.value)==null?void 0:A.pathSeparator)==="\\",class:"border-0 bg-orange group-hover:bg-orangeLight",onClick:e[10]||(e[10]=B=>{t.visible=!1,i.rootDir=p.value.path||p.value.root||"/"})},{default:o(()=>[_(" \u786E\u5B9A ")]),_:1},8,["loading","disabled"])]}),default:o(()=>{var f,T;return[l(ve,{ref_key:"tableRef",ref:p,onlyDir:!0},null,512),l(be,{ref_key:"createFileRef",ref:v,onlyDir:!0,list:((f=p.value)==null?void 0:f.table.data)||[],onLoad:(T=p.value)==null?void 0:T.table.load},null,8,["list","onLoad"])]}),_:1},8,["modelValue"])])}}},ze=X(Te,[["__scopeId","data-v-a9fd47ee"]]);const Y=u=>(J("data-v-d916601a"),u=u(),K(),u),Re={key:0,class:"box","element-loading-text":"FTP\u5B89\u88C5\u4E2D",style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center"}},Pe=Y(()=>h("img",{style:{margin:"36px auto",display:"block",height:"120px"},src:ge,alt:"",srcset:""},null,-1)),Ne={key:1,class:"flex-y box",style:{"padding-top":"24px"}},Ie={class:"flex-x-between"},Ee={class:"search",style:{"margin-bottom":"0"}},Ue=["onClick"],Me={key:1},qe=Y(()=>h("i",{class:"iconfont icon-fuzhi point",style:{"font-size":"12px","margin-left":"8px"}},null,-1)),Ae={__name:"index",setup(u){const D=fe();G();const y=C({pageIndex:1,pageSize:20,total:0}),v=C(),t=V({loading:!1,data:[],searchVal:{keywords:"",order:""},selectList:[],sloading:!1,async load(a){y.value=a||y.value,t.loading=!0;try{var r=await S.get()}catch(s){v.value=s.message,t.loading=!1,I({position:"bottom-right",type:"error",message:s.message})}if(y.value.pageIndex===1&&r.open===!1){const s=()=>{t.sloading=!0,S.status().then(c=>{c.Run=="installed"?(t.sloading=!1,v.value="",t.load()):setTimeout(()=>{s()},1e3)})};v.value="FTP\u5B89\u88C5\u4E2D",s(),await S.set({open:!0}).catch(c=>{c.statusCode===500&&(v.value=c.message)}).finally(()=>{t.loading=!1});return}Ce({page:y.value.pageIndex,limit:y.value.pageSize,...t.searchVal}).then(s=>{t.data=s.List,y.value.total=s.total}).catch(s=>{v.value=s.message}).finally(()=>{t.loading=!1})},handleSelectionChange(a){t.selectList=a},sortChnage({column:a,prop:r,order:s}){s?t.searchVal.order=`${r} ${s==="ascending"?"asc":"desc"}`:t.searchVal.order="",t.load()}}),d=C(),p=C(),i={statusChange(a,r){r.loading=!0,changeStatusApi([r.id],a).then(()=>{I({position:"bottom-right",type:"success",message:"\u72B6\u6001\u66F4\u65B0\u6210\u529F"})}).catch(()=>{r.status=a===1?2:1}).finally(()=>{r.loading=!1})},del:a=>oe({message:"\u786E\u5B9A\u8981\u5220\u9664\u6B64FTP\u5417\uFF1F",okEms:"FTP\u5220\u9664\u6210\u529F"},()=>ke(a).then(r=>(t.load(),r)))};return ue(()=>{t.load()}),(a,r)=>{const s=re,c=E,$=ae,b=ie,L=se,m=U;return v.value?z((x(),w("div",Re,[Pe,z(h("h3",null,N(v.value),513),[[pe,!t.sloading]]),l(s,{type:"primary",onClick:r[0]||(r[0]=e=>R(D).go(-1))},{default:o(()=>[_("\u8FD4\u56DE\u4E0A\u4E00\u7EA7")]),_:1})])),[[m,t.sloading]]):(x(),w("div",Ne,[l(_e,null,{default:o(()=>[_("FTP\u7BA1\u7406")]),_:1}),h("div",Ie,[h("div",null,[l(c,{type:"primary",onClick:r[1]||(r[1]=e=>{var n;return(n=d.value)==null?void 0:n.open({})})},{default:o(()=>[_(" \u65B0\u589EFTP ")]),_:1}),l(c,{class:"btn-style1",onClick:r[2]||(r[2]=e=>{var n;return(n=p.value)==null?void 0:n.open()})},{default:o(()=>[_(" \u4FEE\u6539FTP\u7AEF\u53E3 ")]),_:1}),l(c,{type:"danger",disabled:t.selectList.length<=0,onClick:r[3]||(r[3]=e=>i.del(t.selectList.map(n=>n.id)))},{default:o(()=>[_(" \u6279\u91CF\u5220\u9664 ")]),_:1},8,["disabled"])]),h("div",Ee,[l($,{style:{width:"180px"},modelValue:t.searchVal.keywords,"onUpdate:modelValue":r[4]||(r[4]=e=>t.searchVal.keywords=e),onBlur:r[5]||(r[5]=e=>{y.value.pageIndex=1,t.load()})},null,8,["modelValue"])])]),z((x(),ce(L,{data:t.data,class:"auto",stripe:!0,onSortChange:t.sortChnage,onSelectionChange:t.handleSelectionChange},{default:o(()=>[l(b,{type:"selection",width:"35"}),l(b,{prop:"userName",label:"\u7528\u6237\u540D","min-width":"100"},{default:o(({row:e,store:n})=>[e.userName?(x(),w("span",{key:0,onClick:g=>n.toggleRowSelection(e,void 0)},N(e.userName),9,Ue)):(x(),w("span",Me," - "))]),_:1}),l(b,{prop:"password",label:"\u5BC6\u7801",width:"150"},{default:o(({row:e})=>[l(c,{type:"primary",link:"",onClick:n=>R(ne)(e.password)},{default:o(()=>[_(N(e.password)+" ",1),qe]),_:2},1032,["onClick"])]),_:1}),l(b,{prop:"rootDir","show-overflow-tooltip":!0,label:"\u6839\u76EE\u5F55","min-width":"250"}),l(b,{prop:"note",label:"\u5907\u6CE8","show-overflow-tooltip":!0,"min-width":"130"}),l(b,{prop:"status","show-overflow-tooltip":!0,label:"\u68C0\u6D4B\u72B6\u6001","min-width":"250"},{default:o(({row:e})=>[h("span",{style:me("color:"+(e.status==="\u6B63\u5E38"?"#4B82FA":"#f56c6c"))},N(e.status),5)]),_:1}),l(b,{fixed:"right",label:"\u64CD\u4F5C",align:"right","min-width":"110"},{default:o(({row:e})=>[l(c,{type:"primary",link:"",onClick:n=>{var g;return(g=d.value)==null?void 0:g.open(e)}},{default:o(()=>[_(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),l(c,{type:"danger",link:"",onClick:n=>i.del([e.id])},{default:o(()=>[_(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSortChange","onSelectionChange"])),[[m,t.loading]]),l(he,{pageinfo:y.value,onChange:t.load},null,8,["pageinfo","onChange"]),l(ze,{ref_key:"editorRef",ref:d,onLoad:t.load},null,8,["onLoad"]),l(we,{ref_key:"editCfgRef",ref:p},null,512)]))}}},Ye=X(Ae,[["__scopeId","data-v-d916601a"]]);export{Ye as default};
