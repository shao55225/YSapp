import{R as A,u as q,E as z,b as Y,c as ee,d as R,f as j,g as le,h as O,i as te,j as M,k as ue,v as P,_ as T,o as ae,C as oe,m as se}from"./entry-9cc5c370.js";/* empty css                        */import{p as ne}from"./plugHeader-c50619f4.js";import{f as ie}from"./filter-808d0c52.js";import{P as de}from"./pagination-db6078c7.js";import{G,Z as v,a as w,z as re,e as pe,m as g,U as l,S as o,u as S,l as p,a6 as F,L as H,P as L,af as N,R as k,O as ce,d as me,p as C,W as I,ap as _e,aq as ge}from"./vue-11eabec3.js";/* empty css                   *//* empty css                                                               */import"./index-bf5a11eb.js";/* empty css                      */import"./index-971e6ee4.js";/* empty css                                                                   */const fe=(r={page:0})=>A({url:"/links/page",method:"get",params:r}),he=r=>A({url:"/links/"+r,method:"delete"}),Ee=r=>A({url:"/links",method:"post",data:r}),W=r=>A({url:"/links/"+r.id,method:"put",data:r}),ve=G({__name:"editor",emits:["load"],setup(r,{expose:B,emit:y}){const c=q(),n=v(["\u5934\u90E8\u83DC\u5355","\u5E95\u90E8\u83DC\u5355","\u53CB\u60C5\u94FE\u63A5"]),e=v({groupName:"",link:"",name:"",sort:1,state:1,id:0,bold:!0,color:"",isAllSite:1}),E=w(),u=v({loading:!1,visible:!1,other:{}}),i=re("debounce")(_=>{!_||_.validate(a=>{a&&(u.loading=!0,e.link&&(e.link=e.link.includes("http")?e.link:"http://"+e.link),(e.id?W(e):Ee(e)).then(()=>{z.success({message:u.other.id?"\u94FE\u63A5\u66F4\u65B0\u6210\u529F":"\u94FE\u63A5\u65B0\u589E\u6210\u529F",showClose:!0,position:"bottom-right"}),y("load"),b()}).finally(()=>{u.loading=!1}))})},300),f=v({name:{required:!0,message:"\u8BF7\u8F93\u5165\u94FE\u63A5\u540D\u79F0",trigger:"blur"},groupName:{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7EC4",trigger:"blur"},link:{required:!0,message:"\u8BF7\u8F93\u5165\u94FE\u63A5",trigger:"blur"},sort:{required:!0,message:"\u8BF7\u8F93\u5165\u5E8F\u53F7",trigger:"blur"},siteIds:{required:!0,message:"\u8BF7\u9009\u62E9\u7AD9\u70B9",trigger:"change"}}),x=()=>{e.sort==null&&(e.sort=1)},b=()=>{u.other={},u.visible=!1};function m(){var _,a;Object.keys(e).forEach(t=>{e[t]=u.other[t]}),e.id=(_=u.other)==null?void 0:_.id,e.sort==null&&(e.sort=1),e.state==null&&(e.state=1),(a=u.other)!=null&&a.id||(e.isAllSite=1),e.id?e.siteIds=u.other.sites.map(t=>t.id)||"":c.siteVal>0&&(e.siteIds=[c.siteVal])}B({open(_){var a;(a=E.value)==null||a.resetFields(),u.visible=!0,u.other=_}});const D=pe(()=>u.other.id?"\u7F16\u8F91\u94FE\u63A5":"\u65B0\u589E\u94FE\u63A5");return(_,a)=>{const t=Y,d=ee,h=R,V=j,Z=le,U=O,J=te,$=M,K=ue,Q=P;return p(),g("div",null,[l(K,{"model-value":u.visible,"show-close":!u.loading,"close-on-press-escape":!1,title:S(D),width:444,"z-index":20,"close-on-click-modal":!1,onClose:b,onOpened:m},{footer:o(()=>[l($,{class:"ml-auto",size:"small",loading:u.loading,onClick:b},{default:o(()=>[F(" \u53D6\u6D88 ")]),_:1},8,["loading"]),l($,{size:"small",loading:u.loading,type:"primary",class:"border-0 bg-orange group-hover:bg-orangeLight",onClick:a[8]||(a[8]=s=>S(i)(E.value))},{default:o(()=>[F(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),default:o(()=>[H((p(),g("div",null,[l(J,{ref_key:"ruleFormRef",ref:E,"label-width":"80px",model:e,rules:f,style:{"max-width":"460px"},"hide-required-asterisk":!1},{default:o(()=>[l(d,{label:"\u540D\u79F0",prop:"name"},{default:o(()=>[l(t,{spellcheck:"false",modelValue:e.name,"onUpdate:modelValue":a[0]||(a[0]=s=>e.name=s),modelModifiers:{trim:!0},clearable:"",class:"input",placeholder:"\u8BF7\u8F93\u5165\u94FE\u63A5\u540D\u79F0"},null,8,["modelValue"])]),_:1}),l(d,{prop:"groupName",label:"\u5206\u7EC4",clearable:"",class:"group"},{default:o(()=>[l(V,{modelValue:e.groupName,"onUpdate:modelValue":a[1]||(a[1]=s=>e.groupName=s),placeholder:"\u8BF7\u9009\u62E9\u5206\u7EC4"},{default:o(()=>[(p(!0),g(L,null,N(n,(s,X)=>(p(),k(h,{key:X,value:s,label:s},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{prop:"link",label:"\u94FE\u63A5",clearable:""},{default:o(()=>[l(t,{spellcheck:"false",modelValue:e.link,"onUpdate:modelValue":a[2]||(a[2]=s=>e.link=s),class:"input",placeholder:"\u8BF7\u8F93\u5165\u94FE\u63A5"},null,8,["modelValue"])]),_:1}),l(d,{label:"\u987A\u5E8F",prop:"sort",clearable:""},{default:o(()=>[l(Z,{spellcheck:"false",modelValue:e.sort,"onUpdate:modelValue":a[3]||(a[3]=s=>e.sort=s),modelModifiers:{number:!0},clearable:"",class:"input xuhao w-full",placeholder:"\u9ED8\u8BA41","controls-position":"right",min:1,precision:0,"value-on-clear":1,"step-strictly":"",onBlur:a[4]||(a[4]=s=>x())},null,8,["modelValue"])]),_:1}),l(d,{label:"\u72B6\u6001",prop:"state"},{default:o(()=>[l(U,{modelValue:e.state,"onUpdate:modelValue":a[5]||(a[5]=s=>e.state=s),"active-value":1,"inactive-value":2},null,8,["modelValue"])]),_:1}),l(d,{label:"\u5E94\u7528\u5168\u7AD9",prop:"isAllSite"},{default:o(()=>[l(U,{modelValue:e.isAllSite,"onUpdate:modelValue":a[6]||(a[6]=s=>e.isAllSite=s),"active-value":1,"inactive-value":2},null,8,["modelValue"])]),_:1}),e.isAllSite==2?(p(),k(d,{key:0,label:"\u7AD9\u70B9\u540D\u79F0",prop:"siteIds"},{default:o(()=>[l(V,{modelValue:e.siteIds,"onUpdate:modelValue":a[7]||(a[7]=s=>e.siteIds=s),class:"input",multiple:"",placeholder:"\u9009\u62E9\u7AD9\u70B9",style:{width:"334px"}},{default:o(()=>[(p(!0),g(L,null,N(S(c).list,s=>(p(),k(h,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):ce("",!0)]),_:1},8,["model","rules"])])),[[Q,u.loading]])]),_:1},8,["model-value","show-close","title"])])}}});const Fe=T(ve,[["__scopeId","data-v-2a0c6da6"]]),be=r=>(_e("data-v-68ca3976"),r=r(),ge(),r),Ce={class:"flex-y box",style:{"padding-top":"24px"}},ke={class:"pop-box"},Ve={class:"pop_item"},Ae=be(()=>C("span",{class:"p"},"\u5206\u7EC4",-1)),Be=["title"],ye=["title"],xe={key:0},De={key:1},Se={key:2},Ie=G({__name:"index",setup(r){const B=q(),y=v([["","\u6240\u6709\u5206\u7EC4"],["\u5934\u90E8\u83DC\u5355","\u5934\u90E8\u83DC\u5355"],["\u5E95\u90E8\u83DC\u5355","\u5E95\u90E8\u83DC\u5355"],["\u53CB\u60C5\u94FE\u63A5","\u53CB\u60C5\u94FE\u63A5"]]),c=w({pageIndex:1,pageSize:20,total:0}),n=v({loading:!1,data:[],searchVal:{keywords:"",order:""},selectList:[],load(u){c.value=u||c.value,n.loading=!0,fe({page:c.value.pageIndex,limit:c.value.pageSize,siteId:B.siteVal,...n.searchVal}).then(i=>{n.data=i.list,c.value.total=i.total}).finally(()=>{n.loading=!1})},handleSelectionChange(u){this.selectList=u},sortChnage({column:u,prop:i,order:f}){f?n.searchVal.order=`${i} ${f==="ascending"?"asc":"desc"}`:n.searchVal.order="",n.load()}}),e=w(),E={statusChange(u,i){i.loading=!0,W(i).catch(()=>{i.state=u===1?2:1}).then(()=>{z({position:"bottom-right",type:"success",message:"\u72B6\u6001\u66F4\u65B0\u6210\u529F"})}).catch(()=>{i.state=u===1?2:1}).finally(()=>{i.loading=!1})},del:u=>oe({message:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F\u5220\u9664\u540E\u94FE\u63A5\u5C06\u4E0D\u518D\u663E\u793A",okEms:"\u94FE\u63A5\u5220\u9664\u6210\u529F"},()=>he([u.id]).then(i=>(n.load(),i)))};return me(()=>{n.load()}),(u,i)=>{const f=M,x=R,b=j,m=se,D=O,_=ae,a=P;return p(),g("div",Ce,[l(ne,null,{default:o(()=>[F("\u53CB\u60C5\u94FE\u63A5")]),_:1}),l(ie,{popover:"",placement:"bottom-start",onLoad:n.load},{prefix:o(()=>[l(f,{type:"primary",onClick:i[0]||(i[0]=t=>{var d;return(d=e.value)==null?void 0:d.open({})})},{default:o(()=>[F(" \u65B0\u589E\u94FE\u63A5 ")]),_:1})]),prepend:o(()=>[C("div",ke,[C("div",Ve,[Ae,l(b,{modelValue:n.searchVal.keywords,"onUpdate:modelValue":i[1]||(i[1]=t=>n.searchVal.keywords=t),class:"m-2",placeholder:"\u6240\u6709\u5206\u7EC4",clearable:"",onChange:i[2]||(i[2]=t=>{c.value.pageIndex=1,n.load()})},{default:o(()=>[(p(!0),g(L,null,N(y,(t,d)=>(p(),k(x,{key:d,label:t[1],value:t[0]},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),suffix:o(()=>[]),_:1},8,["onLoad"]),H((p(),k(_,{data:n.data,class:"auto",stripe:!0,onSortChange:n.sortChnage,onSelectionChange:n.handleSelectionChange},{default:o(()=>[l(m,{type:"index",label:"\u5E8F\u53F7",width:"100"}),l(m,{prop:"name",label:"\u540D\u79F0","min-width":"160"},{default:o(({row:t})=>[C("div",{class:"index",title:t.name},I(t.name),9,Be)]),_:1}),l(m,{prop:"link",label:"\u94FE\u63A5","min-width":"180"},{default:o(({row:t})=>[C("div",{class:"index",title:t.link},I(t.link),9,ye)]),_:1}),l(m,{prop:"groupName",label:"\u5206\u7EC4","min-width":"170"}),l(m,{prop:"state",label:"\u72B6\u6001","min-width":"170"},{default:o(({row:t})=>[l(D,{modelValue:t.state,"onUpdate:modelValue":d=>t.state=d,"active-value":1,loading:t.loading,"inactive-value":2,onChange:d=>E.statusChange(d,t)},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]),_:1}),l(m,{label:"\u6240\u5C5E\u7AD9\u70B9","min-width":"95"},{default:o(({row:t})=>{var d,h;return[t.isAllSite==1?(p(),g("span",xe,"\u6240\u6709\u7AD9\u70B9")):((d=t.sites)==null?void 0:d.length)==0?(p(),g("span",De,"\u9ED8\u8BA4\u7AD9\u70B9")):(p(),g("span",Se,I(((h=t.sites)==null?void 0:h.map(V=>V.name).join("\uFF0C"))||"-"),1))]}),_:1}),l(m,{prop:"sort",label:"\u663E\u793A\u987A\u5E8F","min-width":"150"}),l(m,{prop:"updateAt",label:"\u66F4\u65B0\u65F6\u95F4",width:"150",sortable:"",type:"date"}),l(m,{fixed:"right",label:"\u64CD\u4F5C","min-width":"110",align:"right"},{default:o(({row:t})=>[l(f,{type:"primary",link:"",onClick:d=>{var h;return(h=e.value)==null?void 0:h.open(t)}},{default:o(()=>[F(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),l(f,{type:"danger",link:"",class:"text-dangerColor",onClick:d=>E.del(t)},{default:o(()=>[F(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSortChange","onSelectionChange"])),[[a,n.loading]]),l(de,{pageinfo:c.value,onChange:n.load},null,8,["pageinfo","onChange"]),l(Fe,{ref_key:"editorRef",ref:e,onLoad:n.load},null,8,["onLoad"])])}}});const Te=T(Ie,[["__scopeId","data-v-68ca3976"]]);export{Te as default};
