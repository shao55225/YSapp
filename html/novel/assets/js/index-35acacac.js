import{r as D,h as H,a as J,b as W,d as X,c as N,f as Z,v as I,_ as L,j as ee,l as le}from"./entry-5490c999.js";import"./el-table-column-a25f0439.js";import{E as T}from"./el-switch-dc732e6b.js";import{E as te,a as ue,P as ae}from"./pagination-5ca1e60a.js";import{F as q,Y as h,b as x,y as oe,i as se,c as m,T as l,R as o,u as w,ak as U,o as d,a5 as v,K as $,O as R,ac as ne,Q as z,h as ie,a as C,V as A}from"./vue-5906fc2c.js";import{E as re}from"./el-input-number-860f564c.js";const de=(_={page:0})=>D({url:"/links/page",method:"get",prefix:!0,params:_}),ce=_=>D({url:"/links",method:"post",prefix:!0,data:_}),pe=_=>D({url:"/links/"+_.id,method:"put",prefix:!0,data:_}),me=q({__name:"editor",emits:["load"],setup(_,{expose:k,emit:g}){const s={siteVal:Number(sessionStorage.getItem("site"))},E=U(),r=h(["\u5934\u90E8\u83DC\u5355","\u5E95\u90E8\u83DC\u5355","\u53CB\u60C5\u94FE\u63A5"]),e=h({groupName:"",link:"",name:"",sort:1,state:1,id:0,bold:!0,color:"",isAllSite:2}),c=x(),t=h({loading:!1,visible:!1,other:{}}),y=oe("debounce")(i=>{!i||i.validate(a=>{a&&(t.loading=!0,e.link&&(e.link=e.link.includes("http")?e.link:"http://"+e.link),(e.id?pe(e):ce(e)).then(()=>{H.success({message:t.other.id?"\u94FE\u63A5\u66F4\u65B0\u6210\u529F":"\u94FE\u63A5\u65B0\u589E\u6210\u529F",showClose:!0,position:"bottom-right"}),g("load"),u()}).finally(()=>{t.loading=!1}))})},300),V=h({name:{required:!0,message:"\u8BF7\u8F93\u5165\u94FE\u63A5\u540D\u79F0",trigger:"blur"},groupName:{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7EC4",trigger:"blur"},link:{required:!0,message:"\u8BF7\u8F93\u5165\u94FE\u63A5",trigger:"blur"},sort:{required:!0,message:"\u8BF7\u8F93\u5165\u5E8F\u53F7",trigger:"blur"},siteIds:{required:!0,message:"\u8BF7\u9009\u62E9\u7AD9\u70B9",trigger:"change"}}),B=()=>{e.sort==null&&(e.sort=1)},u=()=>{t.other={},t.visible=!1};function p(){var a;e.id=(a=t.other)==null?void 0:a.id,Object.keys(e).forEach(F=>{e[F]=t.other[F]});const i=E.meta.linkType;i===1?e.groupName="\u5934\u90E8\u83DC\u5355":i===2?e.groupName="\u5E95\u90E8\u83DC\u5355":i===3&&(e.groupName="\u53CB\u60C5\u94FE\u63A5"),e.isAllSite=2,e.sort==null&&(e.sort=1),e.state==null&&(e.state=1),e.siteIds=[s.siteVal]}k({open(i){var a;(a=c.value)==null||a.resetFields(),t.visible=!0,t.other=i,console.log(i)}});const f=se(()=>t.other.id?"\u7F16\u8F91\u94FE\u63A5":"\u65B0\u589E\u94FE\u63A5");return(i,a)=>{const F=J,b=W,j=te,O=ue,M=re,P=T,K=X,S=N,Q=Z,Y=I;return d(),m("div",null,[l(Q,{"model-value":t.visible,"show-close":!t.loading,"close-on-press-escape":!1,title:w(f),width:444,"z-index":20,"close-on-click-modal":!1,onClose:u,onOpened:p},{footer:o(()=>[l(S,{class:"ml-auto",size:"small",loading:t.loading,onClick:u},{default:o(()=>[v(" \u53D6\u6D88 ")]),_:1},8,["loading"]),l(S,{size:"small",loading:t.loading,type:"primary",class:"border-0 bg-orange group-hover:bg-orangeLight",onClick:a[6]||(a[6]=n=>w(y)(c.value))},{default:o(()=>[v(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),default:o(()=>[$((d(),m("div",null,[l(K,{ref_key:"ruleFormRef",ref:c,"label-width":"80px",model:e,rules:V,style:{"max-width":"460px"},"hide-required-asterisk":!1},{default:o(()=>[l(b,{label:"\u540D\u79F0",prop:"name"},{default:o(()=>[l(F,{spellcheck:"false",modelValue:e.name,"onUpdate:modelValue":a[0]||(a[0]=n=>e.name=n),modelModifiers:{trim:!0},clearable:"",class:"input",placeholder:"\u8BF7\u8F93\u5165\u94FE\u63A5\u540D\u79F0"},null,8,["modelValue"])]),_:1}),l(b,{prop:"groupName",label:"\u5206\u7EC4",clearable:"",class:"group"},{default:o(()=>[l(O,{modelValue:e.groupName,"onUpdate:modelValue":a[1]||(a[1]=n=>e.groupName=n),placeholder:"\u8BF7\u9009\u62E9\u5206\u7EC4"},{default:o(()=>[(d(!0),m(R,null,ne(r,(n,G)=>(d(),z(j,{key:G,value:n,label:n},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{prop:"link",label:"\u94FE\u63A5",clearable:""},{default:o(()=>[l(F,{spellcheck:"false",modelValue:e.link,"onUpdate:modelValue":a[2]||(a[2]=n=>e.link=n),class:"input",placeholder:"\u8BF7\u8F93\u5165\u94FE\u63A5"},null,8,["modelValue"])]),_:1}),l(b,{label:"\u987A\u5E8F",prop:"sort",clearable:""},{default:o(()=>[l(M,{spellcheck:"false",modelValue:e.sort,"onUpdate:modelValue":a[3]||(a[3]=n=>e.sort=n),modelModifiers:{number:!0},clearable:"",class:"input xuhao w-full",placeholder:"\u9ED8\u8BA41","controls-position":"right",min:1,precision:0,"value-on-clear":1,"step-strictly":"",onBlur:a[4]||(a[4]=n=>B())},null,8,["modelValue"])]),_:1}),l(b,{label:"\u72B6\u6001",prop:"state"},{default:o(()=>[l(P,{modelValue:e.state,"onUpdate:modelValue":a[5]||(a[5]=n=>e.state=n),"active-value":1,"inactive-value":2},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])),[[Y,t.loading]])]),_:1},8,["model-value","show-close","title"])])}}});const _e=L(me,[["__scopeId","data-v-02acdae6"]]),ge={class:"flex-y box"},fe={class:"flex-x-between search"},he=["title"],Ee=["title"],Fe={key:0},be={key:1},ve={key:2},Ce={key:0},ke=q({__name:"index",setup(_){const k=U();h([["","\u6240\u6709\u5206\u7EC4"],["\u5934\u90E8\u83DC\u5355","\u5934\u90E8\u83DC\u5355"],["\u5E95\u90E8\u83DC\u5355","\u5E95\u90E8\u83DC\u5355"],["\u53CB\u60C5\u94FE\u63A5","\u53CB\u60C5\u94FE\u63A5"]]);const g=x({pageIndex:1,pageSize:20,total:0}),s=h({loading:!1,data:[],searchVal:{keywords:"",order:""},selectList:[],load(r){g.value=r||g.value,s.loading=!0,de({page:g.value.pageIndex,limit:g.value.pageSize,siteId:Number(sessionStorage.getItem("site")),...s.searchVal}).then(e=>{s.data=e.list,g.value.total=e.total}).finally(()=>{s.loading=!1})},handleSelectionChange(r){this.selectList=r},sortChnage({column:r,prop:e,order:c}){c?s.searchVal.order=`${e} ${c==="ascending"?"asc":"desc"}`:s.searchVal.order="",s.load()}}),E=x();return ie(()=>{const r=k.meta.linkType;r===1?s.searchVal.keywords="\u5934\u90E8\u83DC\u5355":r===2?s.searchVal.keywords="\u5E95\u90E8\u83DC\u5355":r===3&&(s.searchVal.keywords="\u53CB\u60C5\u94FE\u63A5"),s.load()}),(r,e)=>{const c=N,t=le,y=T,V=ee,B=I;return d(),m("div",ge,[C("div",fe,[C("div",null,[l(c,{type:"primary",onClick:e[0]||(e[0]=u=>{var p;return(p=E.value)==null?void 0:p.open({})})},{default:o(()=>[v(" \u65B0\u589E\u94FE\u63A5 ")]),_:1})])]),$((d(),z(V,{data:s.data,class:"auto",stripe:!0,onSortChange:s.sortChnage,onSelectionChange:s.handleSelectionChange},{default:o(()=>[l(t,{type:"index",label:"\u5E8F\u53F7",width:"100"}),l(t,{prop:"name",label:"\u540D\u79F0","min-width":"160"},{default:o(({row:u})=>[C("div",{class:"index",title:u.name},A(u.name),9,he)]),_:1}),l(t,{prop:"link",label:"\u94FE\u63A5","min-width":"180"},{default:o(({row:u})=>[C("div",{class:"index",title:u.link},A(u.link),9,Ee)]),_:1}),l(t,{prop:"groupName",label:"\u5206\u7EC4","min-width":"170"}),l(t,{prop:"state",label:"\u72B6\u6001","min-width":"170"},{default:o(({row:u})=>[l(y,{modelValue:u.state,"onUpdate:modelValue":p=>u.state=p,"active-value":1,loading:u.loading,"inactive-value":2,disabled:u.sites.length>1||u.isAllSite===1},null,8,["modelValue","onUpdate:modelValue","loading","disabled"])]),_:1}),l(t,{label:"\u6240\u5C5E\u7AD9\u70B9","min-width":"95"},{default:o(({row:u})=>{var p,f;return[u.isAllSite==1?(d(),m("span",Fe,"\u6240\u6709\u7AD9\u70B9")):((p=u.sites)==null?void 0:p.length)==0?(d(),m("span",be,"\u9ED8\u8BA4\u7AD9\u70B9")):(d(),m("span",ve,A(((f=u.sites)==null?void 0:f.map(i=>i.name).join("\uFF0C"))||"-"),1))]}),_:1}),l(t,{prop:"sort",label:"\u663E\u793A\u987A\u5E8F","min-width":"150"}),l(t,{prop:"updateAt",label:"\u66F4\u65B0\u65F6\u95F4",width:"150",sortable:"",type:"date"}),l(t,{fixed:"right",label:"\u64CD\u4F5C","min-width":"110",align:"right"},{default:o(({row:u})=>[u.sites.length>1||u.isAllSite===1?(d(),m("span",Ce,"-")):(d(),m(R,{key:1},[l(c,{type:"primary",link:"",onClick:p=>{var f;return(f=E.value)==null?void 0:f.open(u)}},{default:o(()=>[v(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),l(c,{type:"danger",link:"",class:"text-dangerColor"},{default:o(()=>[v(" \u5220\u9664 ")]),_:1})],64))]),_:1})]),_:1},8,["data","onSortChange","onSelectionChange"])),[[B,s.loading]]),l(ae,{pageinfo:g.value,onChange:s.load},null,8,["pageinfo","onChange"]),l(_e,{ref_key:"editorRef",ref:E,onLoad:s.load},null,8,["onLoad"])])}}});const Se=L(ke,[["__scopeId","data-v-094c224f"]]);export{Se as default};
