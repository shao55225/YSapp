import{r as D,b as M,d as R,c as A,f as z,_ as $,h as U,a as Q,v as N,i as X,j as W,k as Z,l as ee}from"./entry-5490c999.js";import"./el-table-column-a25f0439.js";import{E as le,a as te,b as ae,P as oe}from"./pagination-5ca1e60a.js";import{E as T}from"./el-date-picker-72643638.js";import{_ as L,a as ue,g as ne,E as se,b as de,c as re}from"./videoStar-ea710fef.js";import{m as Y}from"./message-26acb8b6.js";import{Y as x,b as k,Q as w,R as u,u as t,o as E,T as l,a5 as f,a as B,F as q,c as I,ac as ie,O as ce,ah as pe,y as me,i as ge,K as j,h as _e,am as fe,an as he,V as S,ad as ve}from"./vue-5906fc2c.js";/* empty css                       */import{E as ye}from"./el-progress-37d8b86e.js";const be=p=>D({url:"/novel/page",method:"get",prefix:!0,params:p}),Fe=p=>D({url:"/novel",method:"post",prefix:!0,data:p}),Ce=p=>D({url:"/novel",method:"put",prefix:!0,data:p}),Ee=p=>D({url:"/novel/"+p,method:"get",prefix:!0}),Be=p=>D({url:"/novel",method:"delete",prefix:!0,data:{ids:p}}),Ve={style:{display:"flex","align-items":"center",gap:"8px",width:"100%"}},ke={__name:"allDel",emits:["load"],setup(p,{expose:_,emit:s}){const m=x({loading:!1,visible:!1,other:void 0}),y=k(),e=x({categoryId:[],collectionId:[],updateAtEnd:"",updateAtStart:"",tags:[]});k([]),k([]);const n=v=>{if(e.updateAtEnd)return v.getTime()>e.updateAtEnd.getTime()},i=v=>v.getTime()<new Date(e.updateAtStart).getTime(),g=()=>Y({message:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",okEms:"\u56FE\u6587\u6570\u636E\u5220\u9664\u6210\u529F"},()=>y.value.validate((v,b)=>{var r;v&&(m.loading=!0,ue({collectionId:e.collectionId,updateAtStart:e.updateAtStart||void 0,updateAtEnd:e.updateAtEnd||void 0,categoryId:(r=e.categoryId)==null?void 0:r.map(o=>o.at(-1)),tags:e.tags||[]}).then(o=>{m.visible=!1}).finally(()=>{m.loading=!1}))})),C=()=>{var v;m.visible=!1,(v=y.value)==null||v.resetFields(),e.updateAtStart="",e.updateAtEnd="",e.tags=[],s("load")},h=()=>{};return _({open(v){m.visible=!0}}),(v,b)=>{const r=M,o=T,a=R,d=A,V=z;return E(),w(V,{"model-value":t(m).visible,"show-close":!t(m).loading,"close-on-press-escape":!1,title:"\u4E00\u952E\u5220\u9664",width:550,"z-index":20,top:"25vh","close-on-click-modal":!1,onClose:C,onOpened:h},{footer:u(()=>[l(d,{class:"ml-auto",size:"small",loading:t(m).loading,onClick:C},{default:u(()=>[f(" \u53D6\u6D88 ")]),_:1},8,["loading"]),l(d,{class:"ml-auto",size:"small",type:"primary",loading:t(m).loading,onClick:b[3]||(b[3]=F=>g())},{default:u(()=>[f(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),default:u(()=>[l(a,{ref_key:"ruleFormRef",ref:y,"label-width":"80px",model:t(e),rules:{},"hide-required-asterisk":!1},{default:u(()=>[l(r,{label:"\u56FE\u6587\u5206\u7C7B",prop:"categoryId"},{default:u(()=>[l(L,{modelValue:t(e).categoryId,"onUpdate:modelValue":b[0]||(b[0]=F=>t(e).categoryId=F),style:{width:"100%"},type:"article",placeholder:"\u9ED8\u8BA4\u5168\u90E8\u5206\u7C7B",checkStrictly:!0,props:{checkStrictly:!1,multiple:!0,emitPath:!0}},null,8,["modelValue"])]),_:1}),l(r,{label:"\u66F4\u65B0\u65F6\u95F4",prop:["updateAtStart","updateAtEnd"]},{default:u(()=>[B("div",Ve,[l(o,{modelValue:t(e).updateAtStart,"onUpdate:modelValue":b[1]||(b[1]=F=>t(e).updateAtStart=F),type:"datetime",placeholder:"\u5F00\u59CB\u65E5\u671F",style:{flex:"1 1"},"disabled-date":n,format:"YYYY/MM/DD HH:mm:ss",clearable:!1},null,8,["modelValue"]),f(" ~ "),l(o,{modelValue:t(e).updateAtEnd,"onUpdate:modelValue":b[2]||(b[2]=F=>t(e).updateAtEnd=F),type:"datetime",style:{flex:"1 1"},"disabled-date":i,placeholder:"\u7ED3\u675F\u65E5\u671F",format:"YYYY/MM/DD HH:mm:ss",clearable:!1},null,8,["modelValue"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","show-close"])}}},xe=ke,we=q({__name:"tagInput",props:{modelValue:{type:Array,required:!0}},emits:["update:model-value"],setup(p,{emit:_}){const s=p;function m(e){if(!s.modelValue)return;const n=e.target.value;e.target.value="",!(s.modelValue.includes(n)||!n)&&_("update:model-value",[...s.modelValue,n])}function y(e){_("update:model-value",e)}return(e,n)=>{const i=le,g=te;return E(),w(g,{"model-value":p.modelValue,multiple:"",filterable:"","allow-create":"","reserve-keyword":!1,"default-first-option":!1,"popper-class":"customer-tag-input",onKeyup:pe(m,["enter"]),onBlur:m,"onUpdate:modelValue":y,placeholder:"\u8BF7\u8F93\u5165"},{default:u(()=>[(E(!0),I(ce,null,ie(p.modelValue,C=>(E(),w(i,{key:C,label:C,value:C},null,8,["label","value"]))),128))]),_:1},8,["model-value","onKeyup"])}}});const Ie=$(we,[["__scopeId","data-v-7ea40acc"]]),De={class:"hhhh"},Se={class:"flex-x-between"},Ae={class:"block"},$e={class:"block"},Le={style:{display:"flex","align-items":"center",width:"100%",gap:"12px"}},qe=q({__name:"editor",emits:["load"],setup(p,{expose:_,emit:s}){const m=x({loading:!1,list:[],fn(r){m.loading=!0,re({keywords:r}).then(o=>{console.log(o,"===="),m.list=o.list}).finally(()=>{m.loading=!1})}}),y=k(),e=x({id:0,name:"",intro:"",labels:null,categoryPid:0,categoryChildId:0,isEnd:2,cover:"",author:"",status:1,siteId:Number(sessionStorage.getItem("site")),releaseDate:null}),n=x({loading:!1,visible:!1,other:void 0}),i=me("debounce")(r=>{!r||r.validate(o=>{o&&(n.loading=!0,Array.isArray(e.labels)&&e.labels.length==0&&(e.labels=null),(e.id?Ce(e):Fe(e)).then(()=>{var a;U({position:"bottom-right",type:"success",message:(a=n.other)!=null&&a.id?"\u5C0F\u8BF4\u66F4\u65B0\u6210\u529F":"\u5C0F\u8BF4\u65B0\u589E\u6210\u529F"}),s("load"),g()}).finally(()=>{n.loading=!1}))})},300),g=()=>{n.other=void 0,n.visible=!1,e.categoryPid=0,e.categoryChildId=0,m.list=[]},C={name:{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898",trigger:"blur"},categoryPid:{required:!0,validator:(r,o,a)=>e.categoryPid||e.categoryChildId?a():a(new Error("\u8BF7\u9009\u62E9\u7C7B\u578B")),trigger:"blur"},surfacePlot:{required:!1,message:"\u8BF7\u8F93\u5165\u5C01\u9762\u5730\u5740",trigger:"blur"},author:{required:!0,message:"\u8BF7\u8F93\u5165\u4F5C\u8005",trigger:"blur"},releaseDate:{required:!0,message:"\u8BF7\u9009\u62E9\u53D1\u5E03\u65F6\u95F4",trigger:"blur"},cover:{required:!0,message:"\u8BF7\u8F93\u5165\u5C01\u9762\u5730\u5740",trigger:"blur"},intro:{required:!0,message:"\u8BF7\u8F93\u5165\u7B80\u4ECB",trigger:"blur"},labels:{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u7B7E",trigger:"blur"}},h=k([]);ne({limit:9999}).then(r=>{h.value=r.list});function v(){var r,o;(r=n.other)!=null&&r.id?(n.loading=!0,Ee((o=n.other)==null?void 0:o.id).then(a=>{n.loading=!1,Object.keys(e).forEach(d=>{e[d]=(a==null?void 0:a[d])||e[d]})}).finally(()=>{n.loading=!1})):e.id=0}_({open(r){var o;(o=y.value)==null||o.resetFields(),n.visible=!0,n.other=r}});const b=ge(()=>{var r;return(r=n.other)!=null&&r.id?"\u7F16\u8F91\u5C0F\u8BF4":"\u65B0\u589E\u5C0F\u8BF4"});return(r,o)=>{const a=Q,d=M,V=T,F=A,O=ye,P=se,H=de,K=R,G=z,J=N;return E(),I("div",De,[l(G,{"model-value":t(n).visible,"show-close":!t(n).loading,"close-on-press-escape":!1,title:t(b),width:750,"z-index":20,"close-on-click-modal":!1,onClose:g,onOpened:v},{footer:u(()=>[l(F,{class:"ml-auto",size:"small",loading:t(n).loading,onClick:g},{default:u(()=>[f(" \u53D6\u6D88 ")]),_:1},8,["loading"]),l(F,{size:"small",loading:t(n).loading,type:"primary",class:"border-0 bg-orange group-hover:bg-orangeLight",onClick:o[8]||(o[8]=c=>t(i)(t(y)))},{default:u(()=>[f(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),default:u(()=>[j((E(),I("div",null,[l(K,{ref_key:"ruleFormRef",ref:y,"label-width":"80px",model:t(e),rules:C,"hide-required-asterisk":!1},{default:u(()=>[B("div",Se,[B("div",Ae,[l(d,{label:"\u6807\u9898",prop:"name"},{default:u(()=>[l(a,{spellcheck:"false",modelValue:t(e).name,"onUpdate:modelValue":o[0]||(o[0]=c=>t(e).name=c),modelModifiers:{trim:!0},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"},null,8,["modelValue"])]),_:1}),l(d,{label:"\u5206\u7C7B",prop:"categoryPid"},{default:u(()=>[l(L,{class:"w-full","model-value":t(e).categoryChildId?[t(e).categoryPid,t(e).categoryChildId]:[t(e).categoryPid],placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B",type:"novel",checkStrictly:!0,onChange:o[1]||(o[1]=c=>{t(e).categoryPid=c?c[0]:void 0,t(e).categoryChildId=c?c[1]:0})},null,8,["model-value"])]),_:1}),l(d,{label:"\u4F5C\u8005",prop:"author"},{default:u(()=>[l(a,{spellcheck:"false",modelValue:t(e).author,"onUpdate:modelValue":o[2]||(o[2]=c=>t(e).author=c),modelModifiers:{trim:!0},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u4F5C\u8005"},null,8,["modelValue"])]),_:1}),l(d,{label:"\u53D1\u5E03\u65F6\u95F4",prop:"releaseDate"},{default:u(()=>[l(V,{modelValue:t(e).releaseDate,"onUpdate:modelValue":o[3]||(o[3]=c=>t(e).releaseDate=c),modelModifiers:{number:!0},type:"datetime",placeholder:"\u9009\u62E9\u65E5\u671F\u65F6\u95F4",style:{width:"100%"},"value-format":"X"},null,8,["modelValue"])]),_:1})]),B("div",$e,[l(d,{label:"\u5C01\u9762",prop:"cover"},{default:u(()=>[B("div",Le,[l(a,{spellcheck:"false",modelValue:t(e).cover,"onUpdate:modelValue":o[4]||(o[4]=c=>t(e).cover=c),modelModifiers:{trim:!0},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5C01\u9762\u5730\u5740"},null,8,["modelValue"]),l(O,{class:"avatar-uploader mr-27",action:"/api/v1/upload",title:"\u70B9\u51FB\u4E0A\u4F20\u5C01\u9762\u56FE","show-file-list":!1,data:{exts:"jpg,jpeg,png,gif"},"auto-upload":!0,accept:"image/jpg,image/jpeg,image/png,image/gif","on-success":c=>t(e).cover=c.path,"on-error":c=>t(U)({position:"bottom-right",type:"error",message:JSON.parse(c.message).message})},{default:u(()=>[l(F,{type:"primary",link:""},{default:u(()=>[f("\u4E0A\u4F20")]),_:1})]),_:1},8,["on-success","on-error"])])]),_:1}),l(d,{label:"\u7B80\u4ECB",prop:"intro"},{default:u(()=>[l(a,{spellcheck:"false",modelValue:t(e).intro,"onUpdate:modelValue":o[5]||(o[5]=c=>t(e).intro=c),modelModifiers:{trim:!0},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u7B80\u4ECB"},null,8,["modelValue"])]),_:1}),l(d,{label:"\u6807\u7B7E",prop:"labels"},{default:u(()=>[l(Ie,{style:{width:"100%"},placeholder:"\u8BF7\u8F93\u5165\u6807\u7B7E",modelValue:t(e).labels,"onUpdate:modelValue":o[6]||(o[6]=c=>t(e).labels=c)},null,8,["modelValue"])]),_:1}),l(d,{label:"\u5B8C\u7ED3"},{default:u(()=>[l(H,{modelValue:t(e).isEnd,"onUpdate:modelValue":o[7]||(o[7]=c=>t(e).isEnd=c)},{default:u(()=>[l(P,{label:1},{default:u(()=>[f("\u662F")]),_:1}),l(P,{label:2},{default:u(()=>[f("\u5426")]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]),_:1},8,["model"])])),[[J,t(n).loading]])]),_:1},8,["model-value","show-close","title"])])}}});const Pe=$(qe,[["__scopeId","data-v-b464bfbd"]]),Ue=p=>(fe("data-v-02e90703"),p=p(),he(),p),Me={class:"flex-y box"},Re={class:"flex-x-between search"},ze={class:"flex-center",style:{gap:"16px","font-size":"12px"}},Ne=Ue(()=>B("span",{style:{flexShrink:0}},"\u5206\u7C7B",-1)),Te=["onClick"],Ye={key:1},je=q({__name:"index",setup(p){const _=k({pageIndex:1,pageSize:20,total:0}),s=x({loading:!1,data:[],searchVal:{categoryId:0,keywords:""},selectList:[],load(n){_.value=n||_.value,s.loading=!0,be({offset:(_.value.pageIndex-1)*_.value.pageSize,limit:_.value.pageSize,siteId:Number(sessionStorage.getItem("site")),...s.searchVal}).then(i=>{s.data=i.list,_.value.total=i.total}).finally(()=>{s.loading=!1})},handleSelectionChange(n){s.selectList=n},sortChnage({column:n,prop:i,order:g}){g?s.searchVal.order=`${i} ${g==="ascending"?"asc":"desc"}`:s.searchVal.order="",s.load()}}),m=k(),y=k(),e={del:n=>Y({message:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",okEms:"\u5C0F\u8BF4\u5220\u9664\u6210\u529F"},()=>Be(n).then(i=>(s.load(),i))),search:()=>{_.value.pageIndex=1,s.load()},statusChange(n,i){s.loading||(i.loading=!0)}};return _e(()=>{s.load()}),(n,i)=>{const g=A,C=X,h=ee,v=ve("MyImage"),b=ae,r=W,o=N;return E(),I("div",Me,[B("div",Re,[B("div",null,[l(g,{type:"primary",onClick:i[0]||(i[0]=a=>{var d;return(d=y.value)==null?void 0:d.open({})})},{default:u(()=>[f(" \u65B0\u589E\u5C0F\u8BF4 ")]),_:1}),l(g,{type:"danger",disabled:s.selectList.length<=0,onClick:i[1]||(i[1]=a=>e.del(s.selectList.map(d=>d.id)))},{default:u(()=>[f(" \u6279\u91CF\u5220\u9664 ")]),_:1},8,["disabled"])]),B("div",ze,[Ne,l(L,{type:"novel",placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B",checkStrictly:!0,onChange:i[2]||(i[2]=a=>{s.searchVal.categoryId=a?a[a.length-1]:void 0,e.search()})}),l(C,{modelValue:s.searchVal.keywords,"onUpdate:modelValue":i[3]||(i[3]=a=>s.searchVal.keywords=a),onChange:e.search},null,8,["modelValue","onChange"])])]),j((E(),w(r,{data:s.data,class:"auto",stripe:!0,onSortChange:s.sortChnage,onSelectionChange:s.handleSelectionChange},{default:u(()=>[l(h,{type:"selection",width:"55"}),l(h,{type:"index",label:"\u5E8F\u53F7"},{default:u(({row:a,store:d,$index:V})=>[B("div",{onClick:F=>d.toggleRowSelection(a,void 0)},S(V+1),9,Te)]),_:1}),l(h,{prop:"name",label:"\u540D\u79F0","min-width":"150","show-overflow-tooltip":!0}),l(h,{prop:"author",label:"\u4F5C\u8005","min-width":"150","show-overflow-tooltip":!0}),l(h,{label:"\u5C01\u9762","min-width":"150"},{default:u(({row:a})=>[a.cover?(E(),w(v,{key:0,src:a.cover,style:{width:"50px",height:"30px"}},null,8,["src"])):(E(),I("span",Ye,"-"))]),_:1}),l(h,{label:"\u5206\u7C7B","min-width":"150"},{default:u(({row:a})=>[f(S(a.category?a.category.name:"-")+" "+S(a.categoryChild?"/"+a.categoryChild.name:""),1)]),_:1}),l(h,{prop:"intro",label:"\u7B80\u4ECB","min-width":"150","show-tooltip-when-overflow":!0}),l(h,{prop:"isEnd",label:"\u662F\u5426\u5B8C\u7ED3","min-width":"150","show-tooltip-when-overflow":!0},{default:u(({row:a})=>[l(b,{size:"small",type:a.isEnd==1?"success":"danger","disable-transitions":""},{default:u(()=>[f(S(a.isEnd==1?"\u5B8C\u7ED3":"\u8FDE\u8F7D\u4E2D"),1)]),_:2},1032,["type"])]),_:1}),l(h,{prop:"releaseDate",label:"\u53D1\u5E03\u65F6\u95F4",type:"date",width:"150",sortable:""}),l(h,{fixed:"right",label:"\u64CD\u4F5C",align:"right","min-width":"150"},{default:u(({row:a})=>[l(g,{type:"primary",link:"",onClick:d=>t(Z).push({name:"details",query:{id:a.id,novelname:a.name}})},{default:u(()=>[f(" \u5C0F\u8BF4\u7AE0\u8282 ")]),_:2},1032,["onClick"]),l(g,{type:"primary",link:"",onClick:d=>{var V;return(V=y.value)==null?void 0:V.open(a)}},{default:u(()=>[f(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),l(g,{type:"danger",link:"",onClick:d=>e.del([a.id])},{default:u(()=>[f(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSortChange","onSelectionChange"])),[[o,s.loading]]),l(oe,{pageinfo:_.value,onChange:s.load},null,8,["pageinfo","onChange"]),l(Pe,{ref_key:"editorRef",ref:y,onLoad:s.load},null,8,["onLoad"]),l(xe,{ref_key:"allDelVueRef",ref:m,onLoad:s.load},null,8,["onLoad"])])}}});const el=$(je,[["__scopeId","data-v-02e90703"]]);export{el as default};
