import{h as N,a as K,b as X,d as Z,c as Q,f as ee,v as W,_ as M,ab as te,P as le,j as ae,l as ne,aE as se}from"./entry-5490c999.js";import"./el-table-column-a25f0439.js";import{E as oe}from"./el-switch-dc732e6b.js";import{E as ie}from"./el-input-number-860f564c.js";import{e as Y,a as de,m as ue,d as re,b as ce,c as he}from"./message-26acb8b6.js";import{F as J,b as R,Y as w,y as O,i as P,c as $,T as c,R as o,u as _,o as h,a5 as V,K as q,a as v,W as T,Q as B,M as k,G as me,V as A,a1 as pe,am as fe,an as ge,x as G,h as ve,O as ye,ac as Ce,P as _e}from"./vue-5906fc2c.js";const be=J({__name:"editor",emits:["load"],setup(t,{expose:b,emit:I}){const x=O("type");O("allType");const u=R(),n=w({id:0,name:"",parentId:void 0,sort:1,categories:[]}),a=w({loading:!1,visible:!1,other:void 0}),f=O("debounce")(r=>{!r||r.validate((e,s)=>{var p;e&&(a.loading=!0,(n.id?Y(x.value,n):de(x.value,{categories:n.categories,parentId:((p=a.other)==null?void 0:p.parentId)||0})).then(()=>{var F,S,E;const C=(F=a.other)!=null&&F.parentId?"\u5206\u7C7B":"\u7C7B\u578B";N({position:"bottom-right",type:"success",message:(S=a.other)!=null&&S.id?C+"\u66F4\u65B0\u6210\u529F":C+"\u65B0\u589E\u6210\u529F"}),I("load",(E=a.other)==null?void 0:E.id),i()}).finally(()=>{a.loading=!1}))})},300),i=()=>{a.other=void 0,a.visible=!1},m={categories:{required:!0,message:"\u8BF7\u8F93\u5165\u5206\u7C7B",trigger:"blur"}};function g(){var r;Object.keys(n).forEach(e=>{var s;n[e]=((s=a.other)==null?void 0:s[e])||n[e]}),n.id=(r=a.other)==null?void 0:r.id,n.sort=a.other.sort||1}b({open(r){var e;(e=u.value)==null||e.resetFields(),a.visible=!0,a.other=r}});const y=P(()=>{var e,s;let r=(e=a.other)!=null&&e.parentId?"\u5206\u7C7B":"\u7C7B\u578B";return(s=a.other)!=null&&s.id?"\u7F16\u8F91"+r:"\u65B0\u589E"+r});return(r,e)=>{const s=K,p=X,C=Z,F=Q,S=ee,E=W;return h(),$("div",null,[c(S,{"model-value":a.visible,"show-close":!a.loading,"close-on-press-escape":!1,title:_(y),width:450,"z-index":20,"close-on-click-modal":!1,onClose:i,class:"not_pb",onOpened:g},{footer:o(()=>[c(F,{class:"ml-auto",size:"small",loading:a.loading,onClick:i},{default:o(()=>[V(" \u53D6\u6D88 ")]),_:1},8,["loading"]),c(F,{size:"small",loading:a.loading,type:"primary",class:"border-0 bg-orange group-hover:bg-orangeLight",onClick:e[2]||(e[2]=U=>_(f)(u.value))},{default:o(()=>[V(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),default:o(()=>[q((h(),$("div",null,[c(C,{ref_key:"ruleFormRef",ref:u,"label-width":"70px",model:n,rules:m,"hide-required-asterisk":!1},{default:o(()=>{var U;return[c(p,{label:(U=a.other)!=null&&U.parentId?"\u5206\u7C7B\u540D\u79F0":"\u7C7B\u578B\u540D\u79F0",prop:"categories"},{default:o(()=>{var z,j;return[c(s,{spellcheck:"false",clearable:"",class:"input",type:"textarea",rows:10,"model-value":(z=n.categories)==null?void 0:z.join(`
`),"onUpdate:modelValue":e[0]||(e[0]=D=>n.categories=D.split(`
`)),onBlur:e[1]||(e[1]=D=>n.categories=n.categories.filter(l=>l)),placeholder:`\u8BF7\u8F93\u5165${(j=a.other)!=null&&j.parentId?"\u5206\u7C7B":"\u7C7B\u578B"}\u540D\u79F0\uFF0C\u4E00\u884C\u4E00\u4E2A`},null,8,["model-value","placeholder"])]}),_:1},8,["label"])]}),_:1},8,["model"])])),[[E,a.loading]])]),_:1},8,["model-value","show-close","title"])])}}});const xe=M(be,[["__scopeId","data-v-96e99afd"]]);const ke=t=>(fe("data-v-1499a8e0"),t=t(),ge(),t),Be={class:"flex-y box"},Ve={class:"flex-x-between"},$e={class:"flex-x",style:{"align-items":"center"}},Fe={key:0,style:{"flex-shrink":"0","margin-right":"12px"}},Ee={class:"flex-x",style:{"align-items":"center"}},Ie={key:0,style:{"flex-shrink":"0","margin-right":"12px"}},Se={class:"flex-x",style:{"align-items":"center"}},Re=ke(()=>v("div",{style:{width:"80px",cursor:"pointer"}},[v("i",{class:"iconfont icon-tishi2",style:{"font-size":"12px",color:"#999","margin-left":"6px"}})],-1)),we={class:"flex-x",style:{"align-items":"center"}},Ue={class:"flex-x",style:{"align-items":"center","justify-content":"center"}},De={key:0,style:{"flex-shrink":"0","margin-right":"12px"}},Le=["onClick"],Te={key:0,style:{"flex-shrink":"0","margin-right":"12px","text-align":"left"}},ze={__name:"table",props:{isChild:{type:Boolean,default:!1},parent:{type:Object,default:()=>({})},list:{type:Array,default:()=>[]}},emits:["currentChange","load","refresh"],setup(t,{expose:b,emit:I}){const x=t,u=O("type"),n=R(),a=R(),f=R([]);function i(e){f.value=e}const m=()=>{[...x.list].sort((s,p)=>s.sort-p.sort>0?0:-1).forEach((s,p)=>{x.list[p]=s})},g=R(0);function y(){setTimeout(()=>{g.value=document.querySelector("#shrinking_bt").getBoundingClientRect().top-7},0)}const r={saveChange(e,s=!1){if(!e.name){N({position:"bottom-right",type:"error",message:"\u540D\u79F0\u5FC5\u586B"}),e.sort=e.old.sort,e.name=e.old.name;return}Y(u.value,e).then(()=>{const p=x.isChild?"\u5206\u7C7B":"\u7C7B\u578B";N({position:"bottom-right",type:"success",message:p+"\u66F4\u65B0\u6210\u529F"}),m(),s&&I("refresh",x.parent.id)}).catch(()=>{e.sort=e.old.sort,e.name=e.old.name})},del:(e,s="single")=>ue({message:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F"},()=>(s=="all"?re(u.value,{ids:e}):ce(u.value,e.id)).then(p=>(N({position:"bottom-right",type:"success",message:p}),I("load",x.parent.id),p)))};return b({tableRef:n,setCurrentRow(e){n==null||n.value.setCurrentRow(e)}}),(e,s)=>{var D;const p=Q,C=ne,F=ie,S=K,E=te,U=le,z=oe,j=ae;return h(),$("div",Be,[v("div",Ve,[v("div",null,[c(p,{type:"primary",style:T({marginBottom:t.isChild?"16px":""}),disabled:t.isChild&&!t.parent.id,onClick:s[0]||(s[0]=l=>{var d,L;return(L=a.value)==null?void 0:L.open({parentId:t.isChild?t.parent.id:0,sort:(((d=t.list[t.list.length-1])==null?void 0:d.sort)||0)+1})})},{default:o(()=>[me(e.$slots,"default",{},()=>[V("\u65B0\u589E\u5206\u7C7B")],!0)]),_:3},8,["style","disabled"]),t.isChild?(h(),B(p,{key:0,type:"danger",style:T({marginBottom:t.isChild?"16px":""}),onClick:s[1]||(s[1]=l=>r.del(f.value.map(d=>d.id),"all")),disabled:((D=f.value)==null?void 0:D.length)<=0},{default:o(()=>[V(" \u6279\u91CF\u5220\u9664 ")]),_:1},8,["style","disabled"])):k("",!0)])]),c(j,{ref_key:"tableRef",ref:n,key:"id",data:t.list,stripe:!0,style:T({width:"100%",height:"calc(100vh - 212px)"}),"row-class-name":({row:l})=>t.parent===l?"current-row":"",onSelectionChange:i},{default:o(()=>[t.isChild?(h(),B(C,{key:0,type:"selection",width:"25"})):k("",!0),c(C,{label:"\u5E8F\u53F7",prop:"sort",align:"center"},{default:o(({row:l})=>[v("div",$e,[t.isChild?k("",!0):(h(),$("span",Fe,"\u5E8F\u53F7")),c(F,{spellcheck:"false",style:{width:"320px"},modelValue:l.sort,"onUpdate:modelValue":d=>l.sort=d,clearable:"",precision:0,class:"w-full","step-strictly":"",min:1,"value-on-clear":1,controls:!1,onChange:d=>r.saveChange(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1}),c(C,{label:"\u540D\u79F0",prop:"name"},{default:o(({row:l})=>[v("div",Ee,[t.isChild?k("",!0):(h(),$("span",Ie,"\u540D\u79F0")),c(S,{spellcheck:"false",style:{width:"320px"},modelValue:l.name,"onUpdate:modelValue":d=>l.name=d,placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",onChange:d=>r.saveChange(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1}),_(u)==1?(h(),B(C,{key:1,label:"\u5C0F\u8BF4\u683C\u5F0F",width:t.isChild?100:120},{default:o(({row:l})=>[v("div",Se,[c(E,{modelValue:l.isVertical,"onUpdate:modelValue":d=>l.isVertical=d,onChange:d=>r.saveChange(l,!t.isChild),"true-label":1,"false-label":0,size:"small",label:"\u7AD6\u7248\u5C0F\u8BF4"},null,8,["modelValue","onUpdate:modelValue","onChange"]),t.isChild?k("",!0):(h(),B(U,{key:0,effect:"light",content:"\u7AD6\u7248\u5C0F\u8BF4\u4EC5\u9488\u5BF9APP\u751F\u6548",placement:"top"},{default:o(()=>[Re]),_:1}))])]),_:1},8,["width"])):k("",!0),_(u)==3?(h(),B(C,{key:2,label:"\u5185\u5BB9\u683C\u5F0F",width:t.isChild?100:120},{default:o(({row:l})=>[v("div",we,[c(E,{modelValue:l.isFont,"onUpdate:modelValue":d=>l.isFont=d,onChange:d=>r.saveChange(l,!t.isChild),"true-label":1,"false-label":0,size:"small",label:"\u7EAF\u6587\u5B57"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1},8,["width"])):k("",!0),c(C,{label:"\u72B6\u6001",align:"center",width:t.isChild?80:130},{default:o(({row:l})=>[v("div",Ue,[t.isChild?k("",!0):(h(),$("span",De,"\u72B6\u6001")),c(z,{modelValue:l.status,"onUpdate:modelValue":d=>l.status=d,"active-value":1,"inactive-value":2,onChange:d=>r.saveChange(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1},8,["width"]),c(C,{width:t.isChild?80:150,label:_(u)===1?"\u5C0F\u8BF4\u6570\u91CF":_(u)===2?"\u4F5C\u8005\u6570\u91CF":_(u)===3?"\u56FE\u6587\u6570\u91CF":_(u)===4?"\u5C0F\u8BF4\u6570\u91CF":"",prop:"referCount"},{default:o(({row:l})=>[v("span",{class:"w-full typeclass",style:{"align-items":"center"},onClick:d=>t.isChild?"":e.$emit("currentChange",t.parent!==l?l:{})},[t.isChild?k("",!0):(h(),$("span",Te,A(_(u)===1?"\u5C0F\u8BF4\u6570\u91CF":_(u)===2?"\u4F5C\u8005\u6570\u91CF":_(u)===3?"\u56FE\u6587\u6570\u91CF":_(u)===4?"\u5C0F\u8BF4\u6570\u91CF":"")+":",1)),V(" "+A(l.referCount),1)],8,Le)]),_:1},8,["width","label"]),c(C,{fixed:"right",label:"\u64CD\u4F5C",align:"right",width:t.isChild?80:120},{default:o(({row:l,$index:d})=>[!t.isChild&&t.parent!==l?(h(),B(p,{key:0,type:"primary",link:"",onClick:L=>{e.$emit("currentChange",l),y()}},{default:o(()=>[V(" \u5C55\u5F00 ")]),_:2},1032,["onClick"])):k("",!0),!t.isChild&&t.parent===l?(h(),B(p,{key:1,type:"primary",link:"",onClick:s[2]||(s[2]=L=>e.$emit("currentChange",{})),class:"shrinking",id:"shrinking_bt"},{default:o(()=>[V(" \u6536\u8D77 "),(h(),B(pe,{to:"body"},[v("span",{class:"jiantou",style:T({top:g.value+"px",display:g.value?"block":"none"})},null,4)]))]),_:1})):k("",!0),c(p,{type:"danger",link:"",onClick:L=>r.del(l)},{default:o(()=>[V(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1},8,["width"])]),_:1},8,["data","style","row-class-name"]),c(xe,{ref_key:"editorRef",ref:a,onLoad:s[3]||(s[3]=l=>e.$emit("load",t.parent.id))},null,512)])}}},H=M(ze,[["__scopeId","data-v-1499a8e0"]]),je={class:"content"},Ne={class:"common_secondary_tabs_box"},Oe={class:"secondary_tabs"},Pe=["onClick"],qe={class:"boxs"},Ae={class:"flex-x-between video-album"},Me=J({__name:"index",setup(t){se();const b=w({type:4,prop:"",tabs:[{title:"\u5C0F\u8BF4\u5206\u7C7B",num:4,type:2},{title:"\u4F5C\u8005\u5206\u7C7B",num:2,type:2},{title:"\u56FE\u6587\u5206\u7C7B",num:3,type:2}]}),I=i=>{b.type=i,i==7&&(b.prop="wx"),i==8&&(b.prop="zfb"),n.load(),f.value={}};G("type",P(()=>b.type));const x=function(){return{loading:!1,data:[],searchVal:{key:"",order:""},selectList:[],load(i){this.loading=!0,he(b.type,i).then(m=>{m.forEach(g=>g.old={...g}),this.data=m,console.log(this),!i&&!m.find(g=>g.id===f.value.id)&&(f.value={})}).finally(()=>{this.loading=!1})},handleSelectionChange(i){this.selectList=i},sortChnage({column:i,prop:m,order:g}){g?this.searchVal.order=`${m} ${g==="ascending"?"asc":"desc"}`:this.searchVal.order="",this.load()}}},u=R(),n=w(x()),a=w(x()),f=w({value:{},set(i){var m;if(!i){f.value=n.data.find(g=>{var y;return g.id===((y=f.value)==null?void 0:y.id)})||n.data[0],(m=u.value)==null||m.setCurrentRow(f.value);return}f.value!==i&&(f.value=i,a.load(i.id))}});return G("allType",P(()=>n.data)),ve(async()=>{n.load()}),(i,m)=>{const g=W;return h(),$("div",je,[v("div",Ne,[v("div",Oe,[(h(!0),$(ye,null,Ce(b.tabs,(y,r)=>(h(),$("section",{class:_e(b.type==y.num?"secondary_tabs_item active":"secondary_tabs_item")},[v("span",{onClick:e=>I(y.num)},A(y.title),9,Pe)],2))),256))])]),v("div",qe,[v("div",Ae,[q((h(),B(H,{ref_key:"listRef",ref:u,list:n.data,style:{flex:"1"},class:"parent car",parent:f.value,onCurrentChange:f.set,onLoad:m[0]||(m[0]=()=>n.load()),onRefresh:m[1]||(m[1]=y=>a.load(y))},{default:o(()=>[V(" \u65B0\u589E\u7C7B\u578B ")]),_:1},8,["list","parent","onCurrentChange"])),[[g,n.loading]]),v("div",{class:"car",style:T({width:f.value.id?"34vw":"0",transition:"all 0.2s",overflow:"hidden"})},[q((h(),B(H,{parent:f.value,list:a.data,"is-child":!0,onLoad:m[2]||(m[2]=y=>a.load(y))},{default:o(()=>[V(" \u65B0\u589E\u5206\u7C7B ")]),_:1},8,["parent","list"])),[[g,a.loading]])],4)])])])}}});const Je=M(Me,[["__scopeId","data-v-0b256586"]]);export{Je as default};
