import{b as L,d as M,c as P,f as U,h as D,a as K,v as z,_ as R,i as Q,j as G,l as W}from"./entry-5490c999.js";import"./el-table-column-a25f0439.js";import{e as X,a as Z,d as ee,w as le,c as te,g as ae,b as oe}from"./wangEditor-8dd71e06.js";import{E as se,a as ne,P as de}from"./pagination-5ca1e60a.js";import{E as ie}from"./el-date-picker-72643638.js";import{_ as $,a as ue,g as re,c as ce}from"./videoStar-ea710fef.js";import{m as Y}from"./message-26acb8b6.js";import{Y as x,b as E,Q as I,R as o,u as t,o as C,T as a,a5 as h,a as v,F as N,y as pe,i as me,c as B,K as T,O as ge,ac as fe,M as _e,h as he,am as ye,an as be,V as S,ad as ve}from"./vue-5906fc2c.js";import{E as Ce}from"./el-input-number-860f564c.js";import{E as Fe}from"./el-progress-37d8b86e.js";const Ee={style:{display:"flex","align-items":"center",gap:"8px",width:"100%"}},ke={__name:"allDel",emits:["load"],setup(k,{expose:y,emit:d}){const c=x({loading:!1,visible:!1,other:void 0}),b=E(),e=x({categoryId:[],collectionId:[],updateAtEnd:"",updateAtStart:"",tags:[]});E([]),E([]);const s=g=>{if(e.updateAtEnd)return g.getTime()>e.updateAtEnd.getTime()},i=g=>g.getTime()<new Date(e.updateAtStart).getTime(),m=()=>Y({message:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",okEms:"\u56FE\u6587\u6570\u636E\u5220\u9664\u6210\u529F"},()=>b.value.validate((g,f)=>{var r;g&&(c.loading=!0,ue({collectionId:e.collectionId,updateAtStart:e.updateAtStart||void 0,updateAtEnd:e.updateAtEnd||void 0,categoryId:(r=e.categoryId)==null?void 0:r.map(l=>l.at(-1)),tags:e.tags||[]}).then(l=>{c.visible=!1}).finally(()=>{c.loading=!1}))})),V=()=>{var g;c.visible=!1,(g=b.value)==null||g.resetFields(),e.updateAtStart="",e.updateAtEnd="",e.tags=[],d("load")},_=()=>{};return y({open(g){c.visible=!0}}),(g,f)=>{const r=L,l=ie,n=M,p=P,w=U;return C(),I(w,{"model-value":t(c).visible,"show-close":!t(c).loading,"close-on-press-escape":!1,title:"\u4E00\u952E\u5220\u9664",width:550,"z-index":20,top:"25vh","close-on-click-modal":!1,onClose:V,onOpened:_},{footer:o(()=>[a(p,{class:"ml-auto",size:"small",loading:t(c).loading,onClick:V},{default:o(()=>[h(" \u53D6\u6D88 ")]),_:1},8,["loading"]),a(p,{class:"ml-auto",size:"small",type:"primary",loading:t(c).loading,onClick:f[3]||(f[3]=F=>m())},{default:o(()=>[h(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),default:o(()=>[a(n,{ref_key:"ruleFormRef",ref:b,"label-width":"80px",model:t(e),rules:{},"hide-required-asterisk":!1},{default:o(()=>[a(r,{label:"\u56FE\u6587\u5206\u7C7B",prop:"categoryId"},{default:o(()=>[a($,{modelValue:t(e).categoryId,"onUpdate:modelValue":f[0]||(f[0]=F=>t(e).categoryId=F),style:{width:"100%"},type:"article",placeholder:"\u9ED8\u8BA4\u5168\u90E8\u5206\u7C7B",checkStrictly:!0,props:{checkStrictly:!1,multiple:!0,emitPath:!0}},null,8,["modelValue"])]),_:1}),a(r,{label:"\u66F4\u65B0\u65F6\u95F4",prop:["updateAtStart","updateAtEnd"]},{default:o(()=>[v("div",Ee,[a(l,{modelValue:t(e).updateAtStart,"onUpdate:modelValue":f[1]||(f[1]=F=>t(e).updateAtStart=F),type:"datetime",placeholder:"\u5F00\u59CB\u65E5\u671F",style:{flex:"1 1"},"disabled-date":s,format:"YYYY/MM/DD HH:mm:ss",clearable:!1},null,8,["modelValue"]),h(" ~ "),a(l,{modelValue:t(e).updateAtEnd,"onUpdate:modelValue":f[2]||(f[2]=F=>t(e).updateAtEnd=F),type:"datetime",style:{flex:"1 1"},"disabled-date":i,placeholder:"\u7ED3\u675F\u65E5\u671F",format:"YYYY/MM/DD HH:mm:ss",clearable:!1},null,8,["modelValue"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","show-close"])}}},Ve=ke,xe={class:"hhhh"},Be={class:"flex-x-between"},Ie={class:"block"},we={class:"block"},Ae={style:{display:"flex","align-items":"center",width:"100%",gap:"12px"}},Se={style:{"line-height":"32px"}},De=N({__name:"editor",emits:["load"],setup(k,{expose:y,emit:d}){const c=x({loading:!1,list:[],fn(r){c.loading=!0,ce({keywords:r}).then(l=>{console.log(l,"===="),c.list=l.list}).finally(()=>{c.loading=!1})}}),b=E(),e=x({name:"",content:"",categoryPid:0,categoryChildId:0,surfacePlot:"",id:0,status:1,celebrityIds:[],introduce:"",popularity:0}),s=x({loading:!1,visible:!1,other:void 0}),i=pe("debounce")(r=>{console.log(e.content==="<p><br></p>"),r&&r.validate(l=>{l&&(s.loading=!0,(e.id?X(e):Z(e)).then(()=>{var n;D({position:"bottom-right",type:"success",message:(n=s.other)!=null&&n.id?"\u56FE\u6587\u66F4\u65B0\u6210\u529F":"\u56FE\u6587\u65B0\u589E\u6210\u529F"}),d("load"),m()}).finally(()=>{s.loading=!1}))})},300),m=()=>{s.other=void 0,s.visible=!1,e.categoryPid=0,e.categoryChildId=0,c.list=[],e.celebrityIds=[],e.introduce="",e.popularity=""},V={name:{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898",trigger:"blur"},categoryPid:{required:!0,validator:(r,l,n)=>e.categoryPid||e.categoryChildId?n():n(new Error("\u8BF7\u9009\u62E9\u7C7B\u578B")),trigger:"blur"},surfacePlot:{required:!1,message:"\u8BF7\u8F93\u5165\u5C01\u9762\u5730\u5740",trigger:"blur"},content:{required:!0,message:"\u8BF7\u8F93\u5165\u5185\u5BB9",trigger:"blur"}},_=E([]);re({limit:9999}).then(r=>{_.value=r.list});function g(){var r,l;(r=s.other)!=null&&r.id?(s.loading=!0,ee((l=s.other)==null?void 0:l.id).then(n=>{Object.keys(e).forEach(p=>{e[p]=(n==null?void 0:n[p])||e[p]}),c.list=n.Celebrities,e.celebrityIds=n.Celebrities.map(p=>p.id),e.content=e.content.replace(/<([/]?)(article)((:?s*)(:?[^>]*)(:?s*))>/g,"<$1p$3>"),console.log(e,"===")}).finally(()=>{s.loading=!1})):e.id=0}y({open(r){var l;(l=b.value)==null||l.resetFields(),s.visible=!0,s.other=r}});const f=me(()=>{var r;return(r=s.other)!=null&&r.id?"\u7F16\u8F91\u56FE\u6587":"\u65B0\u589E\u56FE\u6587"});return(r,l)=>{const n=K,p=L,w=se,F=ne,A=P,j=Fe,q=Ce,O=M,H=U,J=z;return C(),B("div",xe,[a(H,{"model-value":t(s).visible,"show-close":!t(s).loading,"close-on-press-escape":!1,title:t(f),width:960,"z-index":20,"close-on-click-modal":!1,onClose:m,onOpened:g},{footer:o(()=>[a(A,{class:"ml-auto",size:"small",loading:t(s).loading,onClick:m},{default:o(()=>[h(" \u53D6\u6D88 ")]),_:1},8,["loading"]),a(A,{size:"small",loading:t(s).loading,type:"primary",class:"border-0 bg-orange group-hover:bg-orangeLight",onClick:l[7]||(l[7]=u=>t(i)(t(b)))},{default:o(()=>[h(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),default:o(()=>[T((C(),B("div",null,[a(O,{ref_key:"ruleFormRef",ref:b,"label-width":"80px",model:t(e),rules:V,"hide-required-asterisk":!1},{default:o(()=>[v("div",Be,[v("div",Ie,[a(p,{label:"\u6807\u9898",prop:"name"},{default:o(()=>[a(n,{spellcheck:"false",modelValue:t(e).name,"onUpdate:modelValue":l[0]||(l[0]=u=>t(e).name=u),modelModifiers:{trim:!0},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"},null,8,["modelValue"])]),_:1}),a(p,{label:"\u5206\u7C7B",prop:"categoryPid"},{default:o(()=>[a($,{class:"w-full","model-value":t(e).categoryChildId?[t(e).categoryPid,t(e).categoryChildId]:[t(e).categoryPid],placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B",type:"article",checkStrictly:!0,onChange:l[1]||(l[1]=u=>{t(e).categoryPid=u?u[0]:void 0,t(e).categoryChildId=u?u[1]:0})},null,8,["model-value"])]),_:1}),a(p,{label:"\u4EBA\u7269"},{default:o(()=>[a(F,{modelValue:t(e).celebrityIds,"onUpdate:modelValue":l[2]||(l[2]=u=>t(e).celebrityIds=u),multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"\u8BF7\u8F93\u5165\u4F5C\u8005",class:"w-full","remote-method":t(c).fn,loading:t(c).loading},{default:o(()=>[(C(!0),B(ge,null,fe(t(c).list,u=>(C(),I(w,{key:u.id,label:u.chineseName,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","remote-method","loading"])]),_:1})]),v("div",we,[a(p,{label:"\u5C01\u9762",prop:"surfacePlot"},{default:o(()=>[v("div",Ae,[a(n,{spellcheck:"false",modelValue:t(e).surfacePlot,"onUpdate:modelValue":l[3]||(l[3]=u=>t(e).surfacePlot=u),modelModifiers:{trim:!0},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5C01\u9762\u5730\u5740"},null,8,["modelValue"]),a(j,{class:"avatar-uploader mr-27",action:"/api/v1/upload",title:"\u70B9\u51FB\u4E0A\u4F20\u5C01\u9762\u56FE","show-file-list":!1,data:{exts:"jpg,jpeg,png,gif"},"auto-upload":!0,accept:"image/jpg,image/jpeg,image/png,image/gif","on-success":u=>t(e).surfacePlot=u.path,"on-error":u=>t(D)({position:"bottom-right",type:"error",message:JSON.parse(u.message).message})},{default:o(()=>[a(A,{type:"primary",link:"",disabled:t(e).cycle===2},{default:o(()=>[h("\u4E0A\u4F20")]),_:1},8,["disabled"])]),_:1},8,["on-success","on-error"])])]),_:1}),a(p,{label:"\u6458\u8981"},{default:o(()=>[a(n,{spellcheck:"false",modelValue:t(e).introduce,"onUpdate:modelValue":l[4]||(l[4]=u=>t(e).introduce=u),modelModifiers:{trim:!0},clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6458\u8981"},null,8,["modelValue"])]),_:1}),a(p,{label:"\u4EBA\u6C14"},{default:o(()=>[a(q,{spellcheck:"false",modelValue:t(e).popularity,"onUpdate:modelValue":l[5]||(l[5]=u=>t(e).popularity=u),modelModifiers:{number:!0},clearable:"",precision:0,"step-strictly":"",min:0,"controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u4EBA\u6C14"},null,8,["modelValue"])]),_:1})])]),a(p,{label:"\u5185\u5BB9",prop:"content"},{default:o(()=>[v("div",Se,[t(s).visible?(C(),I(le,{key:0,"model-value":t(e).content,"onUpdate:modelValue":l[6]||(l[6]=u=>t(e).content=u==="<p><br></p>"?"":u),height:"400px",style:{"z-index":"9"}},null,8,["model-value"])):_e("",!0)])]),_:1})]),_:1},8,["model"])])),[[J,t(s).loading]])]),_:1},8,["model-value","show-close","title"])])}}});const Pe=R(De,[["__scopeId","data-v-d2b8fb2d"]]),$e=k=>(ye("data-v-04525610"),k=k(),be(),k),Le={class:"flex-y box"},Me={class:"flex-x-between search"},Ue={class:"flex-center",style:{gap:"16px","font-size":"12px"}},ze=$e(()=>v("span",{style:{flexShrink:0}},"\u5206\u7C7B",-1)),Re=["onClick"],Ye={key:1},Ne=N({__name:"index",setup(k){const y=E({pageIndex:1,pageSize:20,total:0}),d=x({loading:!1,data:[],searchVal:{keywords:"",categoryId:0,order:"updateAt desc"},selectList:[],load(s){y.value=s||y.value,d.loading=!0,ae({page:y.value.pageIndex,limit:y.value.pageSize,...d.searchVal}).then(i=>{d.data=i.list,y.value.total=i.total}).finally(()=>{d.loading=!1})},handleSelectionChange(s){d.selectList=s},sortChnage({column:s,prop:i,order:m}){m?d.searchVal.order=`${i} ${m==="ascending"?"asc":"desc"}`:d.searchVal.order="",d.load()}}),c=E(),b=E(),e={del:s=>Y({message:"\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",okEms:"\u56FE\u6587\u5220\u9664\u6210\u529F"},()=>oe(s).then(i=>(d.load(),i))),search:()=>{y.value.pageIndex=1,d.load()},statusChange(s,i){d.loading||(i.loading=!0,te(i.id,s).then(()=>{D({position:"bottom-right",type:"success",message:"\u72B6\u6001\u66F4\u65B0\u6210\u529F"})}).catch(()=>{i.status=s===1?2:1}).finally(()=>{i.loading=!1}))}};return he(()=>{d.load()}),(s,i)=>{const m=P,V=Q,_=W,g=ve("MyImage"),f=G,r=z;return C(),B("div",Le,[v("div",Me,[v("div",null,[a(m,{type:"primary",onClick:i[0]||(i[0]=l=>{var n;return(n=b.value)==null?void 0:n.open({})})},{default:o(()=>[h(" \u65B0\u589E\u56FE\u6587 ")]),_:1}),a(m,{onClick:i[1]||(i[1]=l=>{var n;return(n=c.value)==null?void 0:n.open({})})},{default:o(()=>[h(" \u4E00\u952E\u5220\u9664 ")]),_:1}),a(m,{type:"danger",disabled:d.selectList.length<=0,onClick:i[2]||(i[2]=l=>e.del(d.selectList.map(n=>n.id)))},{default:o(()=>[h(" \u6279\u91CF\u5220\u9664 ")]),_:1},8,["disabled"])]),v("div",Ue,[ze,a($,{type:"article",placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B",checkStrictly:!0,onChange:i[3]||(i[3]=l=>{d.searchVal.categoryId=l?l[l.length-1]:void 0,e.search()})}),a(V,{modelValue:d.searchVal.keywords,"onUpdate:modelValue":i[4]||(i[4]=l=>d.searchVal.keywords=l),onChange:e.search},null,8,["modelValue","onChange"])])]),T((C(),I(f,{data:d.data,class:"auto",stripe:!0,onSortChange:d.sortChnage,onSelectionChange:d.handleSelectionChange},{default:o(()=>[a(_,{type:"selection",width:"55"}),a(_,{type:"index",label:"\u5E8F\u53F7"},{default:o(({row:l,store:n,$index:p})=>[v("div",{onClick:w=>n.toggleRowSelection(l,void 0)},S(p+1),9,Re)]),_:1}),a(_,{prop:"name",label:"\u540D\u79F0","min-width":"250","show-overflow-tooltip":!0}),a(_,{label:"\u5C01\u9762","min-width":"150"},{default:o(({row:l})=>[l.surfacePlot?(C(),I(g,{key:0,src:l.surfacePlot,style:{width:"50px",height:"30px"}},null,8,["src"])):(C(),B("span",Ye,"-"))]),_:1}),a(_,{label:"\u5206\u7C7B","min-width":"150"},{default:o(({row:l})=>[h(S(l.category?l.category.name:"-")+" "+S(l.categoryChild?"/"+l.categoryChild.name:""),1)]),_:1}),a(_,{prop:"popularity","min-width":"130",label:"\u4EBA\u6C14"}),a(_,{prop:"updateAt",label:"\u66F4\u65B0\u65F6\u95F4",type:"date",width:"150",sortable:""}),a(_,{fixed:"right",label:"\u64CD\u4F5C",align:"right","min-width":"110"},{default:o(({row:l})=>[a(m,{type:"primary",link:"",onClick:n=>{var p;return(p=b.value)==null?void 0:p.open(l)}},{default:o(()=>[h(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),a(m,{type:"danger",link:"",onClick:n=>e.del([l.id])},{default:o(()=>[h(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSortChange","onSelectionChange"])),[[r,d.loading]]),a(de,{pageinfo:y.value,onChange:d.load},null,8,["pageinfo","onChange"]),a(Pe,{ref_key:"editorRef",ref:b,onLoad:d.load},null,8,["onLoad"]),a(Ve,{ref_key:"allDelVueRef",ref:c,onLoad:d.load},null,8,["onLoad"])])}}});const Xe=R(Ne,[["__scopeId","data-v-04525610"]]);export{Xe as default};
