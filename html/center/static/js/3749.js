(self.webpackChunkxxxxx=self.webpackChunkxxxxx||[]).push([[3749],{20161:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var n=a(59171),l=a.n(n),i=a(26143),o=a.n(i)()(l());o.push([e.id,".block[data-v-6185ae42]{width:50%}","",{version:3,sources:["webpack://./src/tongji/pages/statistics-web/appEditor.vue"],names:[],mappings:"AACA,wBACE,SAAA",sourcesContent:["\n.block {\n  width: 50%;\n}\n"],sourceRoot:""}]);const s=o},79909:(e,t,a)=>{var n=a(20161);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(80950).Z)("77a726b4",n,!1,{})},78549:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});var n=a(66599);a(60261);const l=(0,a(40001).Z)(n.Z,[["__scopeId","data-v-c49ec992"]])},38316:(e,t,a)=>{"use strict";a.d(t,{Z:()=>D});var n=a(44511),l=(a(47465),a(76),a(45086)),i=(a(46348),a(86605)),o=(a(80173),a(74366)),s=(a(80036),a(38819)),u=(a(87838),a(79580)),r=(a(34375),a(64117)),d=(a(1610),a(91387),a(49663),a(991)),p=(a(93785),a(22839)),c=a(34629),v=a(22673),f=a.n(v),m=(a(84485),a(53394),a(49717),a(17391),a(961)),h=a.n(m),g=a(64560),b=a.n(g),w=a(37e3),I=a.n(w),y=a(93167),x=a.n(y),k=a(99539),_=a.n(k),A=a(52780),C=a.n(A),N=a(52122),V=a.n(N),Z=a(11549),W=a.n(Z),j=a(66802),B=a.n(j),O=a(82831),P=a.n(O),q=a(83256),S=a.n(q),E=a(26440),L=a(71254),U=a(92811),M=a(70215),z=a(20115);a(41386);function F(e,t){var a=_()(e);if(C()){var n=C()(e);t&&(n=h()(n).call(n,(function(t){return V()(e,t).enumerable}))),a.push.apply(a,n)}return a}function K(e){for(var t=1;t<arguments.length;t++){var a,n,l=null!=arguments[t]?arguments[t]:{};t%2?W()(a=F(Object(l),!0)).call(a,(function(t){(0,c.Z)(e,t,l[t])})):B()?P()(e,B()(l)):W()(n=F(Object(l))).call(n,(function(t){S()(e,t,V()(l,t))}))}return e}const H={__name:"appEditor",emits:["load"],setup:function(e,t){var a=t.expose,c=t.emit,v=(0,E.FN)().appContext.config.globalProperties.$ajax,m=(0,E.f3)("realodSurvey"),g=(0,U.iH)(),w=(0,U.qj)({appName:"",appIds:[],state:1,slogan:"",siteId:null}),y={multiple:!0,value:"appId",label:"appName",expandTrigger:"hover"},k=(0,U.qj)({loading:!1,visible:!1,other:void 0,list:[]}),_=(0,U.qj)({siteArr:[],siteVal:null}),A=function(){k.other=void 0,k.visible=!1,M.Z.commit("setModel",!1),m()};function C(){var e;null!==(e=k.other)&&void 0!==e&&e.id&&(k.loading=!0,v.get("/api/v1/supt/statistics/app/"+w.id).then((function(e){var t,a=e.data.data;w.appName=a.appName,w.appIds=I()(t=a.Apps).call(t,(function(e){return[void 0,e.appId]})),w.state=a.state||1,w.slogan=a.slogan})).finally((function(){k.loading=!1})))}var N=function(e){var t,a,n,l;null===(t=g.value)||void 0===t||t.resetFields(),k.visible=!0,k.other=e,w.id=null===(a=k.other)||void 0===a?void 0:a.id,w.siteId=null===(n=k.other)||void 0===n?void 0:n.siteId,Z(),V.load(),null!==(l=k.other)&&void 0!==l&&l.id&&V.fetch(k.other.siteId)},V=(0,U.qj)({data:[],data2:[],data3:[],getChannelBysuptList:function(e){return I()(e).call(e,(function(e){var t,a=x()(t=V.data).call(t,(function(t){return e.channelId==t.id}));return K(K({},e),{},{appName:e.appName+(a?"（"+(null==a?void 0:a.name)+"）":"")})}))},load:function(){v.get("/api/v3/channels",{params:{limit:999,page:1}}).then((function(e){var t=e.data;t.list.unshift({id:"0",name:"默认渠道",channelCode:"",state:1,domains:[],memberCount:0}),V.data=t.list}))},fetch:function(e){return(0,p.Z)(f().mark((function t(){var a,n;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=[],w.appIds=[],n={limit:999,page:1,siteId:e},t.next=5,v.get("/api/v1/supt/app/Android",{params:n}).then((function(e){var t,n,l,i=e.data.data;1===(null===(t=i.list)||void 0===t?void 0:t.length)?a.push({appName:"APK应用",children:i.list}):(null===(n=i.list)||void 0===n?void 0:n.length)>1&&a.push({appName:"APK应用",children:V.getChannelBysuptList(i.list)}),V.data3.push({appName:"APK应用",children:(null===(l=i.list)||void 0===l?void 0:l.length)>1?V.getChannelBysuptList(i.list):i.list})}));case 5:return t.next=7,v.get("/api/v1/supt/app/IOS",{params:n}).then((function(e){var t,n,l,i=e.data.data;1===(null===(t=i.list)||void 0===t?void 0:t.length)?a.push({appName:"IOS轻应用",children:i.list}):(null===(n=i.list)||void 0===n?void 0:n.length)>1&&a.push({appName:"IOS轻应用",children:V.getChannelBysuptList(i.list)}),V.data3.push({appName:"IOS轻应用",children:(null===(l=i.list)||void 0===l?void 0:l.length)>1?V.getChannelBysuptList(i.list):i.list})}));case 7:V.data2=a;case 8:case"end":return t.stop()}}),t)})))()}}),Z=function(){v.get("/api/v3/site",{params:{limit:999,page:1}}).then((function(e){var t=e.data;_.siteArr=t.list}))};a({open:N}),(0,E.YP)([function(){return M.Z.state.visible},function(){return M.Z.state.sysLayOpt}],(function(e){e[0]&&2==e[1]&&N()}));var W=(0,E.Fl)((function(){var e;return null!==(e=k.other)&&void 0!==e&&e.id?"编辑APP统计":"新增APP统计"}));return function(e,t){var a=d.EZ,p=o.nH,f=r.BT,m=r.ElSelect,I=u.mg,x=s.OX,N=o.ly,Z=i.ElButton,j=l.d0,B=n.t;return(0,E.wg)(),(0,E.j4)(j,{"model-value":k.visible,"show-close":!k.loading,"close-on-press-escape":!1,title:W.value,width:460,"z-index":20,"close-on-click-modal":!1,onClosed:A,onOpened:C},{footer:(0,E.w5)((function(){return[(0,E.Wm)(Z,{class:"ml-auto",size:"small",loading:k.loading,onClick:t[6]||(t[6]=function(e){return k.visible=!1})},{default:(0,E.w5)((function(){return[(0,E.Uk)(" 取消 ")]})),_:1},8,["loading"]),(0,E.Wm)(Z,{size:"small",loading:k.loading,type:"primary",class:"",onClick:t[7]||(t[7]=function(e){var t;(t=g.value)&&t.validate((function(e){if(e){var t,a;k.loading=!0;var n=w;n.appIds=h()(t=b()(a=n.appIds).call(a,1)).call(t,Boolean),v.post("/api/v1/supt/statistics/app",n).then((function(){var e;(0,z.bM)({position:"bottom-right",type:"success",message:null!==(e=k.other)&&void 0!==e&&e.id?"更新成功":"新增成功"}),c("load"),A()})).finally((function(){k.loading=!1}))}}))})},{default:(0,E.w5)((function(){return[(0,E.kq)(" :disabled=\"form.name === '默认渠道'\" "),(0,E.Uk)(" 保存 ")]})),_:1},8,["loading"])]})),default:(0,E.w5)((function(){return[(0,E.wy)(((0,E.wg)(),(0,E.iD)("div",null,[(0,E.Wm)(N,{onSubmit:t[5]||(t[5]=(0,L.iM)((function(){}),["prevent"])),ref_key:"ruleFormRef",ref:g,"label-width":"80px",model:w,"hide-required-asterisk":!1},{default:(0,E.w5)((function(){return[(0,E.Wm)(p,{label:"统计名称",prop:"appName",rules:{required:!0,message:"请输入统计名称",trigger:"blur"}},{default:(0,E.w5)((function(){return[(0,E.Wm)(a,{spellcheck:"false",modelValue:w.appName,"onUpdate:modelValue":t[0]||(t[0]=function(e){return w.appName=e}),modelModifiers:{trim:!0},clearable:"",placeholder:"请输入统计名称"},null,8,["modelValue"])]})),_:1}),(0,E.Wm)(p,{label:"站点",prop:"siteId",rules:{required:!0,message:"请选择站点",trigger:"change"}},{default:(0,E.w5)((function(){return[(0,E.Wm)(m,{modelValue:w.siteId,"onUpdate:modelValue":t[1]||(t[1]=function(e){return w.siteId=e}),disabled:w.id,class:"m-2",placeholder:"选择站点",style:{width:"100%"},onChange:t[2]||(t[2]=function(e){return V.fetch(w.siteId)})},{default:(0,E.w5)((function(){return[((0,E.wg)(!0),(0,E.iD)(E.HY,null,(0,E.Ko)(_.siteArr,(function(e){return(0,E.wg)(),(0,E.j4)(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue","disabled"])]})),_:1}),(0,E.Wm)(p,{label:"统计应用",prop:"appIds"},{default:(0,E.w5)((function(){return[(0,E.Wm)(I,{modelValue:w.appIds,"onUpdate:modelValue":t[3]||(t[3]=function(e){return w.appIds=e}),options:V.data2,"show-all-levels":!1,placeholder:"请选择统计应用",style:{width:"100%"},props:y},null,8,["modelValue","options"])]})),_:1}),(0,E.Wm)(p,{label:"状态",prop:"state"},{default:(0,E.w5)((function(){return[(0,E.Wm)(x,{size:"small",modelValue:w.state,"onUpdate:modelValue":t[4]||(t[4]=function(e){return w.state=e}),"active-value":1,"inactive-value":2},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model"])])),[[B,k.loading]])]})),_:1},8,["model-value","show-close","title"])}}};a(79909);const D=(0,a(40001).Z)(H,[["__scopeId","data-v-6185ae42"]])}}]);
//# sourceMappingURL=3749.js.map