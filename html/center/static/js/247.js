(self.webpackChunkxxxxx=self.webpackChunkxxxxx||[]).push([[247],{78133:(n,e,t)=>{var a=t(38856);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[n.id,a,""]]),a.locals&&(n.exports=a.locals);(0,t(80950).Z)("157bfd30",a,!1,{})},80247:(n,e,t)=>{"use strict";t.d(e,{Z:()=>On});var a=t(44511),l=(t(47465),t(76),t(45086)),r=(t(46348),t(50240)),i=(t(88255),t(50557),t(86605)),o=(t(80173),t(38819)),u=(t(87838),t(70670)),c=(t(74763),t(18938),t(991)),d=(t(93785),t(89888)),s=(t(31581),t(64117)),f=(t(1610),t(91387),t(94974),t(61581),t(38887)),p=t.n(f),h=t(57851),v=t.n(h),m=t(83336),w=t.n(m),g=t(9869),b=t.n(g),y=t(61964),x=t.n(y),k=t(52780),_=t.n(k),C=t(961),I=t.n(C),W=t(52122),U=t.n(W),V=t(66802),j=t.n(V),D=t(82831),S=t.n(D),z=t(83256),N=t.n(z),Z=t(34629),A=t(22839),L=(t(15165),t(24641),t(84485),t(53394),t(49717),t(17391),t(30331),t(10175),t(96103),t(22673)),O=t.n(L),T=t(37965),q=t.n(T),P=t(11549),E=t.n(P),B=t(99539),K=t.n(B),H=t(22078),M=t.n(H),Y=t(68796),$=t.n(Y),F=t(33657),R=t.n(F),X=t(18362),G=t.n(X),J=t(44062),Q=t.n(J),nn=t(37e3),en=t.n(nn),tn=t(93167),an=t.n(tn),ln=t(7121),rn=t.n(ln),on=t(26440),un=t(71254),cn=t(92811),dn=t(81040),sn=t(50802),fn=t(31270),pn=t(7142),hn=t(51715),vn=t(48127),mn=t(38316),wn=t(46557),gn=t(20115);t(41386);function bn(n,e){var t=K()(n);if(_()){var a=_()(n);e&&(a=I()(a).call(a,(function(e){return U()(n,e).enumerable}))),t.push.apply(t,a)}return t}function yn(n){for(var e=1;e<arguments.length;e++){var t,a,l=null!=arguments[e]?arguments[e]:{};e%2?E()(t=bn(Object(l),!0)).call(t,(function(e){(0,Z.Z)(n,e,l[e])})):j()?S()(n,j()(l)):E()(a=bn(Object(l))).call(a,(function(e){N()(n,e,U()(l,e))}))}return n}function xn(n,e){var t=void 0!==w()&&b()(n)||n["@@iterator"];if(!t){if(x()(n)||(t=function(n,e){var t;if(!n)return;if("string"==typeof n)return kn(n,e);var a=p()(t=Object.prototype.toString.call(n)).call(t,8,-1);"Object"===a&&n.constructor&&(a=n.constructor.name);if("Map"===a||"Set"===a)return v()(n);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return kn(n,e)}(n))||e&&n&&"number"==typeof n.length){t&&(n=t);var a=0,l=function(){};return{s:l,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(n){throw n},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,o=!1;return{s:function(){t=t.call(n)},n:function(){var n=t.next();return i=n.done,n},e:function(n){o=!0,r=n},f:function(){try{i||null==t.return||t.return()}finally{if(o)throw r}}}}function kn(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=n[t];return a}var _n=function(n){return(0,on.dD)("data-v-5387e6ae"),n=n(),(0,on.Cn)(),n},Cn={class:"box"},In={class:"search"},Wn=_n((function(){return(0,on._)("span",{class:"label"},"渠道",-1)})),Un={style:{display:"flex"}},Vn={class:"online"},jn={key:0,style:{display:"flex",gap:"0 8px"}},Dn=["onClick"],Sn={key:1,class:"tj_loading_box"},zn={class:"load_icon"},Nn=_n((function(){return(0,on._)("span",null,"加载中...",-1)})),Zn=["onClick"],An=["onClick"];const Ln={__name:"web",setup:function(n){var e=(0,on.FN)().appContext.config.globalProperties.$ajax,t=(0,on.f3)("realodSurvey"),f=(0,cn.iH)({pageIndex:1,pageSize:20,total:0}),p=q()((0,A.Z)(O().mark((function n(){var e,t,a,l;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e=xn(h.data),n.prev=1,e.s();case 3:if((t=e.n()).done){n.next=18;break}if(!((a=t.value).refresh<=1&&a.refresh>-1)){n.next=15;break}return a.refresh=-1,n.next=9,g(a);case 9:l=n.sent,a.data=l.data,a.online=l.online,a.refresh=5,n.next=16;break;case 15:a.refresh-=1;case 16:n.next=3;break;case 18:n.next=23;break;case 20:n.prev=20,n.t0=n.catch(1),e.e(n.t0);case 23:return n.prev=23,e.f(),n.finish(23);case 26:case"end":return n.stop()}}),n,null,[[1,20,23,26]])}))),1200);(0,on.Ah)((function(){clearInterval(p)}));var h=(0,cn.qj)({search:{},data:[],loading:!1,refreshLoading:!1,load:function(n){f.value=n||f.value,h.loading=!0,h.data=[],y.load();var t={limit:f.value.pageSize,page:f.value.pageIndex,keywords:h.search.keywords};""!=h.search.channelId&&(t.channelId=h.search.channelId),e.get("/api/v1/supt/statistics/web",{params:t}).then(function(){var n=(0,A.Z)(O().mark((function n(e){var t,a,l,r,i;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=e.data.data,a=xn(t.list),n.prev=2,a.s();case 4:if((l=a.n()).done){n.next=14;break}return r=l.value,n.next=8,g(r);case 8:i=n.sent,r.data=i.data,r.online=i.online,r.refresh=5;case 12:n.next=4;break;case 14:n.next=19;break;case 16:n.prev=16,n.t0=n.catch(2),a.e(n.t0);case 19:return n.prev=19,a.f(),n.finish(19);case 22:h.data=t.list,f.value.total=t.total;case 24:case"end":return n.stop()}}),n,null,[[2,16,19,22]])})));return function(e){return n.apply(this,arguments)}}()).finally((function(){h.loading=!1}))},refresh:function(n){h.refreshLoading||(h.refreshLoading=!0,e.get("/api/v1/supt/statistics/web/statistics/data/"+n).then((function(e){var t,a,l=e.data.data,r=[];E()(t=K()(l)).call(t,(function(n){m[n]&&r.push(yn(yn({},l[n]),{},{text:m[n],idx:M()(w).call(w,n)}))}));var i={data:$()(r).call(r,(function(n,e){return n.idx-e.idx})),online:l.online};E()(a=h.data).call(a,(function(e){e.id==n&&R()((function(){e.refresh=5,e.data=i.data,e.online=i.online}),300)}))})).catch((function(n){})).finally((function(){R()((function(){h.refreshLoading=!1}),500)})))},state:function(n){var t;e.put(G()(t="/api/v1/supt/statistics/web/".concat(n.id,"/state/")).call(t,n.state)).then((function(){(0,gn.bM)({position:"bottom-right",type:"success",message:"更新成功"})}))}}),v=(0,cn.iH)(),m={toDay:"今日",yesterday:"昨日",predictToDay:"预计今日",yesterdayNow:"昨日此时",average:"七日平均",historyPeak:"历史高峰",historyDate:"历史最高"},w=["toDay","yesterday","predictToDay","yesterdayNow","average","historyPeak","historyDate"],g=function(n){return new(Q())((function(t,a){e.get("/api/v1/supt/statistics/web/statistics/data/"+n.id).then((function(n){var e,a=n.data.data,l=[];E()(e=K()(a)).call(e,(function(n){m[n]&&l.push(yn(yn({},a[n]),{},{text:m[n],idx:M()(w).call(w,n)}))})),t({data:$()(l).call(l,(function(n,e){return n.idx-e.idx})),online:a.online})})).catch((function(n){t([])}))}))},b=(0,cn.qj)({data:{},detailUrl:"",load:function(n){n.visible=!0,e.get("/api/v1/supt/statistics/web/statistics/data/"+n.id).then((function(n){var e=n.data.data;b.data=e.statistic,b.detailUrl=e.detailUrl})).finally((function(){n.visible=!1}))}}),y=(0,cn.qj)({data:[],data2:[],dataSite:[],getChannelBysuptList:function(n){return en()(n).call(n,(function(n){var e,t=an()(e=y.data).call(e,(function(e){return n.channelId==e.id}));return yn(yn({},n),{},{appName:n.appName+(t?"（"+(null==t?void 0:t.name)+"）":"")})}))},load:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e.get(n?"/api/v3/sites/".concat(n,"/channel"):"/api/v3/channels").then((function(e){var t=e.data;t.list.unshift({id:"0",name:"默认渠道",channelCode:"",state:1,domains:[],memberCount:0}),n?y.dataSite=t.list:y.data=t.list}))},fetch:function(){return(0,A.Z)(O().mark((function n(){var t;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=[],n.next=3,e.get("/api/v1/supt/app/Android",{params:{limit:999,page:1}}).then((function(n){var e,a,l=n.data.data;1===(null===(e=l.list)||void 0===e?void 0:e.length)?t.push({appName:"APK应用",children:l.list}):(null===(a=l.list)||void 0===a?void 0:a.length)>1&&t.push({appName:"APK应用",children:y.getChannelBysuptList(l.list)})}));case 3:return n.next=5,e.get("/api/v1/supt/app/IOS",{params:{limit:999,page:1}}).then((function(n){var e,a,l=n.data.data;1===(null===(e=l.list)||void 0===e?void 0:e.length)?t.push({appName:"IOS轻应用",children:l.list}):(null===(a=l.list)||void 0===a?void 0:a.length)>1&&t.push({appName:"IOS轻应用",children:y.getChannelBysuptList(l.list)})}));case 5:y.data2=t;case 6:case"end":return n.stop()}}),n)})))()}});h.load(),y.fetch();var x=function(n){if(n){var e=rn()(String(n/3600)),t=rn()(String((n-3600*e)/60)),a=(n-3600*e)%60;return(e>=10?e:"0"+e)+":"+(t>=10?t:"0"+t)+":"+(a>=10?a:"0"+a)}return"-"},k=(0,cn.qj)({visible:!1,form:{siteId:null,channelId:[]},loading:!1,row:void 0,open:function(n){var e;k.visible=!0,k.row=n,k.form.appId=n.statisticID,k.form.channelId=(null===(e=n.ChannelList)||void 0===e?void 0:en()(e).call(e,(function(n){return n.id})))||[],k.form.siteId=n.siteId,y.load(n.siteId)},close:function(){k.form={channelId:[],siteId:null},k.row={},k.visible=!1},submit:function(n){var t,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];k.loading=!0,(l?a?e.post("/api/v1/supt/statistics/channel/web",k.form):e.put("/api/v1/supt/statistics/channel/web",k.form):e.delete(G()(t="/api/v3/channel/".concat(k.id,"/unbind/")).call(t,n))).then((function(n){n.data;h.load(),k.loading=!1,k.close(),(0,gn.bM)({position:"bottom-right",type:"success",message:"操作成功"})}))}});return function(n,p){var m=s.BT,w=s.ElSelect,g=d.gn,b=c.EZ,_=u.$Y,C=u.eI,I=o.OX,W=i.ElButton,U=r.ElCheckbox,V=r.z5,j=l.d0,D=a.t;return(0,on.wg)(),(0,on.iD)("div",Cn,[(0,on._)("div",In,[Wn,(0,on.Wm)(w,{modelValue:h.search.channelId,"onUpdate:modelValue":p[0]||(p[0]=function(n){return h.search.channelId=n}),placeholder:"不限渠道",class:"part",clearable:"",onChange:p[1]||(p[1]=function(n){f.value.pageIndex=1,h.load()})},{default:(0,on.w5)((function(){return[((0,on.wg)(!0),(0,on.iD)(on.HY,null,(0,on.Ko)(y.data,(function(n){return(0,on.wg)(),(0,on.j4)(m,{key:n.id,label:n.name,value:n.id},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"]),(0,on.Wm)(b,{modelValue:h.search.keywords,"onUpdate:modelValue":p[2]||(p[2]=function(n){return h.search.keywords=n}),class:"part",clearable:"",placeholder:"搜索关键字",onKeyup:p[3]||(p[3]=(0,un.D2)((function(n){f.value.pageIndex=1,h.load()}),["enter"])),onClear:p[4]||(p[4]=function(n){f.value.pageIndex=1,h.load()})},{prefix:(0,on.w5)((function(){return[(0,on.Wm)(g,{class:"el-input__icon"},{default:(0,on.w5)((function(){return[(0,on.Wm)((0,cn.SU)(vn.olm))]})),_:1})]})),_:1},8,["modelValue"])]),(0,on.wy)(((0,on.wg)(),(0,on.j4)(C,{class:"auto jh_table jh_table",data:h.data,stripe:!0,"default-expand-all":!0,"tooltip-effect":"light",border:"",height:"calc(100vh - 250px)"},{default:(0,on.w5)((function(){return[(0,on.Wm)(_,{type:"expand"},{default:(0,on.w5)((function(n){var e,t,a;return[(0,on._)("div",Un,[(0,on._)("div",Vn,[(0,on._)("p",null,(0,dn.zw)(null===(e=n.row)||void 0===e?void 0:e.online),1),(null===(t=n.row)||void 0===t?void 0:t.refresh)>0?((0,on.wg)(),(0,on.iD)("div",jn,[(0,on._)("span",null,(0,dn.zw)(null===(a=n.row)||void 0===a?void 0:a.refresh)+" 秒",1),(0,on._)("img",{src:sn,onClick:function(e){n.row.refresh=-1,h.refresh(n.row.id)}},null,8,Dn)])):((0,on.wg)(),(0,on.iD)("div",Sn,[(0,on.wy)((0,on._)("div",zn,null,512),[[D,!0]]),Nn]))]),(0,on.Wm)(C,{data:n.row.data,class:"jh_table_expand",border:!1},{default:(0,on.w5)((function(){return[(0,on.Wm)(_,{prop:"text","min-width":"180",label:""}),(0,on.Wm)(_,{prop:"pv","min-width":"120",label:"浏览量（PV）"}),(0,on.Wm)(_,{prop:"ip",width:"100",label:"IP数"}),(0,on.Wm)(_,{prop:"vv","min-width":"120",label:"访问次数（VV）"}),(0,on.Wm)(_,{prop:"uv","min-width":"150",label:"独立访客（UV）"}),(0,on.Wm)(_,{prop:"nuv","min-width":"150",label:"新独立访客（NUV）"}),(0,on.Wm)(_,{prop:"br",width:"120",label:"跳出率"},{default:(0,on.w5)((function(n){var e=n.row;return[(0,on._)("span",null,(0,dn.zw)("string"==typeof e.br?e.br:e.br>0?"".concat(Number(100*e.br).toFixed(2),"%"):0),1)]})),_:1}),(0,on.Wm)(_,{prop:"avgTime","min-width":"150",label:"平均访问时长"},{default:(0,on.w5)((function(n){var e=n.row;return[(0,on._)("span",null,(0,dn.zw)("string"==typeof e.avgTime?e.avgTime:x(e.avgTime)||0),1)]})),_:1})]})),_:2},1032,["data"])])]})),_:1}),(0,on.Wm)(_,{label:"站点ID",prop:"statisticID"},{default:(0,on.w5)((function(n){n.row;return[]})),_:1}),(0,on.Wm)(_,{prop:"siteName",label:"站点名称","show-overflow-tooltip":!0},{default:(0,on.w5)((function(){return[(0,on.kq)(' <template #default="{ row }">\n          <el-button\n            :disabled="!row.channelCode"\n            type="primary"\n            link\n            @click="copyUrl(row.channelCode)"\n          >\n            {{ row.channelCode || "-" }}\n          </el-button>\n        </template> ')]})),_:1}),(0,on.kq)(' <el-table-column\n        prop="name"\n        label="渠道名称"\n        :show-overflow-tooltip="true"\n      >\n        <template #default="{ row }">\n          {{ channe.data?.find((v) => v.id === row.channelId)?.name || "-" }}\n        </template>\n      </el-table-column> '),(0,on.Wm)(_,{label:"统计渠道","show-overflow-tooltip":!0},{default:(0,on.w5)((function(n){var e,t,a=n.row;return[(null===(e=a.ChannelList)||void 0===e?void 0:e.length)>0?((0,on.wg)(),(0,on.iD)("span",{key:0,style:{color:"#1e80ff",cursor:"pointer"},onClick:function(n){return k.open(a)}},(0,dn.zw)(en()(t=a.ChannelList).call(t,(function(n){return null==n?void 0:n.channelName})).join(",")),9,Zn)):((0,on.wg)(),(0,on.iD)("span",{key:1,style:{color:"red",cursor:"pointer"},onClick:function(n){return k.open(a)}},"未统计",8,An))]})),_:1}),(0,on.Wm)(_,{label:"状态",prop:"status"},{default:(0,on.w5)((function(n){var e=n.row;return[(0,on.Wm)(I,{size:"small",modelValue:e.state,"onUpdate:modelValue":function(n){return e.state=n},"active-value":1,"inactive-value":2,onChange:function(n){return h.state(e)}},null,8,["modelValue","onUpdate:modelValue","onChange"])]})),_:1}),(0,on.Wm)(_,{label:"更新时间",prop:"updateAt"},{default:(0,on.w5)((function(n){var e=n.row;return[(0,on.Uk)((0,dn.zw)(e.updateAt?(0,cn.SU)(hn.Z)(e.updateAt):"-"),1)]})),_:1}),(0,on.Wm)(_,{label:"创建时间",prop:"createAt"},{default:(0,on.w5)((function(n){var e=n.row;return[(0,on.Uk)((0,dn.zw)(e.createAt?(0,cn.SU)(hn.Z)(e.createAt):"-"),1)]})),_:1}),(0,on.Wm)(_,{fixed:"right",label:"操作",align:"right",width:"210"},{default:(0,on.w5)((function(n){var a=n.row;return[(0,on.Wm)(W,{type:"primary",link:"",onClick:function(n){var e;return null===(e=v.value)||void 0===e?void 0:e.open(a)}},{default:(0,on.w5)((function(){return[(0,on.Uk)(" 编辑 ")]})),_:2},1032,["onClick"]),(0,on.Wm)(W,{type:"danger",link:"",onClick:function(n){return function(n){return(0,fn.Z)({message:"确定要删除这个统计记录吗",okEms:"删除成功"},(function(){return e.delete("/api/v1/supt/statistics/web",{params:{id:n.id}}).then((function(n){n.data,h.load(),t()}))}))}(a)}},{default:(0,on.w5)((function(){return[(0,on.Uk)(" 删除 ")]})),_:2},1032,["onClick"])]})),_:1})]})),_:1},8,["data"])),[[D,h.loading]]),(0,on.Wm)(wn.Z,{ref_key:"editorRef",ref:v,"channe-list":y.data,onLoad:h.load},null,8,["channe-list","onLoad"]),(0,on.Wm)(mn.Z,{"channe-list":y.data2},null,8,["channe-list"]),(0,on.Wm)(pn.Z,{pageinfo:f.value,onChange:h.load},null,8,["pageinfo","onChange"]),(0,on.Wm)(j,{modelValue:k.visible,"onUpdate:modelValue":p[7]||(p[7]=function(n){return k.visible=n}),title:"统计渠道",width:"460px"},{footer:(0,on.w5)((function(){return[(0,on.Wm)(W,{class:"ml-auto",size:"small",loading:k.loading,onClick:k.close},{default:(0,on.w5)((function(){return[(0,on.Uk)(" 取消 ")]})),_:1},8,["loading","onClick"]),(0,on.Wm)(W,{size:"small",loading:k.loading,type:"primary",class:"",onClick:p[6]||(p[6]=function(n){return k.submit()})},{default:(0,on.w5)((function(){return[(0,on.kq)(" :disabled=\"form.name === '默认渠道'\" "),(0,on.Uk)(" 保存 ")]})),_:1},8,["loading"])]})),default:(0,on.w5)((function(){return[(0,on.wy)(((0,on.wg)(),(0,on.j4)(V,{modelValue:k.form.channelId,"onUpdate:modelValue":p[5]||(p[5]=function(n){return k.form.channelId=n}),style:{display:"flex","flex-wrap":"wrap",gap:"8px 0",padding:"0 12px"}},{default:(0,on.w5)((function(){return[((0,on.wg)(!0),(0,on.iD)(on.HY,null,(0,on.Ko)(y.dataSite,(function(n){return(0,on.wg)(),(0,on.j4)(U,{label:Number(n.id),style:{"flex-wrap":"wrap",margin:"0 12px 0 0","min-width":"120px","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"}},{default:(0,on.w5)((function(){return[(0,on.Uk)((0,dn.zw)(n.name),1)]})),_:2},1032,["label"])})),256))]})),_:1},8,["modelValue"])),[[D,k.loading]])]})),_:1},8,["modelValue"])])}}};t(78133);const On=(0,t(40001).Z)(Ln,[["__scopeId","data-v-5387e6ae"]])}}]);
//# sourceMappingURL=247.js.map